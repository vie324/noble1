<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>LuxeMetrics - È´òÁ¥ö„Ç®„Çπ„ÉÜ„Çµ„É≠„É≥ÁµåÂñ∂„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts Dependencies -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <!-- Recharts (Chart Library) - Pinned version for stability -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Config for Tailwind (Luxury Gold Theme) -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable dark mode with class strategy
            theme: {
                extend: {
                    colors: {
                        gold: {
                            50: '#fbf9f1',
                            100: '#f5f0db',
                            200: '#ede0b3',
                            300: '#e3cc83',
                            400: '#d9b656',
                            500: '#d4af37', // Brand Primary
                            600: '#b48e26',
                            700: '#906d1f',
                            800: '#775820',
                            900: '#624920',
                        },
                        brown: {
                            50: '#f7f5f3',
                            800: '#4a3b32', // Brand Text
                            900: '#2d241e',
                        },
                        accent: {
                            500: '#c084fc', // Subtle accent for charts
                        }
                    },
                    fontFamily: {
                        sans: ['"Yu Mincho"', '"Hiragino Mincho ProN"', '"MS PMincho"', 'serif'], // Serif for luxury feel
                        ui: ['"Helvetica Neue"', 'Arial', 'sans-serif'], // UI font
                    }
                }
            }
        }
    </script>
    <style>
        /* Base Styles */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        body {
            background-color: #f7f5f3; /* brown-50 */
            color: #4a3b32; /* brown-800 */
            font-family: "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            overscroll-behavior-y: contain;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Dark Mode Styles - Enhanced for Better Visibility */
        .dark body {
            background-color: #0f0f0f;
            color: #e8e8e8;
        }

        /* Background Colors */
        .dark .bg-brown-50,
        .dark .bg-\[#f9f8f4\] {
            background-color: #0f0f0f !important;
        }

        .dark .bg-white {
            background-color: #1a1a1a !important;
        }

        .dark .bg-gray-50 {
            background-color: #1f1f1f !important;
        }

        .dark .bg-gray-100 {
            background-color: #252525 !important;
        }

        .dark .bg-gray-200 {
            background-color: #2a2a2a !important;
        }

        /* Text Colors - Improved Contrast */
        .dark .text-brown-800 {
            color: #f5f5f5 !important;
        }

        .dark .text-gray-900 {
            color: #f0f0f0 !important;
        }

        .dark .text-gray-800 {
            color: #e8e8e8 !important;
        }

        .dark .text-gray-700 {
            color: #d0d0d0 !important;
        }

        .dark .text-gray-600 {
            color: #b8b8b8 !important;
        }

        .dark .text-gray-500 {
            color: #a0a0a0 !important;
        }

        .dark .text-gray-400 {
            color: #888888 !important;
        }

        .dark .text-gray-300 {
            color: #707070 !important;
        }

        /* Border Colors - Better Definition */
        .dark .border-gray-100 {
            border-color: #2a2a2a !important;
        }

        .dark .border-gray-200 {
            border-color: #333333 !important;
        }

        .dark .border-gray-300 {
            border-color: #404040 !important;
        }

        .dark .border-gold-100 {
            border-color: #4a3820 !important;
        }

        .dark .border-gold-200 {
            border-color: #5a4428 !important;
        }

        .dark .divide-gray-100 > * + * {
            border-color: #2a2a2a !important;
        }

        /* Gold Accent Colors */
        .dark .bg-gold-50 {
            background-color: #2a2418 !important;
        }

        .dark .bg-gold-100 {
            background-color: #342d20 !important;
        }

        .dark .text-gold-600 {
            color: #e5b745 !important;
        }

        .dark .text-gold-500 {
            color: #f0c24e !important;
        }

        /* Form Inputs - Much Better Visibility */
        .dark input,
        .dark select,
        .dark textarea {
            background-color: #252525 !important;
            border-color: #404040 !important;
            color: #e8e8e8 !important;
        }

        .dark input:focus,
        .dark select:focus,
        .dark textarea:focus {
            background-color: #2a2a2a !important;
            border-color: #d4af37 !important;
        }

        .dark input::placeholder,
        .dark textarea::placeholder {
            color: #707070 !important;
        }

        /* Hover States */
        .dark .hover\:bg-gray-100:hover {
            background-color: #252525 !important;
        }

        .dark .hover\:bg-gray-50:hover {
            background-color: #1f1f1f !important;
        }

        .dark .hover\:bg-white:hover {
            background-color: #1f1f1f !important;
        }

        .dark .hover\:bg-gold-50:hover {
            background-color: #2a2418 !important;
        }

        /* Charts and Data Visualization */
        .dark .recharts-cartesian-grid-horizontal line,
        .dark .recharts-cartesian-grid-vertical line {
            stroke: #333333 !important;
        }

        .dark .recharts-text {
            fill: #b8b8b8 !important;
        }

        .dark .recharts-tooltip-wrapper {
            background-color: #1a1a1a !important;
        }

        /* Color Variants for Data Display */
        .dark .bg-blue-50 {
            background-color: #1a2332 !important;
        }

        .dark .bg-purple-50 {
            background-color: #281a32 !important;
        }

        .dark .bg-emerald-50 {
            background-color: #1a2e23 !important;
        }

        .dark .bg-amber-50 {
            background-color: #2e2619 !important;
        }

        .dark .bg-rose-50 {
            background-color: #2e1a1e !important;
        }

        .dark .bg-orange-50 {
            background-color: #2e221a !important;
        }

        .dark .bg-yellow-50 {
            background-color: #2e2a1a !important;
        }

        .dark .text-blue-700 {
            color: #6ba3ff !important;
        }

        .dark .text-purple-700 {
            color: #b896ff !important;
        }

        .dark .text-emerald-700 {
            color: #6dd4a8 !important;
        }

        .dark .text-amber-700 {
            color: #ffb84d !important;
        }

        .dark .text-rose-700 {
            color: #ff8fa3 !important;
        }

        /* Border Colors for Data Cards */
        .dark .border-blue-200 {
            border-color: #2a3f5f !important;
        }

        .dark .border-purple-200 {
            border-color: #3f2a5f !important;
        }

        .dark .border-emerald-200 {
            border-color: #2a5f42 !important;
        }

        .dark .border-amber-200 {
            border-color: #5f4a2a !important;
        }

        .dark .border-rose-200 {
            border-color: #5f2a35 !important;
        }

        .dark .border-orange-200 {
            border-color: #5f3a2a !important;
        }

        .dark .border-yellow-200 {
            border-color: #5f552a !important;
        }

        .dark .border-blue-300 {
            border-color: #3a5a8f !important;
        }

        .dark .border-rose-300 {
            border-color: #8f3a50 !important;
        }

        .dark .border-orange-300 {
            border-color: #8f5a3a !important;
        }

        .dark .border-yellow-300 {
            border-color: #8f7f3a !important;
        }

        /* Shadows - Subtle but Visible */
        .dark .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.5) !important;
        }

        .dark .shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.5), 0 1px 2px -1px rgba(0, 0, 0, 0.5) !important;
        }

        .dark .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -2px rgba(0, 0, 0, 0.5) !important;
        }

        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.6), 0 4px 6px -4px rgba(0, 0, 0, 0.6) !important;
        }

        .dark .shadow-2xl {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7) !important;
        }

        /* Backdrop and Overlays */
        .dark .bg-black\/50 {
            background-color: rgba(0, 0, 0, 0.8) !important;
        }

        .dark .bg-white\/20 {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }

        .dark .bg-white\/95 {
            background-color: rgba(26, 26, 26, 0.95) !important;
        }

        /* Header and Navigation */
        .dark header {
            background-color: rgba(26, 26, 26, 0.95) !important;
            border-bottom-color: #2a2a2a !important;
        }

        /* Icons - Better Visibility */
        .dark svg {
            opacity: 0.95;
        }

        h1, h2, h3, .serif {
            font-family: "Yu Mincho", "Hiragino Mincho ProN", "MS PMincho", serif;
        }

        /* Mobile Typography & Layout */
        @media (max-width: 768px) {
            body {
                font-size: 16px; /* Prevent zoom on input focus */
                line-height: 1.6;
            }

            input, select, textarea {
                font-size: 16px !important; /* Prevent iOS zoom */
            }

            /* Larger touch targets */
            button, a, input[type="button"], input[type="submit"], select {
                min-height: 48px;
            }

            /* Improve scroll performance */
            * {
                -webkit-overflow-scrolling: touch;
            }

            /* Enhanced Mobile Typography */
            .mobile-title {
                font-size: 1.375rem !important; /* 22px */
                font-weight: 700 !important;
                line-height: 1.3 !important;
                letter-spacing: -0.01em !important;
            }

            .mobile-subtitle {
                font-size: 0.9375rem !important; /* 15px */
                line-height: 1.5 !important;
                font-weight: 500 !important;
            }

            .mobile-metric {
                font-size: 2.25rem !important; /* 36px */
                font-weight: 800 !important;
                line-height: 1.1 !important;
                letter-spacing: -0.02em !important;
            }

            .mobile-label {
                font-size: 0.8125rem !important; /* 13px */
                font-weight: 600 !important;
                line-height: 1.4 !important;
            }

            .mobile-body {
                font-size: 0.9375rem !important; /* 15px */
                line-height: 1.6 !important;
            }

            /* Mobile Card Spacing */
            .mobile-card {
                padding: 1rem !important;
                margin-bottom: 0.875rem !important;
                border-radius: 12px !important;
            }

            /* Compact Header */
            .mobile-header {
                height: 56px !important;
                padding: 0 0.75rem !important;
            }

            /* Button Optimization */
            .mobile-btn {
                padding: 0.875rem 1rem !important;
                font-size: 1rem !important;
                font-weight: 600 !important;
                border-radius: 10px !important;
                min-height: 48px !important;
            }

            /* Tab Optimization */
            .mobile-tab {
                padding: 0.625rem 0.875rem !important;
                font-size: 0.875rem !important;
                font-weight: 600 !important;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 4px;
        }

        /* Range Input */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }
        input[type=range]:focus {
            outline: none;
        }

        /* Glass Panel */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        /* Touch Feedback */
        .touch-feedback:active {
            transform: scale(0.97);
            transition: transform 0.1s ease-in-out;
        }

        /* Loading Skeleton */
        @keyframes skeleton-pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .skeleton {
            animation: skeleton-pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            background-color: #e5e7eb;
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Safe Area Support */
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }

        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Performance: Hardware Acceleration */
        .hw-accelerate {
            transform: translateZ(0);
            will-change: transform;
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            body {
                color: #000;
            }
            button {
                border: 2px solid currentColor;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        // Recharts might be undefined if script fails, handle gracefully
        const RechartsLib = window.Recharts || {};
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line, AreaChart, Area } = RechartsLib;

        // --- Mock Data Generators ---

        // Â∫óËàó„Éû„Çπ„Çø
        const stores = [
            { id: 1, name: "Êñ∞ÂÆøÂ∫ó", code: "shinjuku" },
            { id: 2, name: "Êñ∞ÂÆøÂçóÂè£Â∫ó", code: "shinjuku_south" }
        ];

        // „É°„Éã„É•„Éº„Éû„Çπ„Çø
        const menus = [
            { id: 1, name: "Ââ•Èõ¢„ÅÇ„Çä„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(È°î)", price: 18000, cost: 3000, availableStores: [1, 2] },
            { id: 2, name: "Ââ•Èõ¢„Å™„Åó„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(È°î)", price: 15000, cost: 2500, availableStores: [1, 2] },
            { id: 3, name: "Ââ•Èõ¢„Å™„Åó„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(„Éú„Éá„Ç£)", price: 20000, cost: 3500, availableStores: [1, 2] },
            { id: 4, name: "„Çà„ÇÇ„ÅéËí∏„Åó", price: 8000, cost: 1500, availableStores: [2] }, // Êñ∞ÂÆøÂçóÂè£Â∫ó„ÅÆ„Åø
            { id: 5, name: "„Çª„É´„Éï„Éõ„ÉØ„Ç§„Éà„Éã„É≥„Ç∞", price: 5000, cost: 800, availableStores: [2] } // Êñ∞ÂÆøÂçóÂè£Â∫ó„ÅÆ„Åø
        ];

        // ÂÖ®ËßíÊï∞Â≠ó„ÇíÂçäËßíÊï∞Â≠ó„Å´Â§âÊèõ„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
        const convertToHalfWidth = (str) => {
            if (!str) return str;
            return str.replace(/[Ôºê-Ôºô]/g, (s) => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
        };

        // Êï∞ÂÄ§ÂÖ•ÂäõÁî®„ÅÆÂ§âÊèõ„Éè„É≥„Éâ„É©„Éº
        const normalizeNumberInput = (value) => {
            const halfWidth = convertToHalfWidth(String(value));
            return halfWidth.replace(/[^0-9.-]/g, ''); // Êï∞Â≠ó„ÄÅ„Éû„Ç§„Éä„Çπ„ÄÅÂ∞èÊï∞ÁÇπ„ÅÆ„ÅøË®±ÂèØ
        };

        // ÂàùÊúü„Çπ„Çø„ÉÉ„Éï„Éá„Éº„ÇøÔºà‰ªÆ„Éá„Éº„Çø - Ëá™Áî±„Å´Á∑®ÈõÜÂèØËÉΩÔºâ
        const initialStaffData = [
            {
                id: 1,
                name: 'Áî∞‰∏≠ÁæéÂí≤',
                employmentType: 'Ê≠£Á§æÂì°',
                role: 'Â∫óÈï∑',
                storeId: 1,
                availableMenus: [1, 2, 3],
                sales: 850000,
                target: 1000000,
                nomination: 25,
                retention: 75,
                reviewScore: 4.8
            },
            {
                id: 2,
                name: '‰ΩêËó§Ëä±Â≠ê',
                employmentType: 'Ê≠£Á§æÂì°',
                role: '„Çπ„Çø„ÉÉ„Éï',
                storeId: 1,
                availableMenus: [1, 2],
                sales: 620000,
                target: 800000,
                nomination: 18,
                retention: 68,
                reviewScore: 4.5
            },
            {
                id: 3,
                name: 'Èà¥Êú®ÂΩ©È¶ô',
                employmentType: '„Ç¢„É´„Éê„Ç§„Éà',
                role: '„Çπ„Çø„ÉÉ„Éï',
                storeId: 2,
                availableMenus: [2, 4, 5],
                sales: 480000,
                target: 600000,
                nomination: 12,
                retention: 65,
                reviewScore: 4.3
            }
        ];
        // „Çπ„Çø„ÉÉ„Éï„Éá„Éº„ÇøÊßãÈÄ†: { id, name, employmentType, role, storeId, availableMenus, sales, target, nomination, retention, reviewScore }

        // ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„Éá„Éº„ÇøÔºà‰ªÆ„Éá„Éº„Çø - Ëá™Áî±„Å´Á∑®ÈõÜÂèØËÉΩÔºâ
        const initialTicketMasterData = [
            { id: 1, name: '5ÂõûÂà∏', sessions: 5, price: 85000, validMonths: 6, description: '„ÅäÂæó„Å™5Âõû„Çª„ÉÉ„Éà' },
            { id: 2, name: '10ÂõûÂà∏', sessions: 10, price: 160000, validMonths: 12, description: '10Âõû„Çª„ÉÉ„Éà„Éª1Âπ¥ÈñìÊúâÂäπ' }
        ];
        // ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÊßãÈÄ†: { id, name, sessions, price, validMonths, description }

        // È°ßÂÆ¢„Éá„Éº„ÇøÔºà‰ªÆ„Éá„Éº„Çø - Ëá™Áî±„Å´Á∑®ÈõÜÂèØËÉΩÔºâ
        const initialCustomerData = [
            {
                id: 1,
                name: 'Â±±Áî∞Â§™ÈÉé',
                phone: '090-1234-5678',
                email: 'yamada@example.com',
                purchaseDate: '2025-12-01',
                ticketMasterId: 1,
                remainingSessions: 3,
                expiryDate: '2026-06-01',
                storeId: 1
            },
            {
                id: 2,
                name: 'È´òÊ©ãÊÑõ',
                phone: '080-9876-5432',
                email: 'takahashi@example.com',
                purchaseDate: '2025-11-15',
                ticketMasterId: 2,
                remainingSessions: 7,
                expiryDate: '2026-11-15',
                storeId: 1
            },
            {
                id: 3,
                name: '‰ΩêËó§ÂÅ•',
                phone: '090-5555-1234',
                email: 'sato@example.com',
                purchaseDate: '2025-12-20',
                ticketMasterId: 1,
                remainingSessions: 1,
                expiryDate: '2026-02-15', // ÊúâÂäπÊúüÈôêÈñìËøë
                storeId: 2
            },
            {
                id: 4,
                name: 'Áî∞‰∏≠ÁæéÈ¶ô',
                phone: '080-7777-9999',
                email: 'tanaka@example.com',
                purchaseDate: '2025-12-25',
                ticketMasterId: 1,
                remainingSessions: 4,
                expiryDate: '2026-01-31', // ÊúâÂäπÊúüÈôêÈñìËøë
                storeId: 1
            }
        ];
        // È°ßÂÆ¢„Éá„Éº„ÇøÊßãÈÄ†: { id, name, phone, email, purchaseDate, ticketMasterId, remainingSessions, expiryDate, storeId }

        // Â™í‰ΩìÂà•„Éá„Éº„ÇøÔºà‰ªÆ„Éá„Éº„Çø - Ëá™Áî±„Å´Á∑®ÈõÜÂèØËÉΩÔºâ
        const initialMediaSourcesData = [
            { id: 1, name: '„Éõ„ÉÉ„Éà„Éö„ÉÉ„Éë„Éº', newVisits: 45, repeatRate: 35, cpa: 8500, sales: 680000, adCost: 382500 },
            { id: 2, name: 'Instagram', newVisits: 28, repeatRate: 52, cpa: 3200, sales: 420000, adCost: 89600 },
            { id: 3, name: 'Á¥π‰ªã', newVisits: 15, repeatRate: 78, cpa: 0, sales: 320000, adCost: 0 }
        ];
        // Â™í‰Ωì„Éá„Éº„ÇøÊßãÈÄ†: { id, name, newVisits, repeatRate, cpa, sales, adCost }

        // Êó•Ê¨°Â£≤‰∏ä„Éá„Éº„ÇøÔºà‰ªÆ„Éá„Éº„Çø - Ëá™Áî±„Å´Á∑®ÈõÜÂèØËÉΩÔºâ
        const initialDailySalesData = [
            {
                date: '2026-01-15',
                storeId: 1,
                staffId: 1,
                storeName: 'Êñ∞ÂÆøÂ∫ó',
                spotSales: 120000,
                ticketSales: 85000,
                ticketUsage: 54000,
                product: 28000,
                accountingSales: 287000,
                cashIn: 233000
            },
            {
                date: '2026-01-16',
                storeId: 1,
                staffId: 2,
                storeName: 'Êñ∞ÂÆøÂ∫ó',
                spotSales: 95000,
                ticketSales: 0,
                ticketUsage: 72000,
                product: 15000,
                accountingSales: 182000,
                cashIn: 110000
            },
            {
                date: '2026-01-15',
                storeId: 2,
                staffId: 3,
                storeName: 'Êñ∞ÂÆøÂçóÂè£Â∫ó',
                spotSales: 78000,
                ticketSales: 160000,
                ticketUsage: 40000,
                product: 22000,
                accountingSales: 300000,
                cashIn: 260000
            }
        ];
        // Êó•Ê¨°Â£≤‰∏äÊßãÈÄ†: { date, storeId, staffId, storeName, spotSales, ticketSales, ticketUsage, product, accountingSales, cashIn }

        // „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Éá„Éº„ÇøÔºà‰ªÆ„Éá„Éº„Çø - Ëá™Áî±„Å´Á∑®ÈõÜÂèØËÉΩÔºâ
        const initialMenuSalesData = [
            { menuId: 1, menuName: 'Ââ•Èõ¢„ÅÇ„Çä„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(È°î)', count: 8, sales: 144000, date: '2026-01-15', storeId: 1, staffId: 1 },
            { menuId: 2, menuName: 'Ââ•Èõ¢„Å™„Åó„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(È°î)', count: 12, sales: 180000, date: '2026-01-15', storeId: 1, staffId: 2 },
            { menuId: 4, menuName: '„Çà„ÇÇ„ÅéËí∏„Åó', count: 6, sales: 48000, date: '2026-01-15', storeId: 2, staffId: 3 },
            { menuId: 5, menuName: '„Çª„É´„Éï„Éõ„ÉØ„Ç§„Éà„Éã„É≥„Ç∞', count: 10, sales: 50000, date: '2026-01-16', storeId: 2, staffId: 3 }
        ];
        // „É°„Éã„É•„ÉºÂ£≤‰∏äÊßãÈÄ†: { menuId, menuName, count, sales, date, storeId, staffId }

        // --- Google Apps ScriptÈÄ£Êê∫Èñ¢Êï∞ ---

        // GAS„ÅÆWeb„Ç¢„Éó„É™URL„ÇíË®≠ÂÆöÔºà„Éá„Éó„É≠„Ç§Âæå„Å´ÂÆüÈöõ„ÅÆURL„Å´Â§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxmSKXpHDEVbHeKEIHrtk_DoQfXIsMXBExfa7CzhpkizuC_wf-UY5YqXn0Ctc4u6lbq/exec';

        /**
         * „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveToSpreadsheet = async (action, data) => {
            try {
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', // GAS„ÅÆÂà∂Èôê„Å´„Çà„ÇäÂøÖË¶Å
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        ...data
                    })
                });

                // no-cors„É¢„Éº„Éâ„Åß„ÅØ„É¨„Çπ„Éù„É≥„Çπ„ÇíË™≠„ÅøÂèñ„Çå„Å™„ÅÑ„Åü„ÇÅ„ÄÅÊàêÂäü„Å®‰ªÆÂÆö
                console.log('„Éá„Éº„ÇøÈÄÅ‰ø°ÂÆå‰∫Ü:', action);
                return { success: true, message: '„Éá„Éº„Çø„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü' };
            } catch (error) {
                console.error('„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà‰øùÂ≠ò„Ç®„É©„Éº:', error);
                return { success: false, message: error.toString() };
            }
        };

        /**
         * Êó•Ê¨°Â£≤‰∏ä„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveDailySalesData = (dailySalesData) => {
            return saveToSpreadsheet('saveDailySales', { salesData: dailySalesData });
        };

        /**
         * „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveMenuSalesData = (menuSalesData) => {
            return saveToSpreadsheet('saveMenuSales', { menuData: menuSalesData });
        };

        /**
         * „Çπ„Çø„ÉÉ„ÉïÂÆüÁ∏æ„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveStaffPerformanceData = (staffData) => {
            return saveToSpreadsheet('saveStaffPerformance', { staffData: staffData });
        };

        // --- Helper Components ---

        const Icon = ({ name, size = 20, color = "currentColor", className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} width={size} height={size} stroke={color} className={className}></i>;
        };

        const Card = ({ children, className = "", mobileOptimized = false }) => (
            <div className={`bg-white rounded-lg shadow-sm border border-gold-200 ${mobileOptimized ? 'mobile-card' : 'p-6'} ${className}`}>
                {children}
            </div>
        );

        const KpiCard = ({ title, value, subValue, trend, icon, color = "bg-gold-500", mobileOptimized = false }) => (
            <Card className={`hover:shadow-md transition-shadow relative overflow-hidden ${mobileOptimized ? 'touch-feedback' : ''}`} mobileOptimized={mobileOptimized}>
                {!mobileOptimized && (
                    <div className="absolute top-0 right-0 p-4 opacity-10">
                        <Icon name={icon} size={64} className="text-gold-900" />
                    </div>
                )}
                <div className={`flex justify-between items-start relative z-10 ${mobileOptimized ? 'mb-3' : 'mb-4'}`}>
                    <div className={`rounded-lg ${color} text-white shadow-md ${mobileOptimized ? 'p-2.5' : 'p-3'}`}>
                        <Icon name={icon} size={mobileOptimized ? 20 : 24} />
                    </div>
                    {trend && (
                        <span className={`font-medium ${trend > 0 ? 'text-emerald-600' : 'text-rose-500'} flex items-center bg-white/80 px-2 py-1 rounded-full ${mobileOptimized ? 'text-xs' : 'text-sm'}`}>
                            {trend > 0 ? '+' : ''}{trend}% 
                            <Icon name={trend > 0 ? 'trending-up' : 'trending-down'} size={14} className="ml-1" />
                        </span>
                    )}
                </div>
                <h3 className={`text-gray-600 font-medium serif relative z-10 ${mobileOptimized ? 'mobile-label' : 'text-sm'}`}>{title}</h3>
                <div className={`flex items-baseline relative z-10 ${mobileOptimized ? 'mt-2' : 'mt-1'}`}>
                    <span className={`font-bold text-brown-800 ${mobileOptimized ? 'mobile-metric' : 'text-2xl'}`}>{value}</span>
                </div>
                <p className={`text-gray-500 relative z-10 ${mobileOptimized ? 'mobile-subtitle mt-1.5' : 'text-xs text-gray-400 mt-1'}`}>{subValue}</p>
            </Card>
        );

        // --- Main Sections ---

        const DashboardView = ({ staffList, dailySalesData, menuSalesData, mediaSourcesData = [], customerList = [], onNavigate, mobileOptimized = false, storeData = [] }) => {
            const [viewMode, setViewMode] = useState('all'); // 'all', 'store_1', 'store_2', 'staff_{id}'
            const [selectedStaffId, setSelectedStaffId] = useState(null);
            const [periodMode, setPeriodMode] = useState('month'); // 'month', '3months', '6months', 'year'

            // „É¢„Éê„Ç§„É´„É¨„Ç§„Ç¢„Ç¶„ÉàÁî®„ÅÆ„Çπ„Çø„Ç§„É´„ÇØ„É©„Çπ
            const cardGridClass = mobileOptimized ? 'grid-cols-1' : 'grid-cols-1 md:grid-cols-2 xl:grid-cols-4';
            const cardPadding = mobileOptimized ? 'mobile-card' : 'p-6';
            const fontSize = {
                title: mobileOptimized ? 'mobile-title' : 'text-lg',
                subtitle: mobileOptimized ? 'mobile-subtitle' : 'text-sm',
                metric: mobileOptimized ? 'mobile-metric' : 'text-3xl',
                label: mobileOptimized ? 'mobile-label' : 'text-sm',
                body: mobileOptimized ? 'mobile-body' : 'text-base',
            };
            const buttonClass = mobileOptimized ? 'mobile-btn touch-feedback' : '';
            const tabClass = mobileOptimized ? 'mobile-tab touch-feedback' : '';

            // ÂÆâÂÖ®„Å™ÈÖçÂàó„ÉÅ„Çß„ÉÉ„ÇØ
            const safeCustomerList = Array.isArray(customerList) ? customerList : [];
            const safeStaffList = Array.isArray(staffList) ? staffList : [];
            const safeDailySalesData = Array.isArray(dailySalesData) ? dailySalesData : [];
            const safeStoreData = Array.isArray(storeData) && storeData.length > 0 ? storeData : stores;

            // ÊúüÈñì„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„ÅüÂ£≤‰∏ä„Éá„Éº„Çø
            const periodFilteredSales = useMemo(() => {
                if (safeDailySalesData.length === 0) return [];

                const today = new Date();
                const filterDate = new Date();

                switch(periodMode) {
                    case 'month':
                        filterDate.setMonth(today.getMonth() - 1);
                        break;
                    case '3months':
                        filterDate.setMonth(today.getMonth() - 3);
                        break;
                    case '6months':
                        filterDate.setMonth(today.getMonth() - 6);
                        break;
                    case 'year':
                        filterDate.setFullYear(today.getFullYear() - 1);
                        break;
                    default:
                        filterDate.setMonth(today.getMonth() - 1);
                }

                return safeDailySalesData.filter(d => {
                    const saleDate = new Date(d.date);
                    return saleDate >= filterDate;
                });
            }, [safeDailySalesData, periodMode]);

            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„ÅüÂ£≤‰∏ä„Éá„Éº„Çø
            const filteredDailySales = useMemo(() => {
                if (!periodFilteredSales || periodFilteredSales.length === 0) return [];
                if (viewMode === 'all') return periodFilteredSales;

                // ÂãïÁöÑ„Å™Â∫óËàó„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
                if (viewMode.startsWith('store_')) {
                    const storeId = parseInt(viewMode.replace('store_', ''));
                    return periodFilteredSales.filter(d => d.storeId === storeId);
                }

                if (viewMode === 'staff' && selectedStaffId) {
                    return periodFilteredSales.filter(d => d.staffId === selectedStaffId);
                }

                return periodFilteredSales;
            }, [periodFilteredSales, viewMode, selectedStaffId]);

            // ÊúàÊ¨°ÈõÜË®à„Éá„Éº„Çø
            const monthlyData = useMemo(() => {
                if (!periodFilteredSales || periodFilteredSales.length === 0) return [];

                const monthMap = {};
                periodFilteredSales.forEach(entry => {
                    const date = new Date(entry.date);
                    const monthKey = `${date.getFullYear()}/${String(date.getMonth() + 1).padStart(2, '0')}`;

                    if (!monthMap[monthKey]) {
                        monthMap[monthKey] = {
                            month: monthKey,
                            accountingSales: 0,
                            cashIn: 0,
                            ticketSales: 0,
                            ticketUsage: 0,
                            spotSales: 0,
                            product: 0
                        };
                    }

                    monthMap[monthKey].accountingSales += entry.accountingSales || 0;
                    monthMap[monthKey].cashIn += entry.cashIn || 0;
                    monthMap[monthKey].ticketSales += entry.ticketSales || 0;
                    monthMap[monthKey].ticketUsage += entry.ticketUsage || 0;
                    monthMap[monthKey].spotSales += entry.spotSales || 0;
                    monthMap[monthKey].product += entry.product || 0;
                });

                return Object.values(monthMap).sort((a, b) => a.month.localeCompare(b.month));
            }, [periodFilteredSales]);

            const filteredStaffList = useMemo(() => {
                if (viewMode === 'all' || viewMode === 'staff') return staffList;
                if (viewMode === 'store_1') return staffList.filter(s => s.storeId === 1);
                if (viewMode === 'store_2') return staffList.filter(s => s.storeId === 2);
                return staffList;
            }, [staffList, viewMode]);

            // ÂêàË®àË®àÁÆó
            const totalAccountingSales = filteredDailySales.reduce((acc, curr) => acc + (curr.accountingSales || 0), 0);
            const totalCashIn = filteredDailySales.reduce((acc, curr) => acc + (curr.cashIn || 0), 0);
            const totalTicketUsage = filteredDailySales.reduce((acc, curr) => acc + (curr.ticketUsage || 0), 0);
            const totalTicketSales = filteredDailySales.reduce((acc, curr) => acc + (curr.ticketSales || 0), 0);

            // ÊúâÂäπÊúüÈôê„ÅåËøë„ÅÑÈ°ßÂÆ¢„ÇíË®àÁÆóÔºà30Êó•‰ª•ÂÜÖÔºâ
            const expiringCustomers = useMemo(() => {
                const today = new Date();
                const thirtyDaysLater = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);

                return safeCustomerList.filter(customer => {
                    if (!customer.expiryDate) return false;
                    const expiryDate = new Date(customer.expiryDate);
                    return expiryDate >= today && expiryDate <= thirtyDaysLater && customer.remainingSessions > 0;
                });
            }, [safeCustomerList]);

            if (!window.Recharts) return <div>Loading Charts... (If this persists, please refresh)</div>;

            // „Éá„Éº„Çø„ÅåÁ©∫„ÅÆÂ†¥Âêà„ÅÆË°®Á§∫
            const hasData = (Array.isArray(safeStaffList) && safeStaffList.length > 0) || safeDailySalesData.length > 0;

            if (!hasData) {
                return (
                    <div className="flex flex-col items-center justify-center py-20">
                        <div className="bg-white rounded-xl p-12 shadow-lg border border-gold-200 text-center max-w-2xl">
                            <div className="w-20 h-20 bg-gold-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Icon name="sparkles" size={40} className="text-gold-600" />
                            </div>
                            <h2 className="text-2xl font-bold text-brown-800 mb-4 serif">„Ç®„Çπ„ÉÜ„Çµ„É≠„É≥„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ</h2>
                            <p className="text-gray-600 mb-8 leading-relaxed">
                                „Åæ„Å†„Éá„Éº„Çø„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br/>
                                ‰ª•‰∏ã„ÅÆÊâãÈ†Ü„Åß„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Çí‰Ωø„ÅÑÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ
                            </p>
                            <div className="text-left space-y-4 bg-gold-50 rounded-lg p-6 mb-8">
                                <div className="flex items-start">
                                    <span className="bg-gold-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 flex-shrink-0">1</span>
                                    <div>
                                        <p className="font-bold text-brown-800">„Çπ„Çø„ÉÉ„Éï„ÇíÁôªÈå≤</p>
                                        <p className="text-sm text-gray-600">Â∑¶„É°„Éã„É•„Éº„ÅÆ„Äå„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ„Äç„Åã„ÇâÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <span className="bg-gold-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 flex-shrink-0">2</span>
                                    <div>
                                        <p className="font-bold text-brown-800">ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„ÇíË®≠ÂÆö</p>
                                        <p className="text-sm text-gray-600">„ÄåÈ°ßÂÆ¢„ÉªÂõûÊï∞Âà∏ÁÆ°ÁêÜ„Äç„Åã„ÇâÂõûÊï∞Âà∏„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <span className="bg-gold-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 flex-shrink-0">3</span>
                                    <div>
                                        <p className="font-bold text-brown-800">„Éá„Éº„Çø„Çí‰øùÂ≠ò</p>
                                        <p className="text-sm text-gray-600">Âè≥‰∏ä„ÅÆ„Äå‰øùÂ≠ò„Äç„Éú„Çø„É≥„Åß„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åß„Åç„Åæ„Åô</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-xs text-gray-500">
                                üí° „Éí„É≥„Éà: „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅÂè≥‰∏ä„ÅÆ„ÄåË™≠„ÅøËæº„Åø„Äç„Éú„Çø„É≥„ÅßÂèñÂæó„Åß„Åç„Åæ„Åô
                            </p>
                        </div>
                    </div>
                );
            }

            // „Çø„Éñ„Éú„Çø„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
            const ViewTab = ({ id, label }) => (
                <button
                    onClick={() => setViewMode(id)}
                    className={`font-medium rounded-lg transition-all ${tabClass} ${
                        viewMode === id
                            ? 'bg-gold-500 text-white shadow-md'
                            : 'bg-white text-gray-600 hover:bg-gold-50 border border-gray-200'
                    } ${mobileOptimized ? 'px-3.5 py-2.5 text-sm font-semibold' : 'px-6 py-2.5 text-sm'}`}
                >
                    {label}
                </button>
            );

            const PeriodTab = ({ id, label }) => (
                <button
                    onClick={() => setPeriodMode(id)}
                    className={`font-medium rounded transition-all ${tabClass} ${
                        periodMode === id
                            ? 'bg-blue-500 text-white shadow'
                            : 'bg-white text-gray-600 hover:bg-blue-50 border border-gray-200'
                    } ${mobileOptimized ? 'px-3.5 py-2.5 text-sm font-semibold' : 'px-4 py-2 text-sm'}`}
                >
                    {label}
                </button>
            );

            return (
                <div className={mobileOptimized ? 'space-y-4' : 'space-y-6'}>
                    {/* Â∫óËàó/„Çπ„Çø„ÉÉ„ÉïÂàá„ÇäÊõø„Åà„Çø„Éñ */}
                    <div className={`bg-white rounded-lg shadow-sm border border-gold-200 ${mobileOptimized ? 'p-3' : 'p-4'}`}>
                        <div className="flex items-center justify-between flex-wrap gap-4">
                            <h3 className={`font-bold text-gray-600 serif ${fontSize.subtitle}`}>Ë°®Á§∫ÂàáÊõø</h3>
                            <div className={`flex gap-2 items-center ${mobileOptimized ? 'flex-wrap' : ''}`}>
                                <ViewTab id="all" label="ÂÖ®Â∫óËàóÂêàË®à" />
                                {safeStoreData.map(store => (
                                    <ViewTab key={store.id} id={`store_${store.id}`} label={store.name} />
                                ))}
                                <ViewTab id="staff" label="„Çπ„Çø„ÉÉ„ÉïÂà•" />
                                {viewMode === 'staff' && (
                                    <select
                                        value={selectedStaffId || ''}
                                        onChange={(e) => setSelectedStaffId(Number(e.target.value))}
                                        className="ml-2 px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-gold-500 outline-none bg-white"
                                    >
                                        <option value="">„Çπ„Çø„ÉÉ„Éï„ÇíÈÅ∏Êäû</option>
                                        {safeStaffList.map(staff => {
                                            const staffStore = safeStoreData.find(s => s.id === staff.storeId);
                                            return (
                                                <option key={staff.id} value={staff.id}>
                                                    {staff.name} ({staffStore ? staffStore.name : 'Â∫óËàó‰∏çÊòé'})
                                                </option>
                                            );
                                        })}
                                    </select>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* ÊúüÈñìÈÅ∏Êäû„Çø„Éñ */}
                    <div className={`bg-white rounded-lg shadow-sm border border-blue-200 ${mobileOptimized ? 'p-3' : 'p-4'}`}>
                        <div className="flex items-center justify-between flex-wrap gap-4">
                            <h3 className={`font-bold text-gray-600 serif ${fontSize.subtitle}`}>Ë°®Á§∫ÊúüÈñì</h3>
                            <div className={`flex gap-2 ${mobileOptimized ? 'flex-wrap' : ''}`}>
                                <PeriodTab id="month" label="‰ªäÊúà" />
                                <PeriodTab id="3months" label="ÈÅéÂéª3„É∂Êúà" />
                                <PeriodTab id="6months" label="ÈÅéÂéª6„É∂Êúà" />
                                <PeriodTab id="year" label="ÈÅéÂéª1Âπ¥" />
                            </div>
                        </div>
                    </div>

                    {/* Top KPI Cards - Split Sales Types */}
                    <div className={`grid gap-4 ${cardGridClass}`}>
                        <KpiCard
                            title="‰ºöË®à‰∏äÂ£≤‰∏ä (ÂΩπÂãôÊ∂àÂåñËæº)"
                            value={`¬•${totalAccountingSales.toLocaleString()}`}
                            subValue={`Ê∂àÂåñÈ°ç: ¬•${totalTicketUsage.toLocaleString()}`}
                            trend={5.2}
                            icon="file-text"
                            color="bg-gold-600"
                            mobileOptimized={mobileOptimized}
                        />
                        <KpiCard
                            title="„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥ (ÂÖ•ÈáëÁ∑èÈ°ç)"
                            value={`¬•${totalCashIn.toLocaleString()}`}
                            subValue={`ÂõûÊï∞Âà∏Ë≤©Â£≤: ¬•${totalTicketSales.toLocaleString()}`}
                            trend={12.8}
                            icon="coins"
                            color="bg-emerald-600"
                            mobileOptimized={mobileOptimized}
                        />
                        <KpiCard
                            title="ÂõûÊï∞Âà∏Êú™Ê∂àÂåñÊÆãÈ´ò"
                            value="¬•4,250,000"
                            subValue="ÂâçÊúàÊØî +¬•50,000 (Ë≤†ÂÇµÂ¢ó)"
                            trend={-1.2}
                            icon="layers"
                            color="bg-brown-800"
                            mobileOptimized={mobileOptimized}
                        />
                        <KpiCard
                            title="Âπ≥Âùá„É™„Éî„Éº„ÉàÁéá"
                            value="72.4%"
                            subValue="Êñ∞Ë¶èÂÆöÁùÄÁéá: 45%"
                            trend={2.1}
                            icon="repeat"
                            color="bg-rose-500"
                            mobileOptimized={mobileOptimized}
                        />
                    </div>

                    <div className={`grid gap-6 ${mobileOptimized ? 'grid-cols-1' : 'grid-cols-1 lg:grid-cols-3'}`}>
                        {/* Main Chart: Sales Breakdown */}
                        <div className={mobileOptimized ? '' : 'lg:col-span-2'}>
                            <Card mobileOptimized={mobileOptimized}>
                                <div className={`flex justify-between items-center ${mobileOptimized ? 'mb-3' : 'mb-6'}`}>
                                    <div>
                                        <h2 className={`font-bold text-brown-800 serif ${fontSize.title}`}>Â£≤‰∏äÊßãÈÄ†ÂàÜÊûê</h2>
                                        {!mobileOptimized && (
                                            <p className={`text-gray-500 ${fontSize.subtitle}`}>„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥(ÁèæÈáë)„Å®‰ºöË®à‰∏äÂ£≤‰∏ä(PL)„ÅÆ‰πñÈõ¢„ÇíÁ¢∫Ë™ç</p>
                                        )}
                                    </div>
                                </div>
                                <ResponsiveContainer width="100%" height={mobileOptimized ? 220 : 280}>
                                    <BarChart data={filteredDailySales}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e5e7eb" />
                                        <XAxis dataKey="day" tick={{fontSize: mobileOptimized ? 9 : 10}} interval={mobileOptimized ? 3 : 2} />
                                        <YAxis tick={{fontSize: mobileOptimized ? 9 : 10}} tickFormatter={(val) => `¬•${val/10000}‰∏á`} />
                                        <Tooltip
                                            formatter={(value) => `¬•${value.toLocaleString()}`}
                                            contentStyle={{
                                                backgroundColor: '#fff',
                                                borderColor: '#d4af37',
                                                fontSize: mobileOptimized ? '13px' : '14px',
                                                padding: mobileOptimized ? '6px 10px' : '8px 12px'
                                            }}
                                        />
                                        <Legend wrapperStyle={{fontSize: mobileOptimized ? '11px' : '12px'}} />
                                        <Bar dataKey="spotSales" name="ÈÉΩÂ∫¶Êâï„ÅÑ" stackId="a" fill="#d4af37" />
                                        <Bar dataKey="product" name="Áâ©Ë≤©" stackId="a" fill="#b48e26" />
                                        <Bar dataKey="ticketUsage" name="ÂõûÊï∞Âà∏Ê∂àÂåñ(Â£≤‰∏ä)" stackId="a" fill="#4a3b32" />
                                        <Bar dataKey="ticketSales" name="ÂõûÊï∞Âà∏Ë≤©Â£≤(ÂÖ•Èáë)" fill="#10b981" radius={[4, 4, 0, 0]} opacity={0.3} />
                                    </BarChart>
                                </ResponsiveContainer>

                                {/* Â£≤‰∏äÊßãÈÄ†„ÅÆË©≥Á¥∞„ÉÜ„Éº„Éñ„É´ */}
                                <div className={`border-t border-gray-200 ${mobileOptimized ? 'mt-4 pt-4' : 'mt-6 pt-6'}`}>
                                    <h3 className={`font-bold text-brown-800 mb-4 ${mobileOptimized ? 'text-sm' : 'text-base'}`}>ÊúüÈñìÂêàË®à„ÅÆÂÜÖË®≥</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        {/* ÈÉΩÂ∫¶Êâï„ÅÑ */}
                                        <div className="bg-gradient-to-br from-gold-50 to-gold-100 border border-gold-200 rounded-lg p-4">
                                            <div className="flex items-center mb-2">
                                                <div className="w-3 h-3 rounded-full bg-[#d4af37] mr-2"></div>
                                                <span className="text-xs text-gray-600 font-medium">ÈÉΩÂ∫¶Êâï„ÅÑ</span>
                                            </div>
                                            <p className="text-xl font-bold text-brown-800 mb-1">
                                                ¬•{filteredDailySales.reduce((sum, d) => sum + (d.spotSales || 0), 0).toLocaleString()}
                                            </p>
                                            <p className="text-xs text-gray-500">
                                                {totalAccountingSales > 0 ?
                                                    `${Math.round((filteredDailySales.reduce((sum, d) => sum + (d.spotSales || 0), 0) / totalAccountingSales) * 100)}%` :
                                                    '0%'
                                                } of ‰ºöË®à‰∏äÂ£≤‰∏ä
                                            </p>
                                        </div>

                                        {/* Áâ©Ë≤© */}
                                        <div className="bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 rounded-lg p-4">
                                            <div className="flex items-center mb-2">
                                                <div className="w-3 h-3 rounded-full bg-[#b48e26] mr-2"></div>
                                                <span className="text-xs text-gray-600 font-medium">Áâ©Ë≤©</span>
                                            </div>
                                            <p className="text-xl font-bold text-brown-800 mb-1">
                                                ¬•{filteredDailySales.reduce((sum, d) => sum + (d.product || 0), 0).toLocaleString()}
                                            </p>
                                            <p className="text-xs text-gray-500">
                                                {totalAccountingSales > 0 ?
                                                    `${Math.round((filteredDailySales.reduce((sum, d) => sum + (d.product || 0), 0) / totalAccountingSales) * 100)}%` :
                                                    '0%'
                                                } of ‰ºöË®à‰∏äÂ£≤‰∏ä
                                            </p>
                                        </div>

                                        {/* ÂõûÊï∞Âà∏Ê∂àÂåñ */}
                                        <div className="bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-300 rounded-lg p-4">
                                            <div className="flex items-center mb-2">
                                                <div className="w-3 h-3 rounded-full bg-[#4a3b32] mr-2"></div>
                                                <span className="text-xs text-gray-600 font-medium">ÂõûÊï∞Âà∏Ê∂àÂåñ</span>
                                            </div>
                                            <p className="text-xl font-bold text-brown-800 mb-1">
                                                ¬•{totalTicketUsage.toLocaleString()}
                                            </p>
                                            <p className="text-xs text-gray-500">
                                                {totalAccountingSales > 0 ?
                                                    `${Math.round((totalTicketUsage / totalAccountingSales) * 100)}%` :
                                                    '0%'
                                                } of ‰ºöË®à‰∏äÂ£≤‰∏ä
                                            </p>
                                        </div>

                                        {/* ÂõûÊï∞Âà∏Ë≤©Â£≤ */}
                                        <div className="bg-gradient-to-br from-emerald-50 to-emerald-100 border border-emerald-200 rounded-lg p-4">
                                            <div className="flex items-center mb-2">
                                                <div className="w-3 h-3 rounded-full bg-[#10b981] mr-2"></div>
                                                <span className="text-xs text-gray-600 font-medium">ÂõûÊï∞Âà∏Ë≤©Â£≤</span>
                                            </div>
                                            <p className="text-xl font-bold text-emerald-700 mb-1">
                                                ¬•{totalTicketSales.toLocaleString()}
                                            </p>
                                            <p className="text-xs text-gray-500">
                                                ÁèæÈáëÂèéÂÖ•ÔºàÂ£≤‰∏äÂ§ñÔºâ
                                            </p>
                                        </div>
                                    </div>

                                    {/* ÂêàË®à„Çµ„Éû„É™„Éº */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                        <div className="bg-gradient-to-br from-rose-50 to-rose-100 border-2 border-rose-300 rounded-lg p-4">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-xs text-gray-600 font-medium mb-1">‰ºöË®à‰∏äÂ£≤‰∏äÔºàPLÔºâ</p>
                                                    <p className="text-2xl font-bold text-brown-800">¬•{totalAccountingSales.toLocaleString()}</p>
                                                </div>
                                                <Icon name="file-text" size={28} className="text-rose-300" />
                                            </div>
                                            <p className="text-xs text-gray-500 mt-2">
                                                ÈÉΩÂ∫¶Êâï„ÅÑ + Áâ©Ë≤© + ÂõûÊï∞Âà∏Ê∂àÂåñ
                                            </p>
                                        </div>
                                        <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300 rounded-lg p-4">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-xs text-gray-600 font-medium mb-1">„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥ÔºàÁèæÈáëÔºâ</p>
                                                    <p className="text-2xl font-bold text-blue-700">¬•{totalCashIn.toLocaleString()}</p>
                                                </div>
                                                <Icon name="dollar-sign" size={28} className="text-blue-300" />
                                            </div>
                                            <p className="text-xs text-gray-500 mt-2">
                                                ÈÉΩÂ∫¶Êâï„ÅÑ + Áâ©Ë≤© + ÂõûÊï∞Âà∏Ë≤©Â£≤
                                            </p>
                                        </div>
                                    </div>

                                    {/* ‰πñÈõ¢Ë™¨Êòé */}
                                    {totalAccountingSales !== totalCashIn && (
                                        <div className="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                                            <div className="flex items-start">
                                                <Icon name="info" size={16} className="text-amber-600 mr-2 mt-0.5 flex-shrink-0" />
                                                <div className="text-xs text-gray-700">
                                                    <p className="font-bold text-amber-800 mb-1">Â£≤‰∏ä„Å®„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥„ÅÆ‰πñÈõ¢„Å´„Å§„ÅÑ„Å¶</p>
                                                    <p>
                                                        <span className="font-bold">Â∑ÆÈ°ç: ¬•{Math.abs(totalAccountingSales - totalCashIn).toLocaleString()}</span>
                                                        {totalCashIn > totalAccountingSales ? ' „Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥„ÅåÂ§ö„ÅÑ' : ' ‰ºöË®à‰∏äÂ£≤‰∏ä„ÅåÂ§ö„ÅÑ'}
                                                    </p>
                                                    <p className="mt-1 text-gray-600">
                                                        ÂõûÊï∞Âà∏Ë≤©Â£≤„ÅØÁèæÈáëÂèéÂÖ•„Åß„Åô„Åå„ÄÅ‰ºöË®à‰∏ä„ÅØÂâçÂèóÈáëÔºàË≤†ÂÇµÔºâ„Å®„Åó„Å¶Âá¶ÁêÜ„Åï„Çå„Åæ„Åô„ÄÇ
                                                        ÂõûÊï∞Âà∏Ê∂àÂåñÊôÇ„Å´Â£≤‰∏ä„Å®„Åó„Å¶Ë®à‰∏ä„Åï„Çå„Çã„Åü„ÇÅ„ÄÅPL„Å®„Ç≠„É£„ÉÉ„Ç∑„É•„Éï„É≠„Éº„Å´Â∑Æ„ÅåÁîü„Åò„Åæ„Åô„ÄÇ
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </Card>
                        </div>

                        {/* Side Widgets */}
                        <div className="space-y-6">
                            {/* Media Performance Mini */}
                            <Card>
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">Â™í‰ΩìÂà• Êñ∞Ë¶èÈõÜÂÆ¢Áä∂Ê≥Å</h3>
                                <div className="space-y-4">
                                    {(mediaSourcesData || []).slice(0, 3).map(media => (
                                        <div key={media.id} className="flex flex-col">
                                            <div className="flex justify-between text-sm mb-1">
                                                <span className="font-medium text-gray-700">{media.name}</span>
                                                <span className="font-bold text-gold-600">{media.newVisits}‰∫∫</span>
                                            </div>
                                            <div className="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                                                <div 
                                                    className="h-full bg-gold-500" 
                                                    style={{width: `${(media.newVisits / 50) * 100}%`}}
                                                ></div>
                                            </div>
                                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                                <span>CPA: ¬•{media.cpa.toLocaleString()}</span>
                                                <span>ÂÆöÁùÄÁéá: {media.repeatRate}%</span>
                                            </div>
                                        </div>
                                    ))}
                                    <button
                                        onClick={() => onNavigate && onNavigate('sales')}
                                        className="w-full mt-2 text-xs text-gold-600 hover:text-gold-700 text-center py-2 border border-gold-200 rounded hover:bg-gold-50 transition-colors"
                                    >
                                        ÂÖ®„Å¶„ÅÆÂ™í‰Ωì„ÇíË¶ã„Çã
                                    </button>
                                </div>
                            </Card>

                            {/* Ticket Alert */}
                            <div className={`p-6 rounded-lg shadow-lg ${expiringCustomers.length > 0 ? 'bg-gradient-to-br from-rose-600 to-rose-700' : 'bg-gradient-to-br from-emerald-600 to-emerald-700'} text-white`}>
                                <div className="flex items-center mb-3">
                                    <Icon name={expiringCustomers.length > 0 ? "alert-circle" : "check-circle"} size={20} className="text-white mr-2" />
                                    <h3 className="font-bold serif">ÊúâÂäπÊúüÈôê„Ç¢„É©„Éº„Éà</h3>
                                </div>
                                {expiringCustomers.length > 0 ? (
                                    <>
                                        <p className="text-sm opacity-90 mb-4">
                                            30Êó•‰ª•ÂÜÖ„Å´ÊúâÂäπÊúüÈôê„ÅåÂàá„Çå„ÇãÂõûÊï∞Âà∏„ÇíÊåÅ„Å§È°ßÂÆ¢„Åå <span className="font-bold text-white text-lg">{expiringCustomers.length}Âêç</span> „ÅÑ„Åæ„Åô„ÄÇ
                                        </p>
                                        <div className="bg-white/20 rounded p-3 mb-4 max-h-32 overflow-y-auto">
                                            {expiringCustomers.map(customer => (
                                                <div key={customer.id} className="text-xs mb-2 last:mb-0 flex justify-between items-center">
                                                    <span>{customer.name}</span>
                                                    <span className="opacity-75">{customer.expiryDate} (ÊÆã{customer.remainingSessions}Âõû)</span>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                ) : (
                                    <p className="text-sm opacity-90 mb-4">
                                        ÁèæÂú®„ÄÅ30Êó•‰ª•ÂÜÖ„Å´ÊúâÂäπÊúüÈôê„ÅåÂàá„Çå„ÇãÂõûÊï∞Âà∏„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
                                    </p>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Monthly Trend Chart (when period > month) */}
                    {periodMode !== 'month' && monthlyData.length > 0 && (
                        <Card mobileOptimized={mobileOptimized}>
                            <div className={mobileOptimized ? 'mb-3' : 'mb-6'}>
                                <h2 className={`font-bold text-brown-800 serif ${fontSize.title}`}>ÊúàÊ¨°Êé®Áßª„Ç∞„É©„Éï</h2>
                                {!mobileOptimized && (
                                    <p className="text-xs text-gray-500">ÈÅ∏ÊäûÊúüÈñì„ÅÆÊúà„Åî„Å®„ÅÆÂ£≤‰∏äÊé®Áßª„ÇíÁ¢∫Ë™ç</p>
                                )}
                            </div>
                            <ResponsiveContainer width="100%" height={mobileOptimized ? 240 : 300}>
                                <LineChart data={monthlyData}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e5e7eb" />
                                    <XAxis dataKey="month" tick={{fontSize: mobileOptimized ? 9 : 10}} />
                                    <YAxis tick={{fontSize: mobileOptimized ? 9 : 10}} tickFormatter={(val) => `¬•${val/10000}‰∏á`} />
                                    <Tooltip
                                        formatter={(value) => `¬•${value.toLocaleString()}`}
                                        contentStyle={{
                                            backgroundColor: '#fff',
                                            borderColor: '#d4af37',
                                            fontSize: mobileOptimized ? '13px' : '14px',
                                            padding: mobileOptimized ? '6px 10px' : '8px 12px'
                                        }}
                                    />
                                    <Legend wrapperStyle={{fontSize: mobileOptimized ? '11px' : '12px'}} />
                                    <Line type="monotone" dataKey="accountingSales" name="‰ºöË®à‰∏äÂ£≤‰∏ä" stroke="#d4af37" strokeWidth={2} dot={{r: 4}} />
                                    <Line type="monotone" dataKey="cashIn" name="„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥" stroke="#10b981" strokeWidth={2} dot={{r: 4}} />
                                    <Line type="monotone" dataKey="ticketSales" name="ÂõûÊï∞Âà∏Ë≤©Â£≤" stroke="#3b82f6" strokeWidth={2} dot={{r: 4}} />
                                </LineChart>
                            </ResponsiveContainer>

                            {/* Summary Statistics */}
                            <div className={`grid grid-cols-2 gap-3 ${mobileOptimized ? 'mt-4' : 'mt-6 md:grid-cols-4 gap-4'}`}>
                                <div className={`bg-gold-50 rounded ${mobileOptimized ? 'p-2.5' : 'p-3'}`}>
                                    <p className={`text-gray-600 ${mobileOptimized ? 'mobile-label' : 'text-xs'}`}>ÊúüÈñìÂêàË®àÂ£≤‰∏ä</p>
                                    <p className={`font-bold text-gold-700 ${mobileOptimized ? 'text-base mt-1' : 'text-lg'}`}>¬•{monthlyData.reduce((sum, m) => sum + m.accountingSales, 0).toLocaleString()}</p>
                                </div>
                                <div className={`bg-emerald-50 rounded ${mobileOptimized ? 'p-2.5' : 'p-3'}`}>
                                    <p className={`text-gray-600 ${mobileOptimized ? 'mobile-label' : 'text-xs'}`}>ÊúüÈñìÂêàË®àÂÖ•Èáë</p>
                                    <p className={`font-bold text-emerald-700 ${mobileOptimized ? 'text-base mt-1' : 'text-lg'}`}>¬•{monthlyData.reduce((sum, m) => sum + m.cashIn, 0).toLocaleString()}</p>
                                </div>
                                <div className={`bg-blue-50 rounded ${mobileOptimized ? 'p-2.5' : 'p-3'}`}>
                                    <p className={`text-gray-600 ${mobileOptimized ? 'mobile-label' : 'text-xs'}`}>ÊúàÂπ≥ÂùáÂ£≤‰∏ä</p>
                                    <p className={`font-bold text-blue-700 ${mobileOptimized ? 'text-base mt-1' : 'text-lg'}`}>¬•{Math.round(monthlyData.reduce((sum, m) => sum + m.accountingSales, 0) / monthlyData.length).toLocaleString()}</p>
                                </div>
                                <div className={`bg-rose-50 rounded ${mobileOptimized ? 'p-2.5' : 'p-3'}`}>
                                    <p className={`text-gray-600 ${mobileOptimized ? 'mobile-label' : 'text-xs'}`}>ÂØæË±°ÊúüÈñì</p>
                                    <p className={`font-bold text-rose-700 ${mobileOptimized ? 'text-base mt-1' : 'text-lg'}`}>{monthlyData.length}„É∂Êúà</p>
                                </div>
                            </div>
                        </Card>
                    )}
                </div>
            );
        };

        // --- Media Analysis Section (New) ---
        const SalesAnalysisView = ({ dailySalesData, mediaSourcesData = [], onUpdateMediaSource }) => {
             if (!window.Recharts) return <div>Loading Charts...</div>;

            const [editingAdCostId, setEditingAdCostId] = useState(null);
            const [adCostInput, setAdCostInput] = useState('');

            // Á©∫„Éá„Éº„Çø„ÉÅ„Çß„ÉÉ„ÇØ
            const hasData = (dailySalesData && dailySalesData.length > 0) || (mediaSourcesData && mediaSourcesData.length > 0);

            // Â∫ÉÂëäË≤ª„ÅÆÁ∑®ÈõÜ„ÇíÈñãÂßã
            const startEditAdCost = (media) => {
                setEditingAdCostId(media.id);
                setAdCostInput(String(media.adCost || 0));
            };

            // Â∫ÉÂëäË≤ª„ÅÆ‰øùÂ≠ò
            const saveAdCost = (media) => {
                const processedValue = normalizeNumberInput(adCostInput);
                const newAdCost = processedValue === '' ? 0 : Number(processedValue);

                if (onUpdateMediaSource) {
                    onUpdateMediaSource(media.id, {
                        ...media,
                        adCost: newAdCost
                    });
                }

                setEditingAdCostId(null);
                setAdCostInput('');
            };

            // Á∑®ÈõÜ„Çí„Ç≠„É£„É≥„Çª„É´
            const cancelEditAdCost = () => {
                setEditingAdCostId(null);
                setAdCostInput('');
            };

            // „Éá„Éº„Çø„ÇíÊï¥ÂΩ¢Ôºàday„Éï„Ç£„Éº„É´„Éâ„ÇíËøΩÂä†Ôºâ
            const formattedDailySalesData = useMemo(() => {
                if (!dailySalesData || dailySalesData.length === 0) return [];
                return dailySalesData.map(entry => ({
                    ...entry,
                    day: entry.day || (entry.date ? new Date(entry.date).getDate() + 'Êó•' : '')
                }));
            }, [dailySalesData]);

            if (!hasData) {
                return (
                    <div className="flex flex-col items-center justify-center py-20">
                        <div className="bg-white rounded-xl p-12 shadow-lg border border-gold-200 text-center max-w-2xl">
                            <div className="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Icon name="trending-up" size={40} className="text-amber-600" />
                            </div>
                            <h2 className="text-2xl font-bold text-brown-800 mb-4 serif">Â£≤‰∏ä„ÉªÂ™í‰ΩìÂàÜÊûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h2>
                            <p className="text-gray-600 mb-8 leading-relaxed">
                                Â£≤‰∏ä„Éá„Éº„Çø„Å®Â™í‰Ωì„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åô„Çã„Å®„ÄÅË©≥Á¥∞„Å™ÂàÜÊûê„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ<br/>
                                „Åæ„Åö„ÅØÊó•Ê¨°Â£≤‰∏ä„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                            </p>
                            <div className="text-left space-y-4 bg-amber-50 rounded-lg p-6">
                                <div className="flex items-start">
                                    <Icon name="info" size={20} className="text-amber-600 mr-3 flex-shrink-0 mt-0.5" />
                                    <div>
                                        <p className="font-bold text-brown-800 mb-2">„Éá„Éº„ÇøÂÖ•ÂäõÊñπÊ≥ï</p>
                                        <ul className="text-sm text-gray-600 space-y-1 list-disc list-inside">
                                            <li>„ÄåÂÆüÁ∏æÂÖ•Âäõ„Äç„É°„Éã„É•„Éº„Åã„ÇâÊó•Ê¨°Â£≤‰∏ä„ÇíÁôªÈå≤</li>
                                            <li>Â™í‰ΩìÂà•„ÅÆÈõÜÂÆ¢„Éá„Éº„Çø„ÇíÂÖ•Âäõ</li>
                                            <li>„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åó„Å¶ÁÆ°ÁêÜ</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Media Source Performance Table */}
                        <Card className="col-span-1">
                             <div className="flex justify-between items-center mb-6">
                                <h2 className="text-lg font-bold text-brown-800 serif">Â™í‰ΩìÂà•„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂàÜÊûê</h2>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="border-b border-gold-100 text-xs text-gray-500 uppercase">
                                            <th className="py-3 font-medium">Â™í‰ΩìÂêç</th>
                                            <th className="py-3 font-medium text-right">Êñ∞Ë¶èÊï∞</th>
                                            <th className="py-3 font-medium text-right">Áç≤ÂæóÂçò‰æ°(CPA)</th>
                                            <th className="py-3 font-medium text-right">Â∫ÉÂëäË≤ª</th>
                                            <th className="py-3 font-medium text-right">„É™„Éî„Éº„ÉàÁéá</th>
                                            <th className="py-3 font-medium text-right">Á∑èÂ£≤‰∏äË≤¢ÁåÆ</th>
                                            <th className="py-3 font-medium text-center">ROAS</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-sm divide-y divide-gray-50">
                                        {mediaSourcesData && mediaSourcesData.length > 0 ? (
                                            mediaSourcesData.map((media) => {
                                                const roas = media.adCost > 0 ? ((media.sales / media.adCost) * 100).toFixed(0) : '-';
                                                return (
                                                    <tr key={media.id} className="hover:bg-gold-50/50">
                                                        <td className="py-3 font-medium text-brown-800">{media.name}</td>
                                                        <td className="py-3 text-right">{media.newVisits}</td>
                                                        <td className="py-3 text-right">¬•{media.cpa.toLocaleString()}</td>
                                                        <td className="py-3 text-right">
                                                            {editingAdCostId === media.id ? (
                                                                <div className="flex items-center justify-end gap-1">
                                                                    <input
                                                                        type="text"
                                                                        inputMode="numeric"
                                                                        value={adCostInput}
                                                                        onChange={(e) => setAdCostInput(e.target.value)}
                                                                        onKeyDown={(e) => {
                                                                            if (e.key === 'Enter') saveAdCost(media);
                                                                            if (e.key === 'Escape') cancelEditAdCost();
                                                                        }}
                                                                        className="w-24 px-2 py-1 border border-blue-400 rounded text-sm text-right focus:outline-none focus:border-blue-600"
                                                                        autoFocus
                                                                    />
                                                                    <button
                                                                        onClick={() => saveAdCost(media)}
                                                                        className="text-green-600 hover:text-green-700"
                                                                    >
                                                                        <Icon name="check" size={14} />
                                                                    </button>
                                                                    <button
                                                                        onClick={cancelEditAdCost}
                                                                        className="text-red-600 hover:text-red-700"
                                                                    >
                                                                        <Icon name="x" size={14} />
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <button
                                                                    onClick={() => startEditAdCost(media)}
                                                                    className="text-blue-600 hover:text-blue-700 hover:underline"
                                                                >
                                                                    ¬•{(media.adCost || 0).toLocaleString()}
                                                                </button>
                                                            )}
                                                        </td>
                                                        <td className="py-3 text-right">
                                                            <span className={`px-2 py-1 rounded-full text-xs ${media.repeatRate >= 40 ? 'bg-emerald-100 text-emerald-700' : 'bg-gray-100 text-gray-600'}`}>
                                                                {media.repeatRate}%
                                                            </span>
                                                        </td>
                                                        <td className="py-3 text-right font-medium">¬•{media.sales.toLocaleString()}</td>
                                                        <td className="py-3 text-center">
                                                            {roas !== '-' ? (
                                                                <span className={`px-2 py-1 rounded-full text-xs font-bold ${
                                                                    Number(roas) >= 300 ? 'bg-green-100 text-green-700' :
                                                                    Number(roas) >= 150 ? 'bg-yellow-100 text-yellow-700' :
                                                                    'bg-red-100 text-red-700'
                                                                }`}>
                                                                    {roas}%
                                                                </span>
                                                            ) : (
                                                                <span className="text-gray-400 text-xs">-</span>
                                                            )}
                                                        </td>
                                                    </tr>
                                                );
                                            })
                                        ) : (
                                            <tr>
                                                <td colSpan="7" className="py-6 text-center text-gray-400 text-sm">
                                                    Â™í‰Ωì„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                                                </td>
                                            </tr>
                                        )}
                                    </tbody>
                                </table>
                            </div>
                            <div className="mt-4 p-4 bg-gold-50 rounded text-xs text-brown-800 space-y-2">
                                <div>
                                    <strong>Â∫ÉÂëäË≤ª„ÅÆÂÖ•ÂäõÊñπÊ≥ï:</strong> ÂêÑÂ™í‰Ωì„ÅÆÂ∫ÉÂëäË≤ªÔºàÈùíËâ≤„ÅÆÈáëÈ°çÔºâ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®Á∑®ÈõÜ„Åß„Åç„Åæ„Åô„ÄÇÊúàÈñì„ÅÆÂ∫ÉÂëäË≤ª„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                </div>
                                <div>
                                    <strong>ROAS (Return On Ad Spend):</strong> Â∫ÉÂëäË≤ª1ÂÜÜ„ÅÇ„Åü„Çä„ÅÆÂ£≤‰∏ä„ÇíÁ§∫„Åó„Åæ„Åô„ÄÇ300%‰ª•‰∏ä=ÂÑ™ÁßÄ„ÄÅ150-300%=ËâØÂ•Ω„ÄÅ150%Êú™Ê∫Ä=ÊîπÂñÑÂøÖË¶Å
                                </div>
                                <div>
                                    <strong>ÂàÜÊûê:</strong> Á¥π‰ªãÂ™í‰Ωì„ÅØÂ∫ÉÂëäË≤ª„Çº„É≠„ÅßÈ´ò„ÅÑ„É™„Éî„Éº„ÉàÁéá„ÇíÂÆüÁèæ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÊúâÊñôÂ™í‰Ωì„ÅÆROAS„ÇíÁ¢∫Ë™ç„Åó„ÄÅË≤ªÁî®ÂØæÂäπÊûú„ÅÆÈ´ò„ÅÑÂ™í‰Ωì„Å´‰∫àÁÆó„ÇíÈõÜ‰∏≠„Åï„Åõ„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ
                                </div>
                            </div>
                        </Card>

                        {/* Sales Trend Chart */}
                         <Card className="col-span-1">
                            <h2 className="text-lg font-bold text-brown-800 mb-6 serif">Â£≤‰∏äÊé®ÁßªÔºà„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥ vs ÂΩπÂãôÊ∂àÂåñÔºâ</h2>
                             <ResponsiveContainer width="100%" height={300}>
                                <AreaChart data={formattedDailySalesData}>
                                    <defs>
                                        <linearGradient id="colorCash" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#10b981" stopOpacity={0.1}/>
                                            <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                                        </linearGradient>
                                        <linearGradient id="colorSales" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#d4af37" stopOpacity={0.1}/>
                                            <stop offset="95%" stopColor="#d4af37" stopOpacity={0}/>
                                        </linearGradient>
                                    </defs>
                                    <XAxis dataKey="day" tick={{fontSize: 10}} interval={5} />
                                    <YAxis tick={{fontSize: 10}} />
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                    <Tooltip />
                                    <Legend verticalAlign="top" height={36}/>
                                    <Area type="monotone" dataKey="cashIn" name="„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥(ÁèæÈáë)" stroke="#10b981" fillOpacity={1} fill="url(#colorCash)" />
                                    <Area type="monotone" dataKey="accountingSales" name="‰ºöË®à‰∏äÂ£≤‰∏ä(Ê∂àÂåñ)" stroke="#d4af37" fillOpacity={1} fill="url(#colorSales)" />
                                </AreaChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>
                </div>
            );
        };


        // --- Staff Management Section (Enhanced) ---

        const StaffManagementView = ({
            staffList,
            onUpdateStaff,
            onAddStaff,
            onDeleteStaff,
            exportToCSV
        }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [deletingId, setDeletingId] = useState(null);

            // Form State
            const [formData, setFormData] = useState({
                name: '',
                employmentType: 'Ê≠£Á§æÂì°', // ÈõáÁî®ÂΩ¢ÊÖã
                role: '„Çπ„Çø„ÉÉ„Éï',
                storeId: 1,
                availableMenus: [], // ÊñΩË°ìÂèØËÉΩ„Å™„É°„Éã„É•„ÉºÔºà„É°„Éã„É•„ÉºID„ÅÆÈÖçÂàóÔºâ
                sales: 0,
                target: 0,
                nomination: 0,
                retention: 0,
                reviewScore: 0
            });

            const handleEditClick = (staff) => {
                setIsEditing(true);
                setEditingId(staff.id);
                setFormData({
                    name: staff.name || '',
                    employmentType: staff.employmentType || 'Ê≠£Á§æÂì°',
                    role: staff.role || '„Çπ„Çø„ÉÉ„Éï',
                    storeId: staff.storeId || 1,
                    availableMenus: Array.isArray(staff.availableMenus) ? staff.availableMenus : [],
                    sales: staff.sales || 0,
                    target: staff.target || 0,
                    nomination: staff.nomination || 0,
                    retention: staff.retention || 0,
                    reviewScore: staff.reviewScore || 0
                });
            };

            const handleAddClick = () => {
                setIsEditing(true);
                setEditingId(null); // New
                setFormData({
                    name: '',
                    employmentType: 'Ê≠£Á§æÂì°',
                    role: '„Çπ„Çø„ÉÉ„Éï',
                    storeId: 1,
                    availableMenus: [],
                    sales: 0,
                    target: 0,
                    nomination: 0,
                    retention: 0,
                    reviewScore: 0
                });
            };

            const handleDeleteClick = (staffId) => {
                setDeletingId(staffId);
                setShowDeleteConfirm(true);
            };

            const confirmDelete = () => {
                onDeleteStaff(deletingId);
                setShowDeleteConfirm(false);
                setDeletingId(null);
            };

            const handleSave = () => {
                if (editingId) {
                    onUpdateStaff(editingId, formData);
                } else {
                    onAddStaff({ ...formData, id: Date.now() });
                }
                setIsEditing(false);
                setEditingId(null);
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                const isTextField = ['name', 'role', 'employmentType'].includes(name);
                const isSelectNumber = name === 'storeId';

                setFormData(prev => ({
                    ...prev,
                    [name]: isTextField ? value :
                            isSelectNumber ? Number(value) :
                            (() => {
                                const processedValue = normalizeNumberInput(value);
                                return processedValue === '' ? 0 : Number(processedValue);
                            })()
                }));
            };

            return (
                <div className="space-y-6">
                    {/* Header Action */}
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-xl font-bold text-brown-800 serif">„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ„ÉªÂàÜÊûê</h2>
                            <p className="text-sm text-gray-500">ÂÄã‰∫∫„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁÆ°ÁêÜ„Å®Ë©ï‰æ°„Éá„Éº„Çø„ÅÆÁ∑®ÈõÜ</p>
                        </div>
                        <div className="flex items-center space-x-2">
                            <button
                                onClick={() => exportToCSV(staffList, '„Çπ„Çø„ÉÉ„ÉïÂÆüÁ∏æ.csv')}
                                className="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-sm flex items-center text-sm font-medium transition-colors"
                            >
                                <Icon name="download" size={16} className="mr-2" />
                                CSVÂá∫Âäõ
                            </button>
                            <button
                                onClick={handleAddClick}
                                className="bg-gold-500 hover:bg-gold-600 text-white px-4 py-2 rounded-lg shadow-sm flex items-center text-sm font-medium transition-colors"
                            >
                                <Icon name="plus" size={16} className="mr-2" />
                                „Çπ„Çø„ÉÉ„ÉïÊñ∞Ë¶èÁôªÈå≤
                            </button>
                        </div>
                    </div>

                    {/* Staff List Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {!Array.isArray(staffList) || staffList.length === 0 ? (
                            <div className="col-span-full text-center py-12 text-gray-400">
                                <Icon name="users" size={48} className="mx-auto mb-4 opacity-30" />
                                <p className="text-sm">„Çπ„Çø„ÉÉ„Éï„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                <p className="text-xs mt-2">„Äå„Çπ„Çø„ÉÉ„ÉïÊñ∞Ë¶èÁôªÈå≤„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>
                        ) : (
                            staffList.map(staff => (
                                <div key={staff.id} className="bg-white border border-gold-100 rounded-xl p-5 hover:shadow-md transition-shadow group relative">
                                    <div className="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button
                                            onClick={() => handleEditClick(staff)}
                                            className="text-gray-300 hover:text-gold-500 p-1"
                                        >
                                            <Icon name="edit-2" size={16} />
                                        </button>
                                        <button
                                            onClick={() => handleDeleteClick(staff.id)}
                                            className="text-gray-300 hover:text-rose-500 p-1"
                                        >
                                            <Icon name="trash-2" size={16} />
                                        </button>
                                    </div>

                                    <div className="flex items-center mb-4">
                                        <div className="w-12 h-12 rounded-full bg-gold-50 border border-gold-200 flex items-center justify-center text-gold-700 font-bold text-lg">
                                            {staff.name ? staff.name.charAt(0) : '?'}
                                        </div>
                                        <div className="ml-3">
                                            <h3 className="font-bold text-brown-800">{staff.name}</h3>
                                            <p className="text-xs text-gray-500 bg-gray-100 inline-block px-2 py-0.5 rounded mt-1">
                                                {staff.role} - {stores.find(s => s.id === staff.storeId)?.name || 'Â∫óËàó‰∏çÊòé'}
                                            </p>
                                        </div>
                                    </div>
                                <div className="space-y-3">
                                    <div className="flex justify-between text-sm items-end">
                                        <span className="text-gray-500 text-xs">Â£≤‰∏äÂÆüÁ∏æ</span>
                                        <span className="font-bold text-brown-800">¬•{staff.sales.toLocaleString()}</span>
                                    </div>
                                    <div className="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                                        <div
                                            className={`h-full ${staff.sales >= staff.target ? 'bg-emerald-500' : 'bg-gold-500'}`}
                                            style={{width: `${staff.target > 0 ? Math.min(100, (staff.sales/staff.target)*100) : 0}%`}}
                                        ></div>
                                    </div>
                                    <div className="flex justify-between text-xs text-gray-400">
                                        <span>ÁõÆÊ®ô: ¬•{staff.target.toLocaleString()}</span>
                                        <span>{staff.target > 0 ? Math.round((staff.sales/staff.target)*100) : 0}%</span>
                                    </div>
                                    
                                    <div className="grid grid-cols-3 gap-2 pt-2 border-t border-gray-50 mt-2">
                                        <div className="text-center">
                                            <div className="text-xs text-gray-400">ÊåáÂêç</div>
                                            <div className="font-bold text-brown-800">{staff.nomination}</div>
                                        </div>
                                        <div className="text-center border-l border-gray-100">
                                            <div className="text-xs text-gray-400">„É™„Éî„Éº„Éà</div>
                                            <div className="font-bold text-brown-800">{staff.retention}%</div>
                                        </div>
                                        <div className="text-center border-l border-gray-100">
                                            <div className="text-xs text-gray-400">Âè£„Ç≥„ÉüË©ï‰æ°</div>
                                            <div className="font-bold text-gold-600 flex justify-center items-center">
                                                {staff.reviewScore || 0}<Icon name="star" size={10} className="ml-0.5 fill-current" />
                                            </div>
                                        </div>
                                    </div>
                                    <div className="mt-4 pt-4 border-t border-gray-100">
                                        <button
                                            onClick={() => {
                                                const staffUrl = `${window.location.origin}${window.location.pathname}?staffId=${staff.id}`;
                                                navigator.clipboard.writeText(staffUrl);
                                                alert(`„Çπ„Çø„ÉÉ„ÉïURL „Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ\n\n${staffUrl}\n\n„Åì„ÅÆURL„Çí ${staff.name} „Åï„Çì„Å´ÂÖ±Êúâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);
                                            }}
                                            className="w-full text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 py-2 rounded flex items-center justify-center transition-colors"
                                        >
                                            <Icon name="link" size={12} className="mr-1" />
                                            „Çπ„Çø„ÉÉ„ÉïURL„Çí„Ç≥„Éî„Éº
                                        </button>
                                    </div>
                                </div>
                            </div>
                            ))
                        )}
                    </div>

                    {/* Edit Modal */}
                    {isEditing && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md border border-gold-200">
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">
                                    {editingId ? '„Çπ„Çø„ÉÉ„ÉïÊÉÖÂ†±Á∑®ÈõÜ' : 'Êñ∞Ë¶è„Çπ„Çø„ÉÉ„ÉïÁôªÈå≤'}
                                </h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">Ê∞èÂêç</label>
                                        <input name="name" value={formData.name} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="Ê∞èÂêç" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÈõáÁî®ÂΩ¢ÊÖã</label>
                                            <select name="employmentType" value={formData.employmentType} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                                <option value="Ê≠£Á§æÂì°">Ê≠£Á§æÂì°</option>
                                                <option value="Â•ëÁ¥ÑÁ§æÂì°">Â•ëÁ¥ÑÁ§æÂì°</option>
                                                <option value="„Ç¢„É´„Éê„Ç§„Éà">„Ç¢„É´„Éê„Ç§„Éà</option>
                                                <option value="Ê•≠ÂãôÂßîË®ó">Ê•≠ÂãôÂßîË®ó</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÂΩπËÅ∑</label>
                                            <select name="role" value={formData.role} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                                <option value="Â∫óÈï∑">Â∫óÈï∑</option>
                                                <option value="„Ç∑„Éã„Ç¢">„Ç∑„Éã„Ç¢</option>
                                                <option value="„Çπ„Çø„ÉÉ„Éï">„Çπ„Çø„ÉÉ„Éï</option>
                                                <option value="Êñ∞‰∫∫">Êñ∞‰∫∫</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">ÊâÄÂ±ûÂ∫óËàó</label>
                                        <select name="storeId" value={formData.storeId} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                            {stores.map(store => (
                                                <option key={store.id} value={store.id}>{store.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-2">ÊñΩË°ìÂèØËÉΩ„Å™„É°„Éã„É•„Éº</label>
                                        <div className="space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded p-3 bg-gray-50">
                                            {menus.filter(m => m.availableStores.includes(formData.storeId)).map(menu => (
                                                <label key={menu.id} className="flex items-center cursor-pointer hover:bg-white px-2 py-1 rounded transition-colors">
                                                    <input
                                                        type="checkbox"
                                                        checked={Array.isArray(formData.availableMenus) && formData.availableMenus.includes(menu.id)}
                                                        onChange={(e) => {
                                                            const currentMenus = Array.isArray(formData.availableMenus) ? formData.availableMenus : [];
                                                            const newMenus = e.target.checked
                                                                ? [...currentMenus, menu.id]
                                                                : currentMenus.filter(id => id !== menu.id);
                                                            setFormData(prev => ({ ...prev, availableMenus: newMenus }));
                                                        }}
                                                        className="mr-2 accent-gold-500"
                                                    />
                                                    <span className="text-sm text-gray-700">{menu.name}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-3 mt-6">
                                    <button onClick={() => setIsEditing(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={handleSave} className="px-4 py-2 text-sm bg-gold-500 hover:bg-gold-600 text-white rounded font-medium shadow-sm">‰øùÂ≠ò„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Delete Confirmation Modal */}
                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm border border-rose-200">
                                <div className="flex items-center mb-4">
                                    <Icon name="alert-triangle" size={24} className="text-rose-500 mr-3" />
                                    <h3 className="text-lg font-bold text-brown-800">ÂâäÈô§„ÅÆÁ¢∫Ë™ç</h3>
                                </div>
                                <p className="text-sm text-gray-600 mb-6">
                                    „Åì„ÅÆ„Çπ„Çø„ÉÉ„Éï„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ
                                </p>
                                <div className="flex justify-end space-x-3">
                                    <button onClick={() => setShowDeleteConfirm(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={confirmDelete} className="px-4 py-2 text-sm bg-rose-500 hover:bg-rose-600 text-white rounded font-medium shadow-sm">ÂâäÈô§„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Customer & Ticket Management View ---
        const CustomerTicketManagementView = ({
            ticketMasterList,
            customerList,
            onUpdateTicketMaster,
            onAddTicketMaster,
            onDeleteTicketMaster,
            onUpdateCustomer,
            onAddCustomer,
            onDeleteCustomer,
            exportToCSV
        }) => {
            const [activeView, setActiveView] = useState('master'); // 'master' or 'customers'
            const [isEditing, setIsEditing] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [deletingId, setDeletingId] = useState(null);
            const [editingType, setEditingType] = useState('master'); // 'master' or 'customer'

            // Form State
            const [ticketFormData, setTicketFormData] = useState({
                name: '', sessions: 0, price: 0, validMonths: 0, description: ''
            });

            const [customerFormData, setCustomerFormData] = useState({
                name: '', phone: '', email: '', purchaseDate: '', ticketMasterId: '', remainingSessions: 0, expiryDate: '', storeId: 1
            });

            // Ticket Master Handlers
            const handleEditTicketMaster = (ticket) => {
                setIsEditing(true);
                setEditingId(ticket.id);
                setEditingType('master');
                setTicketFormData({ ...ticket });
            };

            const handleAddTicketMaster = () => {
                setIsEditing(true);
                setEditingId(null);
                setEditingType('master');
                setTicketFormData({
                    name: '', sessions: 5, price: 0, validMonths: 6, description: ''
                });
            };

            const handleDeleteTicketMaster = (id) => {
                setDeletingId(id);
                setEditingType('master');
                setShowDeleteConfirm(true);
            };

            // Customer Handlers
            const handleEditCustomer = (customer) => {
                setIsEditing(true);
                setEditingId(customer.id);
                setEditingType('customer');
                setCustomerFormData({ ...customer });
            };

            const handleAddCustomer = () => {
                setIsEditing(true);
                setEditingId(null);
                setEditingType('customer');
                const today = new Date().toISOString().split('T')[0];
                setCustomerFormData({
                    name: '', phone: '', email: '', purchaseDate: today, ticketMasterId: ticketMasterList[0]?.id || '', remainingSessions: 0, expiryDate: '', storeId: 1
                });
            };

            const handleDeleteCustomer = (id) => {
                setDeletingId(id);
                setEditingType('customer');
                setShowDeleteConfirm(true);
            };

            const confirmDelete = () => {
                if (editingType === 'master') {
                    onDeleteTicketMaster(deletingId);
                } else {
                    onDeleteCustomer(deletingId);
                }
                setShowDeleteConfirm(false);
                setDeletingId(null);
            };

            const handleSave = () => {
                if (editingType === 'master') {
                    if (editingId) {
                        onUpdateTicketMaster(editingId, ticketFormData);
                    } else {
                        onAddTicketMaster({ ...ticketFormData, id: Date.now() });
                    }
                } else {
                    // ÈÅ∏Êäû„Åï„Çå„ÅüÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„Åã„ÇâÊÆã„Çä„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞„ÇíË®≠ÂÆö
                    const selectedMaster = ticketMasterList.find(t => t.id === Number(customerFormData.ticketMasterId));
                    if (selectedMaster && !editingId) {
                        customerFormData.remainingSessions = selectedMaster.sessions;
                        // ÊúâÂäπÊúüÈôê„ÇíË®àÁÆó
                        const purchaseDate = new Date(customerFormData.purchaseDate);
                        purchaseDate.setMonth(purchaseDate.getMonth() + selectedMaster.validMonths);
                        customerFormData.expiryDate = purchaseDate.toISOString().split('T')[0];
                    }

                    if (editingId) {
                        onUpdateCustomer(editingId, customerFormData);
                    } else {
                        onAddCustomer({ ...customerFormData, id: Date.now() });
                    }
                }
                setIsEditing(false);
                setEditingId(null);
            };

            const handleTicketFormChange = (e) => {
                const { name, value } = e.target;
                const isTextField = ['name', 'description'].includes(name);
                const processedValue = isTextField ? value : normalizeNumberInput(value);
                setTicketFormData(prev => ({
                    ...prev,
                    [name]: isTextField ? processedValue : (processedValue === '' ? 0 : Number(processedValue))
                }));
            };

            const handleCustomerFormChange = (e) => {
                const { name, value } = e.target;
                const isTextField = ['name', 'phone', 'email', 'purchaseDate', 'expiryDate'].includes(name);
                const isSelectNumber = ['ticketMasterId', 'storeId'].includes(name);

                setCustomerFormData(prev => ({
                    ...prev,
                    [name]: isTextField ? value :
                            isSelectNumber ? Number(value) :
                            (() => {
                                const processedValue = normalizeNumberInput(value);
                                return processedValue === '' ? 0 : Number(processedValue);
                            })()
                }));
            };

            return (
                <div className="space-y-6">
                    {/* Tab Navigation */}
                    <div className="flex justify-between items-center">
                        <div className="flex gap-2 bg-white rounded-lg p-1 border border-gold-200">
                            <button
                                onClick={() => setActiveView('master')}
                                className={`px-6 py-2 rounded text-sm font-medium transition-colors ${
                                    activeView === 'master' ? 'bg-gold-500 text-white' : 'text-gray-600 hover:bg-gold-50'
                                }`}
                            >
                                ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÁÆ°ÁêÜ
                            </button>
                            <button
                                onClick={() => setActiveView('customers')}
                                className={`px-6 py-2 rounded text-sm font-medium transition-colors ${
                                    activeView === 'customers' ? 'bg-gold-500 text-white' : 'text-gray-600 hover:bg-gold-50'
                                }`}
                            >
                                È°ßÂÆ¢„ÉªË≥ºÂÖ•ËÄÖÁÆ°ÁêÜ
                            </button>
                        </div>
                        <div className="flex items-center space-x-2">
                            <button
                                onClick={() => exportToCSV(activeView === 'master' ? ticketMasterList : customerList, activeView === 'master' ? 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº.csv' : 'È°ßÂÆ¢„É™„Çπ„Éà.csv')}
                                className="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-sm flex items-center text-sm font-medium transition-colors"
                            >
                                <Icon name="download" size={16} className="mr-2" />
                                CSVÂá∫Âäõ
                            </button>
                            <button
                                onClick={activeView === 'master' ? handleAddTicketMaster : handleAddCustomer}
                                className="bg-gold-500 hover:bg-gold-600 text-white px-4 py-2 rounded-lg shadow-sm flex items-center text-sm font-medium transition-colors"
                            >
                                <Icon name="plus" size={16} className="mr-2" />
                                {activeView === 'master' ? 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºËøΩÂä†' : 'È°ßÂÆ¢ËøΩÂä†'}
                            </button>
                        </div>
                    </div>

                    {/* Master Ticket List */}
                    {activeView === 'master' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {ticketMasterList.length === 0 ? (
                                <div className="col-span-full text-center py-12 text-gray-400">
                                    <Icon name="ticket" size={48} className="mx-auto mb-4 opacity-30" />
                                    <p className="text-sm">ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                    <p className="text-xs mt-2">„ÄåÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºËøΩÂä†„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                </div>
                            ) : (
                                ticketMasterList.map(ticket => (
                                    <div key={ticket.id} className="bg-white border border-gold-100 rounded-xl p-5 hover:shadow-md transition-shadow group relative">
                                        <div className="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button
                                                onClick={() => handleEditTicketMaster(ticket)}
                                                className="text-gray-300 hover:text-gold-500 p-1"
                                            >
                                                <Icon name="edit-2" size={16} />
                                            </button>
                                            <button
                                                onClick={() => handleDeleteTicketMaster(ticket.id)}
                                                className="text-gray-300 hover:text-rose-500 p-1"
                                            >
                                                <Icon name="trash-2" size={16} />
                                            </button>
                                        </div>

                                        <div className="mb-4">
                                            <h3 className="font-bold text-brown-800 text-lg mb-1">{ticket.name}</h3>
                                            <p className="text-xs text-gray-500">{ticket.description}</p>
                                        </div>

                                        <div className="space-y-2 border-t border-gray-100 pt-3">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">ÂõûÊï∞</span>
                                                <span className="font-bold text-brown-800">{ticket.sessions}Âõû</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">‰æ°Ê†º</span>
                                                <span className="font-bold text-gold-600">¬•{ticket.price.toLocaleString()}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">ÊúâÂäπÊúüÈôê</span>
                                                <span className="font-bold text-brown-800">{ticket.validMonths}„É∂Êúà</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">1ÂõûÂçò‰æ°</span>
                                                <span className="text-emerald-600">¬•{Math.round(ticket.price / ticket.sessions).toLocaleString()}</span>
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    )}

                    {/* Customer List */}
                    {activeView === 'customers' && (
                        <div className="bg-white rounded-xl border border-gold-100 overflow-hidden">
                            {!Array.isArray(customerList) || customerList.length === 0 ? (
                                <div className="text-center py-12 text-gray-400">
                                    <Icon name="users" size={48} className="mx-auto mb-4 opacity-30" />
                                    <p className="text-sm">È°ßÂÆ¢„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                    <p className="text-xs mt-2">„ÄåÈ°ßÂÆ¢ËøΩÂä†„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                </div>
                            ) : (
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gold-50 border-b border-gold-100">
                                            <tr className="text-left text-xs text-gray-500 uppercase">
                                                <th className="py-3 px-4 font-medium">Ê∞èÂêç</th>
                                                <th className="py-3 px-4 font-medium">ÈÄ£Áµ°ÂÖà</th>
                                                <th className="py-3 px-4 font-medium">ÂõûÊï∞Âà∏</th>
                                                <th className="py-3 px-4 font-medium">ÊÆãÂõûÊï∞</th>
                                                <th className="py-3 px-4 font-medium">ÊúâÂäπÊúüÈôê</th>
                                                <th className="py-3 px-4 font-medium">Â∫óËàó</th>
                                                <th className="py-3 px-4 font-medium text-center">Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100">
                                            {customerList.map(customer => {
                                                const ticket = ticketMasterList.find(t => t.id === customer.ticketMasterId);
                                                const store = stores.find(s => s.id === customer.storeId);
                                                const isExpired = customer.expiryDate ? new Date(customer.expiryDate) < new Date() : false;

                                                return (
                                                    <tr key={customer.id} className="hover:bg-gold-50/30 text-sm">
                                                        <td className="py-3 px-4 font-medium text-brown-800">{customer.name}</td>
                                                        <td className="py-3 px-4 text-gray-600">
                                                            <div>{customer.phone}</div>
                                                            <div className="text-xs text-gray-400">{customer.email}</div>
                                                        </td>
                                                        <td className="py-3 px-4 text-gray-600">{ticket?.name || '‰∏çÊòé'}</td>
                                                        <td className="py-3 px-4">
                                                            <span className={`font-bold ${customer.remainingSessions > 0 ? 'text-emerald-600' : 'text-gray-400'}`}>
                                                                {customer.remainingSessions}Âõû
                                                            </span>
                                                        </td>
                                                        <td className="py-3 px-4">
                                                            <span className={`text-xs px-2 py-1 rounded ${isExpired ? 'bg-rose-100 text-rose-700' : 'bg-emerald-100 text-emerald-700'}`}>
                                                                {customer.expiryDate}
                                                            </span>
                                                        </td>
                                                        <td className="py-3 px-4 text-gray-600">{store?.name || '‰∏çÊòé'}</td>
                                                        <td className="py-3 px-4">
                                                            <div className="flex justify-center gap-2">
                                                                <button
                                                                    onClick={() => handleEditCustomer(customer)}
                                                                    className="text-gray-400 hover:text-gold-500 p-1"
                                                                >
                                                                    <Icon name="edit-2" size={16} />
                                                                </button>
                                                                <button
                                                                    onClick={() => handleDeleteCustomer(customer.id)}
                                                                    className="text-gray-400 hover:text-rose-500 p-1"
                                                                >
                                                                    <Icon name="trash-2" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Edit Modal - Ticket Master */}
                    {isEditing && editingType === 'master' && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md border border-gold-200">
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">
                                    {editingId ? 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÁ∑®ÈõÜ' : 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÊñ∞Ë¶èÁôªÈå≤'}
                                </h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">ÂõûÊï∞Âà∏Âêç</label>
                                        <input name="name" value={ticketFormData.name} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="‰æã: 5ÂõûÂà∏" />
                                    </div>
                                    <div className="grid grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÂõûÊï∞</label>
                                            <input type="text" inputMode="numeric" name="sessions" value={ticketFormData.sessions} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">‰æ°Ê†º(ÂÜÜ)</label>
                                            <input type="text" inputMode="numeric" name="price" value={ticketFormData.price} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÊúâÂäπ(Êúà)</label>
                                            <input type="text" inputMode="numeric" name="validMonths" value={ticketFormData.validMonths} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">Ë™¨Êòé</label>
                                        <textarea name="description" value={ticketFormData.description} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" rows="2" placeholder="ÂõûÊï∞Âà∏„ÅÆË™¨Êòé"></textarea>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-3 mt-6">
                                    <button onClick={() => setIsEditing(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={handleSave} className="px-4 py-2 text-sm bg-gold-500 hover:bg-gold-600 text-white rounded font-medium shadow-sm">‰øùÂ≠ò„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Modal - Customer */}
                    {isEditing && editingType === 'customer' && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md border border-gold-200">
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">
                                    {editingId ? 'È°ßÂÆ¢ÊÉÖÂ†±Á∑®ÈõÜ' : 'È°ßÂÆ¢Êñ∞Ë¶èÁôªÈå≤'}
                                </h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">Ê∞èÂêç</label>
                                        <input name="name" value={customerFormData.name} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="Ê∞èÂêç" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÈõªË©±Áï™Âè∑</label>
                                            <input name="phone" value={customerFormData.phone} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="090-1234-5678" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Â∫óËàó</label>
                                            <select name="storeId" value={customerFormData.storeId} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                                {stores.map(store => (
                                                    <option key={store.id} value={store.id}>{store.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                        <input name="email" type="email" value={customerFormData.email} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="example@email.com" />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">Ë≥ºÂÖ•ÂõûÊï∞Âà∏</label>
                                        <select name="ticketMasterId" value={customerFormData.ticketMasterId} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                            {ticketMasterList.map(ticket => (
                                                <option key={ticket.id} value={ticket.id}>{ticket.name} ({ticket.sessions}Âõû / ¬•{ticket.price.toLocaleString()})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Ë≥ºÂÖ•Êó•</label>
                                            <input name="purchaseDate" type="date" value={customerFormData.purchaseDate} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÊÆãÂõûÊï∞</label>
                                            <input name="remainingSessions" type="text" inputMode="numeric" value={customerFormData.remainingSessions} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-3 mt-6">
                                    <button onClick={() => setIsEditing(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={handleSave} className="px-4 py-2 text-sm bg-gold-500 hover:bg-gold-600 text-white rounded font-medium shadow-sm">‰øùÂ≠ò„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Delete Confirmation Modal */}
                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm border border-rose-200">
                                <div className="flex items-center mb-4">
                                    <Icon name="alert-triangle" size={24} className="text-rose-500 mr-3" />
                                    <h3 className="text-lg font-bold text-brown-800">ÂâäÈô§„ÅÆÁ¢∫Ë™ç</h3>
                                </div>
                                <p className="text-sm text-gray-600 mb-6">
                                    „Åì„ÅÆ{editingType === 'master' ? 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº' : 'È°ßÂÆ¢'}„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ
                                </p>
                                <div className="flex justify-end space-x-3">
                                    <button onClick={() => setShowDeleteConfirm(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={confirmDelete} className="px-4 py-2 text-sm bg-rose-500 hover:bg-rose-600 text-white rounded font-medium shadow-sm">ÂâäÈô§„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Menu Management View ---
        const MenuManagementView = ({ menuList, onUpdateMenu, onAddMenu, onDeleteMenu }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [deletingId, setDeletingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                price: 0,
                cost: 0,
                availableStores: []
            });

            const startEdit = (menu) => {
                setEditingId(menu.id);
                setFormData({
                    name: menu.name,
                    price: menu.price,
                    cost: menu.cost || 0,
                    availableStores: Array.isArray(menu.availableStores) ? menu.availableStores : []
                });
                setIsEditing(true);
            };

            const startAdd = () => {
                setEditingId(null);
                setFormData({
                    name: '',
                    price: 0,
                    cost: 0,
                    availableStores: []
                });
                setIsEditing(true);
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                const isTextField = ['name'].includes(name);

                setFormData(prev => ({
                    ...prev,
                    [name]: isTextField ? value : (() => {
                        const processedValue = normalizeNumberInput(value);
                        return processedValue === '' ? 0 : Number(processedValue);
                    })()
                }));
            };

            const handleStoreToggle = (storeId) => {
                setFormData(prev => ({
                    ...prev,
                    availableStores: prev.availableStores.includes(storeId)
                        ? prev.availableStores.filter(id => id !== storeId)
                        : [...prev.availableStores, storeId]
                }));
            };

            const handleSubmit = () => {
                if (!formData.name.trim()) {
                    alert('„É°„Éã„É•„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (editingId) {
                    onUpdateMenu(editingId, { ...formData, id: editingId });
                } else {
                    const newMenu = {
                        ...formData,
                        id: Date.now()
                    };
                    onAddMenu(newMenu);
                }
                setIsEditing(false);
                setEditingId(null);
            };

            const confirmDelete = () => {
                if (deletingId) {
                    onDeleteMenu(deletingId);
                }
                setShowDeleteConfirm(false);
                setDeletingId(null);
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-2xl font-bold text-brown-800 serif">„É°„Éã„É•„ÉºÁÆ°ÁêÜ</h2>
                            <p className="text-sm text-gray-600 mt-1">ÊñΩË°ì„É°„Éã„É•„Éº„ÅÆÁôªÈå≤„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§</p>
                        </div>
                        <button
                            onClick={startAdd}
                            className="flex items-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium shadow-sm transition-colors"
                        >
                            <Icon name="plus" size={18} className="mr-2" />
                            „É°„Éã„É•„ÉºÊñ∞Ë¶èÁôªÈå≤
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {!Array.isArray(menuList) || menuList.length === 0 ? (
                            <div className="col-span-full text-center py-12 text-gray-400">
                                <Icon name="package" size={48} className="mx-auto mb-4 opacity-30" />
                                <p className="text-sm">„É°„Éã„É•„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                <p className="text-xs mt-2">„Äå„É°„Éã„É•„ÉºÊñ∞Ë¶èÁôªÈå≤„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>
                        ) : (
                            menuList.map(menu => (
                                <div key={menu.id} className="bg-white border border-purple-100 rounded-xl p-5 hover:shadow-md transition-shadow group relative">
                                    <div className="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button
                                            onClick={() => startEdit(menu)}
                                            className="text-gray-300 hover:text-blue-500 p-1"
                                        >
                                            <Icon name="edit-2" size={16} />
                                        </button>
                                        <button
                                            onClick={() => { setDeletingId(menu.id); setShowDeleteConfirm(true); }}
                                            className="text-gray-300 hover:text-rose-500 p-1"
                                        >
                                            <Icon name="trash-2" size={16} />
                                        </button>
                                    </div>

                                    <div className="mb-4">
                                        <div className="w-12 h-12 rounded-full bg-purple-50 border border-purple-200 flex items-center justify-center text-purple-700 mb-3">
                                            <Icon name="package" size={24} />
                                        </div>
                                        <h3 className="font-bold text-brown-800 text-lg mb-1">{menu.name}</h3>
                                        <p className="text-2xl font-bold text-purple-600">¬•{menu.price.toLocaleString()}</p>

                                        {/* Âéü‰æ°„ÉªÁ≤óÂà©Ë°®Á§∫ */}
                                        {menu.cost !== undefined && menu.cost > 0 && (
                                            <div className="mt-3 pt-3 border-t border-purple-100 space-y-1">
                                                <div className="flex justify-between text-xs">
                                                    <span className="text-gray-500">Âéü‰æ°</span>
                                                    <span className="text-gray-700">¬•{menu.cost.toLocaleString()}</span>
                                                </div>
                                                <div className="flex justify-between text-xs">
                                                    <span className="text-gray-500">Á≤óÂà©</span>
                                                    <span className={`font-bold ${
                                                        ((menu.price - menu.cost) / menu.price * 100) >= 70 ? 'text-green-600' :
                                                        ((menu.price - menu.cost) / menu.price * 100) >= 50 ? 'text-yellow-600' :
                                                        'text-rose-600'
                                                    }`}>
                                                        ¬•{(menu.price - menu.cost).toLocaleString()}
                                                        ({Math.round((menu.price - menu.cost) / menu.price * 100)}%)
                                                    </span>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    <div className="pt-3 border-t border-gray-100">
                                        <p className="text-xs text-gray-500 mb-2">Êèê‰æõÂ∫óËàó</p>
                                        <div className="flex flex-wrap gap-1">
                                            {(menu.availableStores || []).map(storeId => {
                                                const store = stores.find(s => s.id === storeId);
                                                return store ? (
                                                    <span key={storeId} className="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded">
                                                        {store.name}
                                                    </span>
                                                ) : null;
                                            })}
                                        </div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>

                    {/* Á∑®ÈõÜ„Éï„Ç©„Éº„É†„É¢„Éº„ÉÄ„É´ */}
                    {isEditing && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl">
                                <h3 className="text-xl font-bold text-brown-800 mb-4 serif">
                                    {editingId ? '„É°„Éã„É•„ÉºÁ∑®ÈõÜ' : '„É°„Éã„É•„ÉºÊñ∞Ë¶èÁôªÈå≤'}
                                </h3>

                                <div className="space-y-4">
                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">„É°„Éã„É•„ÉºÂêç</label>
                                        <input
                                            type="text"
                                            name="name"
                                            value={formData.name}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-purple-500 outline-none"
                                            placeholder="‰æã: Ââ•Èõ¢„ÅÇ„Çä„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(È°î)"
                                        />
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">‰æ°Ê†ºÔºàÂÜÜÔºâ</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            name="price"
                                            value={formData.price}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-purple-500 outline-none"
                                        />
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">Âéü‰æ°ÔºàÂÜÜÔºâ</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            name="cost"
                                            value={formData.cost}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-purple-500 outline-none"
                                        />
                                        {formData.price > 0 && formData.cost > 0 && (
                                            <p className="text-xs text-gray-600 mt-1">
                                                Á≤óÂà©: ¬•{(formData.price - formData.cost).toLocaleString()}
                                                ({Math.round((formData.price - formData.cost) / formData.price * 100)}%)
                                            </p>
                                        )}
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-2 block">Êèê‰æõÂ∫óËàó</label>
                                        <div className="space-y-2">
                                            {stores.map(store => (
                                                <label key={store.id} className="flex items-center space-x-2 cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={formData.availableStores.includes(store.id)}
                                                        onChange={() => handleStoreToggle(store.id)}
                                                        className="rounded border-gray-300 text-purple-600 focus:ring-purple-500"
                                                    />
                                                    <span className="text-sm text-gray-700">{store.name}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="flex justify-end space-x-3 mt-6">
                                    <button
                                        onClick={() => setIsEditing(false)}
                                        className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded-lg"
                                    >
                                        „Ç≠„É£„É≥„Çª„É´
                                    </button>
                                    <button
                                        onClick={handleSubmit}
                                        className="px-4 py-2 text-sm bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium shadow-sm"
                                    >
                                        {editingId ? 'Êõ¥Êñ∞„Åô„Çã' : 'ÁôªÈå≤„Åô„Çã'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ */}
                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 max-w-sm w-full shadow-xl">
                                <div className="flex items-center space-x-3 mb-4">
                                    <div className="w-10 h-10 rounded-full bg-rose-100 flex items-center justify-center">
                                        <Icon name="alert-triangle" size={20} className="text-rose-600" />
                                    </div>
                                    <h3 className="text-lg font-bold text-brown-800">„É°„Éã„É•„ÉºÂâäÈô§</h3>
                                </div>
                                <p className="text-sm text-gray-600 mb-6">
                                    „Åì„ÅÆ„É°„Éã„É•„Éº„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ
                                </p>
                                <div className="flex justify-end space-x-3">
                                    <button onClick={() => setShowDeleteConfirm(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={confirmDelete} className="px-4 py-2 text-sm bg-rose-500 hover:bg-rose-600 text-white rounded font-medium shadow-sm">ÂâäÈô§„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Media Source Management View ---
        const MediaSourceManagementView = ({ mediaSourcesList, onUpdateMedia, onAddMedia, onDeleteMedia }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [deletingId, setDeletingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                newVisits: 0,
                repeatRate: 0,
                cpa: 0,
                sales: 0,
                adCost: 0
            });

            const startEdit = (media) => {
                setEditingId(media.id);
                setFormData({
                    name: media.name,
                    newVisits: media.newVisits || 0,
                    repeatRate: media.repeatRate || 0,
                    cpa: media.cpa || 0,
                    sales: media.sales || 0,
                    adCost: media.adCost || 0
                });
                setIsEditing(true);
            };

            const startAdd = () => {
                setEditingId(null);
                setFormData({
                    name: '',
                    newVisits: 0,
                    repeatRate: 0,
                    cpa: 0,
                    sales: 0,
                    adCost: 0
                });
                setIsEditing(true);
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                const isTextField = ['name'].includes(name);

                setFormData(prev => ({
                    ...prev,
                    [name]: isTextField ? value : (() => {
                        const processedValue = normalizeNumberInput(value);
                        return processedValue === '' ? 0 : Number(processedValue);
                    })()
                }));
            };

            const handleSubmit = () => {
                if (!formData.name.trim()) {
                    alert('Â™í‰ΩìÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (editingId) {
                    onUpdateMedia(editingId, { ...formData, id: editingId });
                } else {
                    const newMedia = {
                        ...formData,
                        id: Date.now()
                    };
                    onAddMedia(newMedia);
                }
                setIsEditing(false);
                setEditingId(null);
            };

            const confirmDelete = () => {
                if (deletingId) {
                    onDeleteMedia(deletingId);
                }
                setShowDeleteConfirm(false);
                setDeletingId(null);
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-2xl font-bold text-brown-800 serif">Â™í‰Ωì„Éû„Çπ„Çø„ÉºÁÆ°ÁêÜ</h2>
                            <p className="text-sm text-gray-600 mt-1">ÈõÜÂÆ¢Â™í‰Ωì„ÅÆÁôªÈå≤„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§</p>
                        </div>
                        <button
                            onClick={startAdd}
                            className="flex items-center px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg font-medium shadow-sm transition-colors"
                        >
                            <Icon name="plus" size={18} className="mr-2" />
                            Â™í‰ΩìÊñ∞Ë¶èÁôªÈå≤
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {!Array.isArray(mediaSourcesList) || mediaSourcesList.length === 0 ? (
                            <div className="col-span-full text-center py-12 text-gray-400">
                                <Icon name="megaphone" size={48} className="mx-auto mb-4 opacity-30" />
                                <p className="text-sm">Â™í‰Ωì„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                <p className="text-xs mt-2">„ÄåÂ™í‰ΩìÊñ∞Ë¶èÁôªÈå≤„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>
                        ) : (
                            mediaSourcesList.map(media => {
                                const roas = media.adCost > 0 ? ((media.sales / media.adCost) * 100).toFixed(0) : '-';
                                return (
                                    <div key={media.id} className="bg-white border border-amber-100 rounded-xl p-5 hover:shadow-md transition-shadow group relative">
                                        <div className="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button
                                                onClick={() => startEdit(media)}
                                                className="text-gray-300 hover:text-blue-500 p-1"
                                            >
                                                <Icon name="edit-2" size={16} />
                                            </button>
                                            <button
                                                onClick={() => { setDeletingId(media.id); setShowDeleteConfirm(true); }}
                                                className="text-gray-300 hover:text-rose-500 p-1"
                                            >
                                                <Icon name="trash-2" size={16} />
                                            </button>
                                        </div>

                                        <div className="mb-4">
                                            <div className="w-12 h-12 rounded-full bg-amber-50 border border-amber-200 flex items-center justify-center text-amber-700 mb-3">
                                                <Icon name="megaphone" size={24} />
                                            </div>
                                            <h3 className="font-bold text-brown-800 text-lg mb-1">{media.name}</h3>
                                        </div>

                                        <div className="space-y-2 text-sm">
                                            <div className="flex justify-between">
                                                <span className="text-gray-500">Êñ∞Ë¶èÈõÜÂÆ¢Êï∞</span>
                                                <span className="font-bold text-blue-600">{media.newVisits}‰∫∫</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-500">„É™„Éî„Éº„ÉàÁéá</span>
                                                <span className="font-bold text-emerald-600">{media.repeatRate}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-500">Áç≤ÂæóÂçò‰æ°(CPA)</span>
                                                <span className="font-bold">¬•{media.cpa.toLocaleString()}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-500">Â∫ÉÂëäË≤ª</span>
                                                <span className="font-bold text-rose-600">¬•{media.adCost.toLocaleString()}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-500">Â£≤‰∏äË≤¢ÁåÆ</span>
                                                <span className="font-bold text-purple-600">¬•{media.sales.toLocaleString()}</span>
                                            </div>
                                            {roas !== '-' && (
                                                <div className="flex justify-between pt-2 border-t border-gray-100">
                                                    <span className="text-gray-500 font-semibold">ROAS</span>
                                                    <span className={`font-bold ${
                                                        Number(roas) >= 300 ? 'text-green-600' :
                                                        Number(roas) >= 150 ? 'text-yellow-600' :
                                                        'text-red-600'
                                                    }`}>
                                                        {roas}%
                                                    </span>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>

                    {/* Á∑®ÈõÜ„Éï„Ç©„Éº„É†„É¢„Éº„ÉÄ„É´ */}
                    {isEditing && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl max-h-[90vh] overflow-y-auto">
                                <h3 className="text-xl font-bold text-brown-800 mb-4 serif">
                                    {editingId ? 'Â™í‰ΩìÁ∑®ÈõÜ' : 'Â™í‰ΩìÊñ∞Ë¶èÁôªÈå≤'}
                                </h3>

                                <div className="space-y-4">
                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">Â™í‰ΩìÂêç</label>
                                        <input
                                            type="text"
                                            name="name"
                                            value={formData.name}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-amber-500 outline-none"
                                            placeholder="‰æã: „Éõ„ÉÉ„Éà„Éö„ÉÉ„Éë„Éº"
                                        />
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">Êñ∞Ë¶èÈõÜÂÆ¢Êï∞Ôºà‰∫∫Ôºâ</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            name="newVisits"
                                            value={formData.newVisits}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-amber-500 outline-none"
                                        />
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">„É™„Éî„Éº„ÉàÁéáÔºà%Ôºâ</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            name="repeatRate"
                                            value={formData.repeatRate}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-amber-500 outline-none"
                                        />
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">Áç≤ÂæóÂçò‰æ°ÔºàÂÜÜÔºâ</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            name="cpa"
                                            value={formData.cpa}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-amber-500 outline-none"
                                        />
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">Â∫ÉÂëäË≤ªÔºàÂÜÜÔºâ</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            name="adCost"
                                            value={formData.adCost}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-amber-500 outline-none"
                                        />
                                    </div>

                                    <div>
                                        <label className="text-sm font-medium text-gray-700 mb-1 block">Â£≤‰∏äË≤¢ÁåÆÔºàÂÜÜÔºâ</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            name="sales"
                                            value={formData.sales}
                                            onChange={handleChange}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-amber-500 outline-none"
                                        />
                                    </div>
                                </div>

                                <div className="flex justify-end space-x-3 mt-6">
                                    <button
                                        onClick={() => setIsEditing(false)}
                                        className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded-lg"
                                    >
                                        „Ç≠„É£„É≥„Çª„É´
                                    </button>
                                    <button
                                        onClick={handleSubmit}
                                        className="px-4 py-2 text-sm bg-amber-600 hover:bg-amber-700 text-white rounded-lg font-medium shadow-sm"
                                    >
                                        {editingId ? 'Êõ¥Êñ∞„Åô„Çã' : 'ÁôªÈå≤„Åô„Çã'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ */}
                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 max-w-sm w-full shadow-xl">
                                <div className="flex items-center space-x-3 mb-4">
                                    <div className="w-10 h-10 rounded-full bg-rose-100 flex items-center justify-center">
                                        <Icon name="alert-triangle" size={20} className="text-rose-600" />
                                    </div>
                                    <h3 className="text-lg font-bold text-brown-800">Â™í‰ΩìÂâäÈô§</h3>
                                </div>
                                <p className="text-sm text-gray-600 mb-6">
                                    „Åì„ÅÆÂ™í‰Ωì„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ
                                </p>
                                <div className="flex justify-end space-x-3">
                                    <button onClick={() => setShowDeleteConfirm(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={confirmDelete} className="px-4 py-2 text-sm bg-rose-500 hover:bg-rose-600 text-white rounded font-medium shadow-sm">ÂâäÈô§„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Menu Analysis View ---
        const MenuAnalysisView = ({ menuSalesData }) => {
            if (!window.Recharts) return <div>Loading Charts...</div>;

            const safeMenuSalesData = Array.isArray(menuSalesData) ? menuSalesData : [];
            const hasData = safeMenuSalesData.length > 0;

            // „É°„Éã„É•„ÉºID„Åî„Å®„Å´„Éá„Éº„Çø„ÇíÈõÜÁ¥Ñ
            const aggregatedMenuData = useMemo(() => {
                if (!hasData) return [];

                const menuMap = {};
                safeMenuSalesData.forEach(entry => {
                    if (!menuMap[entry.menuId]) {
                        menuMap[entry.menuId] = {
                            menuId: entry.menuId,
                            menuName: entry.menuName,
                            count: 0,
                            sales: 0,
                            storeIds: new Set()
                        };
                    }
                    menuMap[entry.menuId].count += entry.count || 0;
                    menuMap[entry.menuId].sales += entry.sales || 0;
                    menuMap[entry.menuId].storeIds.add(entry.storeId);
                });

                return Object.values(menuMap).map(menu => ({
                    ...menu,
                    storeIds: Array.from(menu.storeIds)
                }));
            }, [safeMenuSalesData, hasData]);

            const totalMenuSales = hasData ? safeMenuSalesData.reduce((sum, m) => sum + (m.sales || 0), 0) : 0;
            const totalMenuCount = hasData ? safeMenuSalesData.reduce((sum, m) => sum + (m.count || 0), 0) : 0;
            const topMenu = aggregatedMenuData.length > 0 ? [...aggregatedMenuData].sort((a, b) => (b.count || 0) - (a.count || 0))[0] : null;

            if (!hasData) {
                return (
                    <div className="text-center py-12 text-gray-400">
                        <Icon name="package" size={48} className="mx-auto mb-4 opacity-30" />
                        <p className="text-lg font-bold text-brown-800">„É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                        <p className="text-sm mt-2">Êó•Ê¨°Â£≤‰∏ä„ÅÆÂÖ•Âäõ„ÇíË°å„ÅÜ„Å®„ÄÅ„É°„Éã„É•„ÉºÂà•„ÅÆÂàÜÊûê„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</p>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    {/* „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Ç´„Éº„Éâ */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <KpiCard
                            title="„É°„Éã„É•„ÉºÁ∑èÂ£≤‰∏ä"
                            value={`¬•${totalMenuSales.toLocaleString()}`}
                            subValue={`Á∑èÊñΩË°ìÂõûÊï∞: ${totalMenuCount}Âõû`}
                            trend={null}
                            icon="shopping-bag"
                            color="bg-gold-600"
                        />
                        <KpiCard
                            title="Âπ≥ÂùáÊñΩË°ìÂçò‰æ°"
                            value={totalMenuCount > 0 ? `¬•${Math.round(totalMenuSales / totalMenuCount).toLocaleString()}` : '¬•0'}
                            subValue="ÂÖ®„É°„Éã„É•„ÉºÂπ≥Âùá"
                            trend={null}
                            icon="trending-up"
                            color="bg-emerald-600"
                        />
                        <KpiCard
                            title="‰∫∫Ê∞óNo.1„É°„Éã„É•„Éº"
                            value={topMenu ? topMenu.menuName.substring(0, 10) : '-'}
                            subValue={topMenu ? `${topMenu.count}ÂõûÂÆüÊñΩ` : '„Éá„Éº„Çø„Å™„Åó'}
                            trend={null}
                            icon="award"
                            color="bg-rose-500"
                        />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„ÉÜ„Éº„Éñ„É´ */}
                        <Card>
                            <h2 className="text-lg font-bold text-brown-800 mb-6 serif">„É°„Éã„É•„ÉºÂà•Â£≤‰∏äË©≥Á¥∞</h2>
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="border-b border-gold-100 text-xs text-gray-500 uppercase">
                                            <th className="py-3 font-medium">„É°„Éã„É•„ÉºÂêç</th>
                                            <th className="py-3 font-medium text-right">ÂõûÊï∞</th>
                                            <th className="py-3 font-medium text-right">Â£≤‰∏ä</th>
                                            <th className="py-3 font-medium text-center">ÂØæÂøúÂ∫óËàó</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-sm divide-y divide-gray-50">
                                        {aggregatedMenuData.map((menu) => (
                                            <tr key={menu.menuId} className="hover:bg-gold-50/50">
                                                <td className="py-3 font-medium text-brown-800">{menu.menuName}</td>
                                                <td className="py-3 text-right">{menu.count}Âõû</td>
                                                <td className="py-3 text-right font-bold">¬•{menu.sales.toLocaleString()}</td>
                                                <td className="py-3 text-center">
                                                    <span className="text-xs px-2 py-1 bg-gray-100 rounded">
                                                        {menu.storeIds.length === 2 ? '‰∏°Â∫óËàó' : menu.storeIds.includes(1) ? 'Êñ∞ÂÆøÂ∫ó„ÅÆ„Åø' : 'Êñ∞ÂÆøÂçóÂè£Â∫ó„ÅÆ„Åø'}
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </Card>

                        {/* „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Ç∞„É©„Éï */}
                        <Card>
                            <h2 className="text-lg font-bold text-brown-800 mb-6 serif">„É°„Éã„É•„ÉºÂà•Â£≤‰∏äÊßãÊàêÊØî</h2>
                            <ResponsiveContainer width="100%" height={300}>
                                <BarChart data={aggregatedMenuData} layout="vertical">
                                    <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#e5e7eb" />
                                    <XAxis type="number" tick={{fontSize: 10}} tickFormatter={(val) => `¬•${val/10000}‰∏á`} />
                                    <YAxis type="category" dataKey="menuName" tick={{fontSize: 9}} width={120} />
                                    <Tooltip
                                        formatter={(value) => `¬•${value.toLocaleString()}`}
                                        contentStyle={{backgroundColor: '#fff', borderColor: '#d4af37'}}
                                    />
                                    <Bar dataKey="sales" name="Â£≤‰∏ä" fill="#d4af37" radius={[0, 4, 4, 0]} />
                                </BarChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>

                    {/* Â∫óËàóÈôêÂÆö„É°„Éã„É•„Éº„ÅÆÊ≥®ÊÑèÊõ∏„Åç */}
                    <Card className="bg-gold-50 border-gold-300">
                        <div className="flex items-start">
                            <Icon name="info" size={20} className="text-gold-600 mr-3 mt-1" />
                            <div>
                                <h3 className="font-bold text-brown-800 mb-2">Â∫óËàóÈôêÂÆö„É°„Éã„É•„ÉºÊÉÖÂ†±</h3>
                                <p className="text-sm text-gray-700">
                                    „Äå„Çà„ÇÇ„ÅéËí∏„Åó„Äç„Å®„Äå„Çª„É´„Éï„Éõ„ÉØ„Ç§„Éà„Éã„É≥„Ç∞„Äç„ÅØ<span className="font-bold text-gold-700">Êñ∞ÂÆøÂçóÂè£Â∫ó„Åß„ÅÆ„Åø</span>Êèê‰æõ„Åó„Å¶„ÅÑ„Çã„É°„Éã„É•„Éº„Åß„Åô„ÄÇ
                                    Êñ∞ÂÆøÂ∫ó„Åß„ÇÇÊèê‰æõ„ÇíÊ§úË®é„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅË®≠ÂÇôÊäïË≥á„Å®ÂèéÁõäÊÄß„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ
                                </p>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

        // --- Performance Input View ---
        const PerformanceInputView = ({ dailySalesData, setDailySalesData, menuSalesData, setMenuSalesData, staffList = [] }) => {
            const [activeInputTab, setActiveInputTab] = useState('daily'); // 'daily' or 'menu'

            // Êó•Ê¨°Â£≤‰∏äÂÖ•Âäõ„Éï„Ç©„Éº„É†
            const [dailyForm, setDailyForm] = useState({
                date: new Date().toISOString().split('T')[0],
                storeId: 1,
                staffId: null, // „Çπ„Çø„ÉÉ„ÉïÈÅ∏ÊäûÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
                spotSales: 0,
                ticketSales: 0,
                ticketUsage: 0,
                product: 0
            });

            // „É°„Éã„É•„ÉºÂ£≤‰∏äÂÖ•Âäõ„Éï„Ç©„Éº„É†
            const [menuForm, setMenuForm] = useState({
                date: new Date().toISOString().split('T')[0],
                menuId: 1,
                storeId: 1,
                staffId: null, // „Çπ„Çø„ÉÉ„ÉïÈÅ∏ÊäûÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
                count: 0
            });

            const handleDailyFormChange = (e) => {
                const { name, value } = e.target;
                const isTextField = ['date'].includes(name);
                const isSelectNumber = ['staffId', 'storeId', 'menuId'].includes(name);

                setDailyForm(prev => ({
                    ...prev,
                    [name]: isTextField ? value :
                            (name === 'staffId' && value === '') ? null :
                            isSelectNumber ? (value === '' ? null : Number(value)) :
                            (() => {
                                const processedValue = normalizeNumberInput(value);
                                return processedValue === '' ? 0 : Number(processedValue);
                            })()
                }));
            };

            const handleMenuFormChange = (e) => {
                const { name, value } = e.target;
                const isTextField = ['date'].includes(name);
                const isSelectNumber = ['staffId', 'storeId', 'menuId'].includes(name);

                setMenuForm(prev => ({
                    ...prev,
                    [name]: isTextField ? value :
                            (name === 'staffId' && value === '') ? null :
                            isSelectNumber ? (value === '' ? null : Number(value)) :
                            (() => {
                                const processedValue = normalizeNumberInput(value);
                                return processedValue === '' ? 0 : Number(processedValue);
                            })()
                }));
            };

            const handleDailySalesSubmit = () => {
                const store = stores.find(s => s.id === dailyForm.storeId);
                if (!store) {
                    alert('Â∫óËàó„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                const accountingSales = dailyForm.spotSales + dailyForm.ticketUsage + dailyForm.product;
                const cashIn = dailyForm.spotSales + dailyForm.ticketSales + dailyForm.product;

                const newEntry = {
                    day: new Date(dailyForm.date).getDate() + 'Êó•',
                    date: dailyForm.date,
                    storeId: dailyForm.storeId,
                    storeName: store.name,
                    spotSales: dailyForm.spotSales,
                    ticketSales: dailyForm.ticketSales,
                    ticketUsage: dailyForm.ticketUsage,
                    product: dailyForm.product,
                    accountingSales,
                    cashIn,
                    storeData: [{
                        storeId: dailyForm.storeId,
                        storeName: store.name,
                        spotSales: dailyForm.spotSales,
                        ticketSales: dailyForm.ticketSales,
                        ticketUsage: dailyForm.ticketUsage,
                        product: dailyForm.product,
                        accountingSales,
                        cashIn
                    }]
                };

                setDailySalesData(prev => [...prev, newEntry]);

                // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
                setDailyForm({
                    date: new Date().toISOString().split('T')[0],
                    storeId: 1,
                    spotSales: 0,
                    ticketSales: 0,
                    ticketUsage: 0,
                    product: 0
                });

                alert('Êó•Ê¨°Â£≤‰∏ä„ÇíÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºÅ');
            };

            const handleMenuSalesSubmit = () => {
                const menu = menus.find(m => m.id === menuForm.menuId);
                const sales = menuForm.count * menu.price;

                const newEntry = {
                    id: Date.now(),
                    date: menuForm.date,
                    menuId: menuForm.menuId,
                    menuName: menu.name,
                    storeId: menuForm.storeId,
                    count: menuForm.count,
                    sales,
                    availableStores: menu.availableStores
                };

                setMenuSalesData(prev => [...prev, newEntry]);

                // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
                setMenuForm({
                    date: new Date().toISOString().split('T')[0],
                    menuId: 1,
                    storeId: 1,
                    count: 0
                });

                alert('„É°„Éã„É•„ÉºÂ£≤‰∏ä„ÇíÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºÅ');
            };

            return (
                <div className="space-y-6">
                    {/* „Çø„ÉñÂàá„ÇäÊõø„Åà */}
                    <div className="flex gap-2 bg-white rounded-lg p-1 border border-gold-200 inline-flex">
                        <button
                            onClick={() => setActiveInputTab('daily')}
                            className={`px-6 py-2 rounded text-sm font-medium transition-colors ${
                                activeInputTab === 'daily' ? 'bg-gold-500 text-white' : 'text-gray-600 hover:bg-gold-50'
                            }`}
                        >
                            Êó•Ê¨°Â£≤‰∏äÂÖ•Âäõ
                        </button>
                        <button
                            onClick={() => setActiveInputTab('menu')}
                            className={`px-6 py-2 rounded text-sm font-medium transition-colors ${
                                activeInputTab === 'menu' ? 'bg-gold-500 text-white' : 'text-gray-600 hover:bg-gold-50'
                            }`}
                        >
                            „É°„Éã„É•„ÉºÂà•Â£≤‰∏äÂÖ•Âäõ
                        </button>
                    </div>

                    {/* Êó•Ê¨°Â£≤‰∏äÂÖ•Âäõ„Éï„Ç©„Éº„É† */}
                    {activeInputTab === 'daily' && (
                        <Card>
                            <h2 className="text-xl font-bold text-brown-800 mb-6 serif">Êó•Ê¨°Â£≤‰∏ä„Éá„Éº„ÇøÂÖ•Âäõ</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Êó•‰ªò</label>
                                    <input
                                        type="date"
                                        name="date"
                                        value={dailyForm.date}
                                        onChange={handleDailyFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Â∫óËàó</label>
                                    <select
                                        name="storeId"
                                        value={dailyForm.storeId}
                                        onChange={handleDailyFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                    >
                                        {stores.map(store => (
                                            <option key={store.id} value={store.id}>{store.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">„Çπ„Çø„ÉÉ„ÉïÔºà‰ªªÊÑèÔºâ</label>
                                    <select
                                        name="staffId"
                                        value={dailyForm.staffId || ''}
                                        onChange={handleDailyFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                    >
                                        <option value="">ÂÖ®‰ΩìÔºà„Çπ„Çø„ÉÉ„ÉïÊåáÂÆö„Å™„ÅóÔºâ</option>
                                        {(staffList || []).filter(s => s.storeId === dailyForm.storeId).map(staff => (
                                            <option key={staff.id} value={staff.id}>{staff.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÈÉΩÂ∫¶Êâï„ÅÑÂ£≤‰∏ä (ÂÜÜ)</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        name="spotSales"
                                        value={dailyForm.spotSales}
                                        onChange={handleDailyFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                        placeholder="0"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÂõûÊï∞Âà∏Ë≤©Â£≤ (ÂÜÜ)</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        name="ticketSales"
                                        value={dailyForm.ticketSales}
                                        onChange={handleDailyFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                        placeholder="0"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÂõûÊï∞Âà∏Ê∂àÂåñ (ÂÜÜ)</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        name="ticketUsage"
                                        value={dailyForm.ticketUsage}
                                        onChange={handleDailyFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                        placeholder="0"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Áâ©Ë≤©Â£≤‰∏ä (ÂÜÜ)</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        name="product"
                                        value={dailyForm.product}
                                        onChange={handleDailyFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                        placeholder="0"
                                    />
                                </div>
                            </div>
                            <div className="mt-6 flex justify-end">
                                <button
                                    onClick={handleDailySalesSubmit}
                                    className="px-6 py-3 bg-gold-500 hover:bg-gold-600 text-white font-bold rounded-lg shadow-sm transition-colors"
                                >
                                    ÁôªÈå≤„Åô„Çã
                                </button>
                            </div>
                        </Card>
                    )}

                    {/* „É°„Éã„É•„ÉºÂà•Â£≤‰∏äÂÖ•Âäõ„Éï„Ç©„Éº„É† */}
                    {activeInputTab === 'menu' && (
                        <Card>
                            <h2 className="text-xl font-bold text-brown-800 mb-6 serif">„É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Éá„Éº„ÇøÂÖ•Âäõ</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Êó•‰ªò</label>
                                    <input
                                        type="date"
                                        name="date"
                                        value={menuForm.date}
                                        onChange={handleMenuFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Â∫óËàó</label>
                                    <select
                                        name="storeId"
                                        value={menuForm.storeId}
                                        onChange={handleMenuFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                    >
                                        {stores.map(store => (
                                            <option key={store.id} value={store.id}>{store.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">„É°„Éã„É•„Éº</label>
                                    <select
                                        name="menuId"
                                        value={menuForm.menuId}
                                        onChange={handleMenuFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                    >
                                        {menus.filter(m => m.availableStores.includes(menuForm.storeId)).map(menu => (
                                            <option key={menu.id} value={menu.id}>
                                                {menu.name} (¬•{menu.price.toLocaleString()})
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">„Çπ„Çø„ÉÉ„ÉïÔºà‰ªªÊÑèÔºâ</label>
                                    <select
                                        name="staffId"
                                        value={menuForm.staffId || ''}
                                        onChange={handleMenuFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                    >
                                        <option value="">ÂÖ®‰ΩìÔºà„Çπ„Çø„ÉÉ„ÉïÊåáÂÆö„Å™„ÅóÔºâ</option>
                                        {(staffList || []).filter(s => s.storeId === menuForm.storeId).map(staff => (
                                            <option key={staff.id} value={staff.id}>{staff.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">ÊñΩË°ìÂõûÊï∞</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        name="count"
                                        value={menuForm.count}
                                        onChange={handleMenuFormChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-gold-500 outline-none"
                                        placeholder="0"
                                    />
                                </div>
                            </div>
                            <div className="mt-6 bg-gold-50 rounded-lg p-4">
                                <p className="text-sm text-gray-700">
                                    <strong>‰∫àÊÉ≥Â£≤‰∏ä:</strong> ¬•{(menuForm.count * (menus.find(m => m.id === menuForm.menuId)?.price || 0)).toLocaleString()}
                                </p>
                            </div>
                            <div className="mt-6 flex justify-end">
                                <button
                                    onClick={handleMenuSalesSubmit}
                                    className="px-6 py-3 bg-gold-500 hover:bg-gold-600 text-white font-bold rounded-lg shadow-sm transition-colors"
                                >
                                    ÁôªÈå≤„Åô„Çã
                                </button>
                            </div>
                        </Card>
                    )}

                    {/* ÁôªÈå≤Ê∏à„Åø„Éá„Éº„Çø‰∏ÄË¶ß */}
                    {activeInputTab === 'daily' && dailySalesData.length > 0 && (
                        <Card>
                            <h3 className="text-lg font-bold text-brown-800 mb-4">ÁôªÈå≤Ê∏à„ÅøÊó•Ê¨°Â£≤‰∏äÔºàÊúÄÊñ∞10‰ª∂Ôºâ</h3>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead className="bg-gold-50 border-b border-gold-100">
                                        <tr className="text-left text-xs text-gray-500 uppercase">
                                            <th className="py-2 px-3">Êó•‰ªò</th>
                                            <th className="py-2 px-3">Â∫óËàó</th>
                                            <th className="py-2 px-3 text-right">ÈÉΩÂ∫¶Êâï„ÅÑ</th>
                                            <th className="py-2 px-3 text-right">ÂõûÊï∞Âà∏Ë≤©Â£≤</th>
                                            <th className="py-2 px-3 text-right">ÂõûÊï∞Âà∏Ê∂àÂåñ</th>
                                            <th className="py-2 px-3 text-right">Áâ©Ë≤©</th>
                                            <th className="py-2 px-3 text-right">ÂêàË®àÂ£≤‰∏ä</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {dailySalesData.slice(-10).reverse().map((item, index) => (
                                            <tr key={index} className="hover:bg-gold-50/30">
                                                <td className="py-2 px-3">{item.date || item.day}</td>
                                                <td className="py-2 px-3">{item.storeName}</td>
                                                <td className="py-2 px-3 text-right">¬•{item.spotSales.toLocaleString()}</td>
                                                <td className="py-2 px-3 text-right">¬•{item.ticketSales.toLocaleString()}</td>
                                                <td className="py-2 px-3 text-right">¬•{item.ticketUsage.toLocaleString()}</td>
                                                <td className="py-2 px-3 text-right">¬•{item.product.toLocaleString()}</td>
                                                <td className="py-2 px-3 text-right font-bold">¬•{item.accountingSales.toLocaleString()}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </Card>
                    )}

                    {activeInputTab === 'menu' && menuSalesData.length > 0 && (
                        <Card>
                            <h3 className="text-lg font-bold text-brown-800 mb-4">ÁôªÈå≤Ê∏à„Åø„É°„Éã„É•„ÉºÂ£≤‰∏äÔºàÊúÄÊñ∞10‰ª∂Ôºâ</h3>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead className="bg-gold-50 border-b border-gold-100">
                                        <tr className="text-left text-xs text-gray-500 uppercase">
                                            <th className="py-2 px-3">Êó•‰ªò</th>
                                            <th className="py-2 px-3">„É°„Éã„É•„Éº</th>
                                            <th className="py-2 px-3 text-right">ÂõûÊï∞</th>
                                            <th className="py-2 px-3 text-right">Â£≤‰∏ä</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {(menuSalesData || []).slice(-10).reverse().map((item, index) => (
                                            <tr key={index} className="hover:bg-gold-50/30">
                                                <td className="py-2 px-3">{item.date}</td>
                                                <td className="py-2 px-3">{item.menuName}</td>
                                                <td className="py-2 px-3 text-right">{item.count}Âõû</td>
                                                <td className="py-2 px-3 text-right font-bold">¬•{item.sales.toLocaleString()}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </Card>
                    )}
                </div>
            );
        };

        // --- Simulation View (Reused but Styled) ---
        // --- Calendar View Component ---
        const CalendarView = ({ dailySalesData, staffId = null }) => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(null);

            // Êúà„ÅÆÊúÄÂàù„ÅÆÊó•„Å®ÊúÄÂæå„ÅÆÊó•„ÇíÂèñÂæó
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);

            // „Ç´„É¨„É≥„ÉÄ„Éº„Ç∞„É™„ÉÉ„Éâ„ÇíÁîüÊàê
            const startingDayOfWeek = firstDay.getDay(); // 0 (Êó•Êõú) ~ 6 (ÂúüÊõú)
            const daysInMonth = lastDay.getDate();

            // Êúà„ÇíÂ§âÊõ¥
            const changeMonth = (offset) => {
                setCurrentDate(new Date(year, month + offset, 1));
                setSelectedDate(null);
            };

            // Êó•‰ªò„Åã„ÇâÂ£≤‰∏ä„Éá„Éº„Çø„ÇíÂèñÂæóÔºàdateÂΩ¢Âºè: '2026-01-15'„Å´ÂØæÂøúÔºâ
            const getSalesForDay = (day) => {
                if (!dailySalesData || dailySalesData.length === 0) return null;

                // ÁèæÂú®„ÅÆÂπ¥Êúà„Å®Êó•„Åã„ÇâÊó•‰ªòÊñáÂ≠óÂàó„ÇíÁîüÊàê
                const targetDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

                // „Åù„ÅÆÊó•„ÅÆÂ£≤‰∏ä„Éá„Éº„Çø„Çí„Åô„Åπ„Å¶ÂèñÂæó„Åó„Å¶„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
                let dayData = dailySalesData.filter(d => {
                    if (!d.date) return false;
                    return d.date === targetDate;
                });

                // „Çπ„Çø„ÉÉ„ÉïID„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Ôºà„Çπ„Çø„ÉÉ„Éï„É¢„Éº„Éâ„ÅÆÂ†¥ÂêàÔºâ
                if (staffId) {
                    dayData = dayData.filter(d => d.staffId === staffId);
                }

                if (dayData.length === 0) return null;

                // Âêå„ÅòÊó•„ÅÆË§áÊï∞„Éá„Éº„Çø„ÇíÂêàÁÆó
                const aggregated = {
                    date: targetDate,
                    spotSales: 0,
                    ticketSales: 0,
                    ticketUsage: 0,
                    product: 0,
                    accountingSales: 0,
                    cashIn: 0,
                    storeData: []
                };

                // Â∫óËàóÂà•„Éá„Éº„Çø„ÇíÈõÜË®à
                const storeMap = {};

                dayData.forEach(d => {
                    aggregated.spotSales += d.spotSales || 0;
                    aggregated.ticketSales += d.ticketSales || 0;
                    aggregated.ticketUsage += d.ticketUsage || 0;
                    aggregated.product += d.product || 0;
                    aggregated.accountingSales += d.accountingSales || 0;
                    aggregated.cashIn += d.cashIn || 0;

                    // Â∫óËàóÂà•„Éá„Éº„Çø„ÇíÈõÜË®à
                    if (d.storeId && d.storeName) {
                        if (!storeMap[d.storeId]) {
                            storeMap[d.storeId] = {
                                storeId: d.storeId,
                                storeName: d.storeName,
                                cashIn: 0,
                                accountingSales: 0
                            };
                        }
                        storeMap[d.storeId].cashIn += d.cashIn || 0;
                        storeMap[d.storeId].accountingSales += d.accountingSales || 0;
                    }
                });

                aggregated.storeData = Object.values(storeMap);

                return aggregated;
            };

            // Â£≤‰∏äÈ°ç„Å´Âøú„Åò„ÅüËâ≤„ÇíËøî„Åô
            const getSalesColor = (sales) => {
                if (!sales) return 'bg-gray-50 border-gray-200';
                if (sales.cashIn >= 250000) return 'bg-rose-50 border-rose-300';
                if (sales.cashIn >= 180000) return 'bg-orange-50 border-orange-300';
                if (sales.cashIn >= 120000) return 'bg-yellow-50 border-yellow-300';
                if (sales.cashIn >= 60000) return 'bg-blue-50 border-blue-300';
                return 'bg-gray-50 border-gray-200';
            };

            // „Ç´„É¨„É≥„ÉÄ„Éº„Ç∞„É™„ÉÉ„Éâ„Çí‰ΩúÊàê
            const calendarDays = [];

            // Á©∫ÁôΩ„Çª„É´ÔºàÊúà„ÅÆÊúÄÂàù„ÅÆÊõúÊó•„Åæ„ÅßÔºâ
            for (let i = 0; i < startingDayOfWeek; i++) {
                calendarDays.push(<div key={`empty-${i}`} className="min-h-24"></div>);
            }

            // Êó•‰ªò„Çª„É´
            for (let day = 1; day <= daysInMonth; day++) {
                const salesData = getSalesForDay(day);
                const colorClass = getSalesColor(salesData);
                const isSelected = selectedDate === day;

                calendarDays.push(
                    <div
                        key={day}
                        onClick={() => setSelectedDate(day)}
                        className={`min-h-24 border-2 rounded-lg p-2 cursor-pointer transition-all ${colorClass} ${
                            isSelected ? 'ring-2 ring-gold-500 scale-105' : 'hover:shadow-md'
                        }`}
                    >
                        <div className="font-bold text-brown-800 text-sm mb-1">{day}</div>
                        {salesData ? (
                            <div className="space-y-1">
                                <div className="text-xs text-gray-600">
                                    ¬•{salesData.cashIn.toLocaleString()}
                                </div>
                                <div className="text-xs text-gray-500">
                                    {salesData.storeData && salesData.storeData.length > 0 ? (
                                        salesData.storeData.map((store, idx) => (
                                            <div key={idx}>{store.storeName}: ¬•{store.cashIn.toLocaleString()}</div>
                                        ))
                                    ) : null}
                                </div>
                            </div>
                        ) : (
                            <div className="text-xs text-gray-400">‰ºëÊ•≠</div>
                        )}
                    </div>
                );
            }

            const selectedDayData = selectedDate ? getSalesForDay(selectedDate) : null;

            return (
                <div className="space-y-6">
                    <Card>
                        {/* „Éò„ÉÉ„ÉÄ„Éº */}
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold text-brown-800 serif">
                                    {staffId ? '„Éû„Ç§„Ç´„É¨„É≥„ÉÄ„Éº' : '„Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº'}
                                </h2>
                                <p className="text-sm text-gray-500 mt-1">
                                    {staffId ? 'ÂÄã‰∫∫„ÅÆÊúàÈñìÂ£≤‰∏ä„ÇíÁ¢∫Ë™ç' : 'ÊúàÈñìÂ£≤‰∏ä„Çí‰∏ÄÁõÆ„ÅßÁ¢∫Ë™ç'}
                                </p>
                            </div>
                            <div className="flex items-center space-x-4">
                                <button
                                    onClick={() => changeMonth(-1)}
                                    className="p-2 hover:bg-gray-100 rounded-full transition-colors"
                                >
                                    <Icon name="chevron-left" size={20} />
                                </button>
                                <h3 className="text-xl font-bold text-brown-800 min-w-[160px] text-center">
                                    {year}Âπ¥{month + 1}Êúà
                                </h3>
                                <button
                                    onClick={() => changeMonth(1)}
                                    className="p-2 hover:bg-gray-100 rounded-full transition-colors"
                                >
                                    <Icon name="chevron-right" size={20} />
                                </button>
                            </div>
                        </div>

                        {/* ÊõúÊó•„Éò„ÉÉ„ÉÄ„Éº */}
                        <div className="grid grid-cols-7 gap-2 mb-2">
                            {['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'].map(day => (
                                <div key={day} className="text-center font-bold text-sm text-gray-600 py-2">
                                    {day}
                                </div>
                            ))}
                        </div>

                        {/* „Ç´„É¨„É≥„ÉÄ„Éº„Ç∞„É™„ÉÉ„Éâ */}
                        <div className="grid grid-cols-7 gap-2">
                            {calendarDays}
                        </div>

                        {/* Âá°‰æã */}
                        <div className="mt-6 pt-6 border-t border-gray-200">
                            <p className="text-xs text-gray-600 mb-2 font-semibold">Â£≤‰∏ä„É¨„Éô„É´</p>
                            <div className="flex flex-wrap gap-3 text-xs">
                                <div className="flex items-center space-x-2">
                                    <div className="w-4 h-4 rounded bg-gray-50 border border-gray-200"></div>
                                    <span className="text-gray-600">‰ºëÊ•≠</span>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <div className="w-4 h-4 rounded bg-blue-50 border border-blue-300"></div>
                                    <span className="text-gray-600">~¬•60k</span>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <div className="w-4 h-4 rounded bg-yellow-50 border border-yellow-300"></div>
                                    <span className="text-gray-600">¬•60k~¬•120k</span>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <div className="w-4 h-4 rounded bg-orange-50 border border-orange-300"></div>
                                    <span className="text-gray-600">¬•120k~¬•180k</span>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <div className="w-4 h-4 rounded bg-rose-50 border border-rose-300"></div>
                                    <span className="text-gray-600">¬•180k~</span>
                                </div>
                            </div>
                        </div>
                    </Card>

                    {/* ÈÅ∏Êäû„Åï„Çå„ÅüÊó•„ÅÆË©≥Á¥∞ */}
                    {selectedDayData && (
                        <Card>
                            <h3 className="text-lg font-bold text-brown-800 mb-4">
                                {month + 1}Êúà{selectedDate}Êó•„ÅÆË©≥Á¥∞
                            </h3>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <p className="text-xs text-gray-600 mb-1">ÈÉΩÂ∫¶Êâï„ÅÑ</p>
                                    <p className="text-xl font-bold text-blue-700">¬•{selectedDayData.spotSales.toLocaleString()}</p>
                                </div>
                                <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <p className="text-xs text-gray-600 mb-1">ÂõûÊï∞Âà∏Ë≤©Â£≤</p>
                                    <p className="text-xl font-bold text-purple-700">¬•{selectedDayData.ticketSales.toLocaleString()}</p>
                                </div>
                                <div className="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                                    <p className="text-xs text-gray-600 mb-1">ÂõûÊï∞Âà∏Ê∂àÂåñ</p>
                                    <p className="text-xl font-bold text-emerald-700">¬•{selectedDayData.ticketUsage.toLocaleString()}</p>
                                </div>
                                <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                    <p className="text-xs text-gray-600 mb-1">Áâ©Ë≤©</p>
                                    <p className="text-xl font-bold text-amber-700">¬•{selectedDayData.product.toLocaleString()}</p>
                                </div>
                                <div className="bg-rose-50 border border-rose-200 rounded-lg p-4">
                                    <p className="text-xs text-gray-600 mb-1">‰ºöË®à‰∏äÂ£≤‰∏ä</p>
                                    <p className="text-xl font-bold text-rose-700">¬•{selectedDayData.accountingSales.toLocaleString()}</p>
                                </div>
                                <div className="bg-gold-50 border border-gold-200 rounded-lg p-4">
                                    <p className="text-xs text-gray-600 mb-1">„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥</p>
                                    <p className="text-xl font-bold text-gold-600">¬•{selectedDayData.cashIn.toLocaleString()}</p>
                                </div>
                            </div>

                            {/* Â∫óËàóÂà•„Éá„Éº„Çø */}
                            {selectedDayData.storeData && selectedDayData.storeData.length > 0 && (
                                <div className="mt-6 pt-6 border-t border-gray-200">
                                    <h4 className="text-sm font-bold text-gray-700 mb-3">Â∫óËàóÂà•</h4>
                                    <div className="space-y-3">
                                        {selectedDayData.storeData.map((store, idx) => (
                                            <div key={idx} className="bg-gray-50 rounded-lg p-3">
                                                <p className="font-bold text-brown-800 mb-2">{store.storeName}</p>
                                                <div className="grid grid-cols-2 gap-2 text-xs">
                                                    <div>„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥: ¬•{store.cashIn.toLocaleString()}</div>
                                                    <div>‰ºöË®à‰∏äÂ£≤‰∏ä: ¬•{store.accountingSales.toLocaleString()}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </Card>
                    )}
                </div>
            );
        };

        const SimulationView = ({ staffList, onUpdateStaff }) => {
            const [selectedStaffId, setSelectedStaffId] = useState(null);
            const [targetSales, setTargetSales] = useState(0);
            const [manualTarget, setManualTarget] = useState('');

            // Êñ∞Ë¶è„Éª„É™„Éî„Éº„ÉàÈñ¢ÈÄ£
            const [newCustomers, setNewCustomers] = useState(0);
            const [repeatCustomers, setRepeatCustomers] = useState(0);
            const [newCustomerPrice, setNewCustomerPrice] = useState(0);
            const [repeatCustomerPrice, setRepeatCustomerPrice] = useState(0);

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çπ„Çø„ÉÉ„Éï
            const selectedStaff = selectedStaffId ? staffList.find(s => s.id === selectedStaffId) : null;

            // ÂõûÊï∞Âà∏Èñ¢ÈÄ£
            const [ticketPurchaseRate, setTicketPurchaseRate] = useState(0); // %
            const [ticketAvgPrice, setTicketAvgPrice] = useState(0);

            // „Ç™„Éó„Ç∑„Éß„É≥„ÉªÁâ©Ë≤©
            const [optionRate, setOptionRate] = useState(0); // %
            const [optionAvgPrice, setOptionAvgPrice] = useState(0);
            const [productSalesPerMonth, setProductSalesPerMonth] = useState(0);

            // Ë®àÁÆó
            const totalCustomers = newCustomers + repeatCustomers;
            const ticketPurchaseCount = Math.round((newCustomers * ticketPurchaseRate) / 100);
            const optionCount = Math.round((totalCustomers * optionRate) / 100);

            const newCustomerSales = newCustomers * newCustomerPrice;
            const repeatCustomerSales = repeatCustomers * repeatCustomerPrice;
            const ticketSales = ticketPurchaseCount * ticketAvgPrice;
            const optionSales = optionCount * optionAvgPrice;

            const projectedSales = newCustomerSales + repeatCustomerSales + optionSales + productSalesPerMonth;
            const displayTarget = manualTarget ? Number(manualTarget) : targetSales;
            const progress = Math.min(100, (projectedSales / displayTarget) * 100);
            const diff = projectedSales - displayTarget;

            return (
                <div className="space-y-6">
                    <Card>
                        <div className="flex justify-between items-start mb-6">
                            <div>
                                <h2 className="text-xl font-bold text-brown-800 mb-2 serif">Ë©≥Á¥∞Â£≤‰∏ä„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</h2>
                                <p className="text-sm text-gray-500">Êñ∞Ë¶è„Éª„É™„Éî„Éº„Éà„ÉªÂõûÊï∞Âà∏„Éª„Ç™„Éó„Ç∑„Éß„É≥„ÉªÁâ©Ë≤©„ÇíÂê´„ÇÅ„ÅüË©≥Á¥∞„Å™Â£≤‰∏ä‰∫àÊ∏¨</p>
                            </div>
                            <div className="w-64">
                                <label className="text-xs font-medium text-gray-700 mb-1 block">„Çπ„Çø„ÉÉ„Éï„ÇíÈÅ∏Êäû</label>
                                <select
                                    value={selectedStaffId || ''}
                                    onChange={(e) => setSelectedStaffId(e.target.value ? Number(e.target.value) : null)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-gold-500 outline-none bg-white"
                                >
                                    <option value="">ÂÖ®‰ΩìÁõÆÊ®ô</option>
                                    {(staffList || []).map(staff => (
                                        <option key={staff.id} value={staff.id}>
                                            {staff.name} ({staff.role})
                                        </option>
                                    ))}
                                </select>
                                {selectedStaff && (
                                    <div className="mt-2 space-y-2">
                                        <div className="text-xs text-gray-600">
                                            <p>ÁèæÂú®„ÅÆÂ£≤‰∏ä: <span className="font-bold text-brown-800">¬•{selectedStaff.sales.toLocaleString()}</span></p>
                                            <p>ÁèæÂú®„ÅÆÁõÆÊ®ô: <span className="font-bold text-brown-800">¬•{selectedStaff.target.toLocaleString()}</span></p>
                                        </div>
                                        <button
                                            onClick={() => {
                                                if (onUpdateStaff && selectedStaff) {
                                                    const newTarget = displayTarget || 0;
                                                    onUpdateStaff(selectedStaff.id, {
                                                        ...selectedStaff,
                                                        target: newTarget
                                                    });
                                                    alert(`${selectedStaff.name}„ÅÆÁõÆÊ®ô„Çí¬•${newTarget.toLocaleString()}„Å´Ë®≠ÂÆö„Åó„Åæ„Åó„Åü`);
                                                }
                                            }}
                                            className="w-full px-3 py-2 bg-gold-600 hover:bg-gold-700 text-white text-xs font-medium rounded-lg transition-colors shadow-sm"
                                        >
                                            „Åì„ÅÆÁõÆÊ®ô„Çí{selectedStaff.name}„Å´Ë®≠ÂÆö
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Â∑¶„Ç´„É©„É†: ÁõÆÊ®ôË®≠ÂÆö */}
                            <div className="space-y-6">
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-2">ÊúàÈñìÁõÆÊ®ôÂ£≤‰∏äÔºàÊâãÂÖ•ÂäõÂèØÔºâ</label>
                                    <div className="relative">
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">¬•</span>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            value={manualTarget || targetSales}
                                            onChange={(e) => setManualTarget(normalizeNumberInput(e.target.value))}
                                            className="w-full pl-8 pr-4 py-2 text-xl font-bold text-brown-800 bg-gold-50 border border-gold-200 rounded-lg focus:border-gold-500 outline-none"
                                        />
                                    </div>
                                </div>

                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-blue-900 mb-3">Êñ∞Ë¶èÈ°ßÂÆ¢</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">Êñ∞Ë¶è‰∫∫Êï∞</label>
                                            <input type="text" inputMode="numeric" value={newCustomers} onChange={(e) => setNewCustomers(Number(normalizeNumberInput(e.target.value)) || 0)} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-blue-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">Êñ∞Ë¶èÂçò‰æ°</label>
                                            <input type="text" inputMode="numeric" value={newCustomerPrice} onChange={(e) => setNewCustomerPrice(Number(normalizeNumberInput(e.target.value)) || 0)} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-blue-500 outline-none" />
                                        </div>
                                        <div className="pt-2 border-t border-blue-200 text-sm font-bold text-blue-900">
                                            Â£≤‰∏ä: ¬•{newCustomerSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-emerald-900 mb-3">„É™„Éî„Éº„ÉàÈ°ßÂÆ¢</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">„É™„Éî„Éº„Éà‰∫∫Êï∞</label>
                                            <input type="text" inputMode="numeric" value={repeatCustomers} onChange={(e) => setRepeatCustomers(Number(normalizeNumberInput(e.target.value)) || 0)} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-emerald-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">„É™„Éî„Éº„ÉàÂçò‰æ°</label>
                                            <input type="text" inputMode="numeric" value={repeatCustomerPrice} onChange={(e) => setRepeatCustomerPrice(Number(normalizeNumberInput(e.target.value)) || 0)} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-emerald-500 outline-none" />
                                        </div>
                                        <div className="pt-2 border-t border-emerald-200 text-sm font-bold text-emerald-900">
                                            Â£≤‰∏ä: ¬•{repeatCustomerSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* ‰∏≠Â§Æ„Ç´„É©„É†: ÂõûÊï∞Âà∏„Éª„Ç™„Éó„Ç∑„Éß„É≥ */}
                            <div className="space-y-6">
                                <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-purple-900 mb-3">ÂõûÊï∞Âà∏Ë≤©Â£≤</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">Ë≥ºÂÖ•ÁéáÔºàÊñ∞Ë¶è„ÅÆ%Ôºâ</label>
                                            <div className="flex items-center gap-2">
                                                <input type="range" min="0" max="100" value={ticketPurchaseRate} onChange={(e) => setTicketPurchaseRate(Number(e.target.value))} className="flex-1 accent-purple-500" />
                                                <span className="text-sm font-bold text-purple-900 w-12">{ticketPurchaseRate}%</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">ÂõûÊï∞Âà∏Âπ≥Âùá‰æ°Ê†º</label>
                                            <input type="text" inputMode="numeric" value={ticketAvgPrice} onChange={(e) => setTicketAvgPrice(Number(normalizeNumberInput(e.target.value)) || 0)} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-purple-500 outline-none" />
                                        </div>
                                        <div className="text-xs text-gray-500">
                                            ‰∫àÊÉ≥Ë≥ºÂÖ•‰ª∂Êï∞: {ticketPurchaseCount}‰ª∂
                                        </div>
                                        <div className="pt-2 border-t border-purple-200 text-sm font-bold text-purple-900">
                                            Â£≤‰∏ä: ¬•{ticketSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-amber-900 mb-3">„Ç™„Éó„Ç∑„Éß„É≥ËøΩÂä†</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">ËøΩÂä†ÁéáÔºàÂÖ®‰Ωì„ÅÆ%Ôºâ</label>
                                            <div className="flex items-center gap-2">
                                                <input type="range" min="0" max="100" value={optionRate} onChange={(e) => setOptionRate(Number(e.target.value))} className="flex-1 accent-amber-500" />
                                                <span className="text-sm font-bold text-amber-900 w-12">{optionRate}%</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">„Ç™„Éó„Ç∑„Éß„É≥Âπ≥Âùá‰æ°Ê†º</label>
                                            <input type="text" inputMode="numeric" value={optionAvgPrice} onChange={(e) => setOptionAvgPrice(Number(normalizeNumberInput(e.target.value)) || 0)} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-amber-500 outline-none" />
                                        </div>
                                        <div className="text-xs text-gray-500">
                                            ‰∫àÊÉ≥ËøΩÂä†‰ª∂Êï∞: {optionCount}‰ª∂
                                        </div>
                                        <div className="pt-2 border-t border-amber-200 text-sm font-bold text-amber-900">
                                            Â£≤‰∏ä: ¬•{optionSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-rose-50 border border-rose-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-rose-900 mb-3">Áâ©Ë≤©Â£≤‰∏ä</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">ÊúàÈñìÁâ©Ë≤©Â£≤‰∏ä</label>
                                            <input type="text" inputMode="numeric" value={productSalesPerMonth} onChange={(e) => setProductSalesPerMonth(Number(normalizeNumberInput(e.target.value)) || 0)} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-rose-500 outline-none" />
                                        </div>
                                        <div className="pt-2 border-t border-rose-200 text-sm font-bold text-rose-900">
                                            Â£≤‰∏ä: ¬•{productSalesPerMonth.toLocaleString()}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Âè≥„Ç´„É©„É†: ÁµêÊûúË°®Á§∫ */}
                            <div className="space-y-6">
                                <div className="relative bg-gradient-to-br from-brown-900 to-brown-800 rounded-xl p-6 text-white overflow-hidden">
                                    <div className="absolute top-0 right-0 w-48 h-48 bg-gold-500 opacity-10 rounded-full blur-3xl -mr-12 -mt-12"></div>
                                    <div className="relative z-10">
                                        <h3 className="text-gold-200 font-medium mb-1 text-sm">‰∫àÊ∏¨ÊúàÈñìÂ£≤‰∏ä</h3>
                                        <div className="text-4xl font-bold mb-4">¬•{projectedSales.toLocaleString()}</div>

                                        <div className="w-full bg-white/20 rounded-full h-2 mb-4">
                                            <div
                                                className={`h-full rounded-full transition-all duration-500 ${diff >= 0 ? 'bg-gold-400' : 'bg-white/50'}`}
                                                style={{width: `${progress}%`}}
                                            ></div>
                                        </div>

                                        {diff < 0 ? (
                                            <div className="bg-white/10 backdrop-blur rounded p-3 border border-white/10">
                                                <p className="text-sm font-bold text-rose-300 mb-1 flex items-center"><Icon name="alert-triangle" size={14} className="mr-2"/> ÁõÆÊ®ôÊú™ÈÅîÊàê</p>
                                                <p className="text-xs text-gray-300">‰∏çË∂≥È°ç: ¬•{Math.abs(diff).toLocaleString()}</p>
                                            </div>
                                        ) : (
                                            <div className="bg-white/10 backdrop-blur rounded p-3 border border-white/10">
                                                <p className="text-sm font-bold text-emerald-300 mb-1 flex items-center"><Icon name="check" size={14} className="mr-2"/> ÁõÆÊ®ôÈÅîÊàê</p>
                                                <p className="text-xs text-gray-300">‰ΩôÂâ∞: +¬•{diff.toLocaleString()}</p>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="bg-white border border-gold-200 rounded-xl p-5">
                                    <h4 className="font-bold text-brown-800 mb-4 text-sm">Â£≤‰∏äÂÜÖË®≥</h4>
                                    <div className="space-y-2 text-sm">
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Êñ∞Ë¶èÈ°ßÂÆ¢Â£≤‰∏ä</span>
                                            <span className="font-bold text-blue-700">¬•{newCustomerSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">„É™„Éî„Éº„ÉàÂ£≤‰∏ä</span>
                                            <span className="font-bold text-emerald-700">¬•{repeatCustomerSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">ÂõûÊï∞Âà∏Â£≤‰∏ä</span>
                                            <span className="font-bold text-purple-700">¬•{ticketSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">„Ç™„Éó„Ç∑„Éß„É≥Â£≤‰∏ä</span>
                                            <span className="font-bold text-amber-700">¬•{optionSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Áâ©Ë≤©Â£≤‰∏ä</span>
                                            <span className="font-bold text-rose-700">¬•{productSalesPerMonth.toLocaleString()}</span>
                                        </div>
                                        <div className="pt-3 mt-3 border-t border-gray-200 flex justify-between items-center">
                                            <span className="font-bold text-brown-800">ÂêàË®à</span>
                                            <span className="font-bold text-xl text-gold-600">¬•{projectedSales.toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-gold-50 border border-gold-200 rounded-lg p-4">
                                    <h4 className="font-bold text-brown-800 mb-3 text-sm">„Çµ„Éû„É™„Éº</h4>
                                    <div className="space-y-1 text-xs text-gray-700">
                                        <p>‚Ä¢ Á∑èÊù•ÂÆ¢‰∫àÊ∏¨: {totalCustomers}‰∫∫</p>
                                        <p>‚Ä¢ ÂÆ¢Âçò‰æ°Âπ≥Âùá: ¬•{Math.round(projectedSales / totalCustomers).toLocaleString()}</p>
                                        <p>‚Ä¢ ÂõûÊï∞Âà∏Ë≥ºÂÖ•‰∫àÊ∏¨: {ticketPurchaseCount}‰ª∂</p>
                                        <p>‚Ä¢ „Ç™„Éó„Ç∑„Éß„É≥ËøΩÂä†‰∫àÊ∏¨: {optionCount}‰ª∂</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };


        // --- Master Data Management View ---
        const MasterDataManagementView = ({ onSelectMaster }) => {
            const masterOptions = [
                {
                    id: 'staff',
                    icon: 'users',
                    title: '„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ',
                    description: '„Çπ„Çø„ÉÉ„Éï„ÅÆËøΩÂä†„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§',
                    bgColor: 'bg-blue-50',
                    borderColor: 'border-blue-200',
                    hoverBorder: 'hover:border-blue-400',
                    iconBg: 'bg-blue-100',
                    iconBgHover: 'group-hover:bg-blue-200',
                    iconColor: 'text-blue-600',
                    chevronColor: 'text-blue-400',
                    chevronHover: 'group-hover:text-blue-600'
                },
                {
                    id: 'menus',
                    icon: 'package',
                    title: '„É°„Éã„É•„ÉºÁÆ°ÁêÜ',
                    description: '„É°„Éã„É•„Éº„ÅÆËøΩÂä†„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§',
                    bgColor: 'bg-purple-50',
                    borderColor: 'border-purple-200',
                    hoverBorder: 'hover:border-purple-400',
                    iconBg: 'bg-purple-100',
                    iconBgHover: 'group-hover:bg-purple-200',
                    iconColor: 'text-purple-600',
                    chevronColor: 'text-purple-400',
                    chevronHover: 'group-hover:text-purple-600'
                },
                {
                    id: 'customers',
                    icon: 'heart',
                    title: 'È°ßÂÆ¢„ÉªÂõûÊï∞Âà∏ÁÆ°ÁêÜ',
                    description: 'È°ßÂÆ¢ÊÉÖÂ†±„Å®ÂõûÊï∞Âà∏„ÅÆÁÆ°ÁêÜ',
                    bgColor: 'bg-rose-50',
                    borderColor: 'border-rose-200',
                    hoverBorder: 'hover:border-rose-400',
                    iconBg: 'bg-rose-100',
                    iconBgHover: 'group-hover:bg-rose-200',
                    iconColor: 'text-rose-600',
                    chevronColor: 'text-rose-400',
                    chevronHover: 'group-hover:text-rose-600'
                },
                {
                    id: 'media',
                    icon: 'megaphone',
                    title: 'Â™í‰Ωì„Éû„Çπ„Çø„Éº',
                    description: 'ÈõÜÂÆ¢Â™í‰Ωì„ÅÆËøΩÂä†„ÉªÁ∑®ÈõÜ',
                    bgColor: 'bg-amber-50',
                    borderColor: 'border-amber-200',
                    hoverBorder: 'hover:border-amber-400',
                    iconBg: 'bg-amber-100',
                    iconBgHover: 'group-hover:bg-amber-200',
                    iconColor: 'text-amber-600',
                    chevronColor: 'text-amber-400',
                    chevronHover: 'group-hover:text-amber-600'
                },
            ];

            return (
                <div className="space-y-6">
                    <Card>
                        <div className="mb-6">
                            <h2 className="text-2xl font-bold text-brown-800 serif mb-2">„Éû„Çπ„Çø„Éº„Éá„Éº„ÇøÁÆ°ÁêÜ</h2>
                            <p className="text-sm text-gray-600">Âü∫Êú¨„Éá„Éº„Çø„ÅÆÁôªÈå≤„ÉªÁ∑®ÈõÜ„ÇíË°å„ÅÑ„Åæ„Åô</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {masterOptions.map(option => (
                                <button
                                    key={option.id}
                                    onClick={() => onSelectMaster(option.id)}
                                    className={`group p-6 rounded-xl border-2 transition-all duration-200 text-left hover:shadow-lg hover:scale-[1.02] ${option.bgColor} ${option.borderColor} ${option.hoverBorder}`}
                                >
                                    <div className="flex items-start space-x-4">
                                        <div className={`p-3 rounded-lg ${option.iconBg} ${option.iconBgHover} transition-colors`}>
                                            <Icon name={option.icon} size={24} className={option.iconColor} />
                                        </div>
                                        <div className="flex-1">
                                            <h3 className="text-lg font-bold text-brown-800 mb-1 group-hover:text-brown-900">
                                                {option.title}
                                            </h3>
                                            <p className="text-sm text-gray-600">{option.description}</p>
                                        </div>
                                        <Icon name="chevron-right" size={20} className={`${option.chevronColor} ${option.chevronHover} transition-colors`} />
                                    </div>
                                </button>
                            ))}
                        </div>

                        <div className="mt-8 p-4 bg-gold-50 rounded-lg border border-gold-200">
                            <div className="flex items-start space-x-3">
                                <Icon name="info" size={20} className="text-gold-600 flex-shrink-0 mt-0.5" />
                                <div className="text-sm text-brown-800">
                                    <p className="font-bold mb-2">„Éû„Çπ„Çø„Éº„Éá„Éº„Çø„Å´„Å§„ÅÑ„Å¶</p>
                                    <ul className="space-y-1 text-gray-600">
                                        <li>‚Ä¢ „Éû„Çπ„Çø„Éº„Éá„Éº„Çø„ÅØÂÆüÁ∏æÂÖ•Âäõ„ÇÑÂàÜÊûê„ÅÆÂü∫Á§é„Å®„Å™„ÇãÈáçË¶Å„Å™„Éá„Éº„Çø„Åß„Åô</li>
                                        <li>‚Ä¢ Â§âÊõ¥ÂÜÖÂÆπ„ÅØ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åô„Çã„Åì„Å®„ÅßÊ∞∏Á∂öÂåñ„Åï„Çå„Åæ„Åô</li>
                                        <li>‚Ä¢ ÂâäÈô§„Åó„Åü„Éá„Éº„Çø„ÅØÂæ©ÂÖÉ„Åß„Åç„Åæ„Åõ„Çì„ÅÆ„Åß„ÅîÊ≥®ÊÑè„Åè„Å†„Åï„ÅÑ</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };


        // --- App Layout & Navigation ---

        const Layout = () => {
            // URL„Éë„É©„É°„Éº„Çø„Åã„Çâ„Çπ„Çø„ÉÉ„ÉïID„ÇíÂèñÂæó
            const urlParams = new URLSearchParams(window.location.search);
            const staffIdFromUrl = urlParams.get('staffId');
            const isStaffMode = staffIdFromUrl !== null;
            const currentStaffId = isStaffMode ? Number(staffIdFromUrl) : null;

            const [activeTab, setActiveTab] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [mobileOptimized, setMobileOptimized] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [selectedMaster, setSelectedMaster] = useState(null);
            const [darkMode, setDarkMode] = useState(() => {
                const saved = localStorage.getItem('darkMode');
                return saved ? JSON.parse(saved) : false;
            });
            const [staffList, setStaffList] = useState(initialStaffData);
            const [menuList, setMenuList] = useState(menus);
            const [ticketMasterList, setTicketMasterList] = useState(initialTicketMasterData);
            const [customerList, setCustomerList] = useState(initialCustomerData);
            const [mediaSourcesList, setMediaSourcesList] = useState(initialMediaSourcesData);
            const [dailySalesData, setDailySalesData] = useState(initialDailySalesData);
            const [menuSalesData, setMenuSalesData] = useState(initialMenuSalesData);
            const [isSaving, setIsSaving] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [saveMessage, setSaveMessage] = useState('');
            const currentDate = new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });

            // ÁèæÂú®„ÅÆ„Çπ„Çø„ÉÉ„ÉïÊÉÖÂ†±„ÇíÂèñÂæó
            const currentStaff = isStaffMode ? staffList.find(s => s.id === currentStaffId) : null;

            // „Éû„Çπ„Çø„Éº„Éá„Éº„ÇøÈÅ∏ÊäûÊôÇ„ÅÆÂá¶ÁêÜ
            const handleSelectMaster = (masterId) => {
                setSelectedMaster(masterId);
                setActiveTab(masterId); // staff, menus, customers, media
                setMobileMenuOpen(false); // „É¢„Éê„Ç§„É´„É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
            };

            // „Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜÈñ¢Êï∞
            const updateStaff = (id, newData) => {
                setStaffList(prev => prev.map(staff => staff.id === id ? newData : staff));
            };

            const addStaff = (newData) => {
                setStaffList(prev => [...prev, newData]);
            };

            const deleteStaff = (id) => {
                setStaffList(prev => prev.filter(staff => staff.id !== id));
            };

            // ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÁÆ°ÁêÜÈñ¢Êï∞
            const updateTicketMaster = (id, newData) => {
                setTicketMasterList(prev => prev.map(ticket => ticket.id === id ? newData : ticket));
            };

            const addTicketMaster = (newData) => {
                setTicketMasterList(prev => [...prev, newData]);
            };

            const deleteTicketMaster = (id) => {
                setTicketMasterList(prev => prev.filter(ticket => ticket.id !== id));
            };

            // È°ßÂÆ¢ÁÆ°ÁêÜÈñ¢Êï∞
            const updateCustomer = (id, newData) => {
                setCustomerList(prev => prev.map(customer => customer.id === id ? newData : customer));
            };

            const addCustomer = (newData) => {
                setCustomerList(prev => [...prev, newData]);
            };

            const deleteCustomer = (id) => {
                setCustomerList(prev => prev.filter(customer => customer.id !== id));
            };

            // Â™í‰Ωì„ÇΩ„Éº„ÇπÁÆ°ÁêÜÈñ¢Êï∞
            const updateMediaSource = (id, newData) => {
                setMediaSourcesList(prev => prev.map(media => media.id === id ? newData : media));
            };

            const addMediaSource = (newData) => {
                setMediaSourcesList(prev => [...prev, newData]);
            };

            const deleteMediaSource = (id) => {
                setMediaSourcesList(prev => prev.filter(media => media.id !== id));
            };

            // „É°„Éã„É•„ÉºÁÆ°ÁêÜÈñ¢Êï∞
            const updateMenu = (id, newData) => {
                setMenuList(prev => prev.map(menu => menu.id === id ? newData : menu));
            };

            const addMenu = (newData) => {
                setMenuList(prev => [...prev, newData]);
            };

            const deleteMenu = (id) => {
                setMenuList(prev => prev.filter(menu => menu.id !== id));
            };

            // CSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊ©üËÉΩ
            const handleExportToCSV = (data, filename) => {
                if (!data || data.length === 0) {
                    alert('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                    return;
                }

                // „Éò„ÉÉ„ÉÄ„ÉºË°å„ÇíÂèñÂæó
                const headers = Object.keys(data[0]);

                // CSV„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÁîüÊàê
                let csv = '\uFEFF'; // UTF-8 BOMÔºàExcel„ÅßÊñáÂ≠óÂåñ„ÅëÈò≤Ê≠¢Ôºâ
                csv += headers.join(',') + '\n';

                data.forEach(row => {
                    const values = headers.map(header => {
                        let value = row[header];

                        // ÈÖçÂàó„ÅÆÂ†¥Âêà„ÅØJSONÊñáÂ≠óÂàó„Å´Â§âÊèõ
                        if (Array.isArray(value)) {
                            value = JSON.stringify(value);
                        }

                        // null/undefined„ÅÆÂ†¥Âêà„ÅØÁ©∫ÊñáÂ≠ó
                        if (value === null || value === undefined) {
                            value = '';
                        }

                        // ÊñáÂ≠óÂàó„ÅÆÂ†¥Âêà„ÄÅ„Ç´„É≥„Éû„ÇÑÊîπË°å„ÇíÂê´„ÇÄÂ†¥Âêà„ÅØ„ÉÄ„Éñ„É´„ÇØ„Ç©„Éº„Éà„ÅßÂõ≤„ÇÄ
                        value = String(value);
                        if (value.includes(',') || value.includes('\n') || value.includes('"')) {
                            value = '"' + value.replace(/"/g, '""') + '"';
                        }

                        return value;
                    });
                    csv += values.join(',') + '\n';
                });

                // Blob„Çí‰ΩúÊàê„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);

                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´ÂÖ®„Éá„Éº„Çø„Çí‰øùÂ≠ò
            const handleSaveToSpreadsheet = async () => {
                setIsSaving(true);
                setSaveMessage('');

                try {
                    await saveToSpreadsheet('saveAllData', {
                        staffData: staffList,
                        ticketData: ticketMasterList,
                        customerData: customerList,
                        menuData: menuList,
                        mediaData: mediaSourcesList,
                        dailySalesData: dailySalesData,
                        menuSalesData: menuSalesData
                    });

                    setSaveMessage('‚úì „Éá„Éº„Çø„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    setTimeout(() => setSaveMessage(''), 3000);
                } catch (error) {
                    setSaveMessage('‚úó ‰øùÂ≠ò„Ç®„É©„Éº: ' + error.message);
                }

                setIsSaving(false);
            };

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂÖ®„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            const handleLoadFromSpreadsheet = async () => {
                setIsLoading(true);
                setSaveMessage('');

                // GAS URL„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                if (!GAS_WEB_APP_URL || GAS_WEB_APP_URL === 'YOUR_GAS_WEB_APP_URL_HERE') {
                    setSaveMessage('‚úó „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàURL„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇindex.html„ÅÆGAS_WEB_APP_URL„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    setIsLoading(false);
                    return;
                }

                try {
                    const response = await fetch(GAS_WEB_APP_URL + '?action=getAllData', {
                        method: 'GET'
                    });

                    // „É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
                    if (!response.ok) {
                        throw new Error(`HTTP„Ç®„É©„Éº: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();

                    if (result.success && result.data) {
                        // „Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                        if (result.data.staff) {
                            setStaffList(result.data.staff);
                        }
                        if (result.data.ticketMasters) {
                            setTicketMasterList(result.data.ticketMasters);
                        }
                        if (result.data.customers) {
                            setCustomerList(result.data.customers);
                        }
                        if (result.data.menus) {
                            setMenuList(result.data.menus);
                        }
                        if (result.data.mediaSources) {
                            setMediaSourcesList(result.data.mediaSources);
                        }

                        setSaveMessage('‚úì „Éá„Éº„Çø„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                        setTimeout(() => setSaveMessage(''), 3000);
                    } else {
                        const errorMsg = result.error || '„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                        setSaveMessage('‚úó ' + errorMsg);
                        console.error('Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', result);
                    }
                } catch (error) {
                    console.error('Ë™≠„ÅøËæº„Åø„Ç®„É©„ÉºË©≥Á¥∞:', error);
                    let errorMessage = 'Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº: ';

                    if (error.message.includes('Failed to fetch')) {
                        errorMessage += '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÄÇ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàURL„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    } else if (error.message.includes('JSON')) {
                        errorMessage += '„É¨„Çπ„Éù„É≥„ÇπÂΩ¢Âºè„Ç®„É©„Éº„ÄÇGAS„Çπ„ÇØ„É™„Éó„Éà„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    } else {
                        errorMessage += error.message;
                    }

                    setSaveMessage('‚úó ' + errorMessage);
                }

                setIsLoading(false);
            };

            // „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
            const toggleDarkMode = () => {
                setDarkMode(prev => {
                    const newMode = !prev;
                    localStorage.setItem('darkMode', JSON.stringify(newMode));
                    return newMode;
                });
            };

            // „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÈÅ©Áî®
            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            // ÂàùÂõû„É≠„Éº„ÉâÊôÇ„Å´„Éá„Éº„Çø„ÇíËá™ÂãïÂèñÂæóÔºàÂÖ®„É¢„Éº„ÉâÂØæÂøúÔºâ
            useEffect(() => {
                // GAS URL„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅËá™ÂãïÁöÑ„Å´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
                if (GAS_WEB_APP_URL && GAS_WEB_APP_URL !== 'YOUR_GAS_WEB_APP_URL_HERE') {
                    handleLoadFromSpreadsheet();
                }
            }, []); // ÂàùÂõû„Éû„Ç¶„É≥„ÉàÊôÇ„ÅÆ„ÅøÂÆüË°å

            const NavItem = ({ id, icon, label }) => (
                <button
                    onClick={() => {
                        setActiveTab(id);
                        setSelectedMaster(null);
                        if (mobileOptimized) setMobileMenuOpen(false);
                    }}
                    className={`w-full flex items-center space-x-3 px-4 my-1 rounded-lg transition-all duration-200 border-l-4 ${
                        activeTab === id
                        ? 'border-gold-500 bg-gold-50 text-brown-800 font-bold shadow-sm'
                        : 'border-transparent text-gray-500 hover:text-brown-800 hover:bg-white'
                    } ${mobileOptimized ? 'py-4 text-base touch-feedback' : 'py-3'}`}
                >
                    <Icon name={icon} size={mobileOptimized ? 24 : 20} className={activeTab === id ? 'text-gold-600' : 'text-gray-400'} />
                    {(sidebarOpen || mobileOptimized) && <span className={activeTab === id ? 'serif font-semibold' : ''}>{label}</span>}
                </button>
            );

            return (
                <div className="flex h-screen bg-brown-50 font-sans text-brown-900 overflow-hidden">
                    {/* Mobile Overlay */}
                    {mobileOptimized && mobileMenuOpen && (
                        <div
                            className="fixed inset-0 bg-black/50 z-30 lg:hidden"
                            onClick={() => setMobileMenuOpen(false)}
                        ></div>
                    )}

                    {/* Sidebar */}
                    <div className={`
                        ${mobileOptimized ? (
                            mobileMenuOpen ? 'translate-x-0' : '-translate-x-full'
                        ) : (
                            sidebarOpen ? 'w-64' : 'w-20'
                        )}
                        ${mobileOptimized ? 'fixed inset-y-0 left-0 w-64 z-40' : 'relative'}
                        bg-white border-r border-gold-200 flex flex-col transition-all duration-300 shadow-xl
                    `}>
                        <div className="h-20 flex items-center justify-center border-b border-gold-100 bg-white">
                            {sidebarOpen ? (
                                <h1 className="text-2xl font-bold text-brown-800 flex items-center serif tracking-wider">
                                    <span className="text-gold-500 mr-2 text-3xl">‚ú¶</span> LuxeMetrics
                                </h1>
                            ) : (
                                <span className="text-gold-500 text-3xl">‚ú¶</span>
                            )}
                        </div>

                        <div className="flex-1 py-6 px-2 space-y-1">
                            {isStaffMode ? (
                                <>
                                    <NavItem id="dashboard" icon="layout-dashboard" label="„Éû„Ç§„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ" />
                                    <NavItem id="input" icon="edit" label="ÂÆüÁ∏æÂÖ•Âäõ" />
                                    <NavItem id="calendar" icon="calendar" label="„Éû„Ç§„Ç´„É¨„É≥„ÉÄ„Éº" />
                                </>
                            ) : (
                                <>
                                    <NavItem id="dashboard" icon="layout-dashboard" label="„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ" />
                                    <NavItem id="input" icon="edit" label="ÂÆüÁ∏æÂÖ•Âäõ" />
                                    <NavItem id="simulation" icon="target" label="ÁõÆÊ®ô„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥" />
                                    <NavItem id="calendar" icon="calendar" label="„Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº" />
                                    <NavItem id="sales" icon="bar-chart-2" label="Â£≤‰∏ä„ÉªÂ™í‰ΩìÂàÜÊûê" />
                                    <NavItem id="menus" icon="package" label="„É°„Éã„É•„ÉºÂà•ÂàÜÊûê" />
                                    <NavItem id="staff" icon="users" label="„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ" />
                                    <NavItem id="customers" icon="heart" label="È°ßÂÆ¢„ÉªÂõûÊï∞Âà∏ÁÆ°ÁêÜ" />
                                </>
                            )}
                        </div>

                        <div className={`border-t border-gold-100 bg-gold-50/50 ${mobileOptimized ? 'p-3' : 'p-4'}`}>
                             <button
                                onClick={() => {
                                    setActiveTab('master');
                                    setSelectedMaster(null);
                                    if (mobileOptimized) setMobileMenuOpen(false);
                                }}
                                className={`w-full flex items-center space-x-3 px-4 rounded-lg transition-colors ${
                                    activeTab === 'master' ? 'bg-gold-200 text-brown-800 font-bold' : 'text-gray-500 hover:bg-white hover:text-brown-800'
                                } ${mobileOptimized ? 'py-4 text-base font-semibold touch-feedback' : 'py-3'} ${(!sidebarOpen && !mobileOptimized) && 'justify-center'}`}
                            >
                                <Icon name="database" size={mobileOptimized ? 24 : 20} />
                                {(sidebarOpen || mobileOptimized) && <span>„Éû„Çπ„Çø„Éº„Éá„Éº„Çø</span>}
                            </button>
                            {!mobileOptimized && (
                                <button
                                    onClick={() => setSidebarOpen(!sidebarOpen)}
                                    className="mt-2 w-full flex items-center justify-center p-2 text-gold-400 hover:text-gold-600"
                                >
                                    <Icon name={sidebarOpen ? "chevrons-left" : "chevrons-right"} size={20} />
                                </button>
                            )}
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col overflow-hidden relative bg-[#f9f8f4]">
                        {/* Topbar */}
                        <header className={`bg-white/95 backdrop-blur-md border-b border-gold-100 flex justify-between items-center shadow-sm z-10 sticky top-0 safe-top hw-accelerate ${
                            mobileOptimized ? 'mobile-header' : 'h-20 px-8'
                        }`}>
                            <div className="flex items-center space-x-3">
                                {mobileOptimized && (
                                    <button
                                        onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                                        className="p-2.5 rounded-lg hover:bg-gold-50 transition-colors touch-feedback"
                                        aria-label="„É°„Éã„É•„Éº„ÇíÈñã„Åè"
                                    >
                                        <Icon name="menu" size={24} className="text-brown-800" />
                                    </button>
                                )}
                                <div>
                                    <h2 className={`font-bold text-brown-800 serif ${mobileOptimized ? 'text-sm' : 'text-xl'}`}>
                                        {activeTab === 'dashboard' && (isStaffMode ? (mobileOptimized ? '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ' : 'My Dashboard') : (mobileOptimized ? 'ÁµåÂñ∂„Çµ„Éû„É™„Éº' : 'Executive Summary'))}
                                        {activeTab === 'input' && (mobileOptimized ? 'ÂÆüÁ∏æÂÖ•Âäõ' : 'Performance Input')}
                                        {activeTab === 'simulation' && (mobileOptimized ? '„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥' : 'Strategy Simulation')}
                                        {activeTab === 'sales' && (mobileOptimized ? 'Â£≤‰∏äÂàÜÊûê' : 'Sales & Marketing Analytics')}
                                        {activeTab === 'menus' && (mobileOptimized ? '„É°„Éã„É•„ÉºÂàÜÊûê' : 'Menu Performance Analysis')}
                                        {activeTab === 'staff' && (mobileOptimized ? '„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ' : 'Staff Performance & Management')}
                                        {activeTab === 'customers' && (mobileOptimized ? 'È°ßÂÆ¢ÁÆ°ÁêÜ' : 'Customer & Ticket Management')}
                                        {activeTab === 'master' && (mobileOptimized ? '„Éû„Çπ„Çø„ÉºÁÆ°ÁêÜ' : 'Master Data Management')}
                                    </h2>
                                    {!mobileOptimized && (
                                        <p className="text-xs text-gold-600 font-medium tracking-widest uppercase mt-1">
                                            {activeTab === 'dashboard' && (isStaffMode ? '„Éû„Ç§„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ' : 'ÁµåÂñ∂„Çµ„Éû„É™„Éº')}
                                            {activeTab === 'input' && 'ÂÆüÁ∏æÂÖ•Âäõ'}
                                            {activeTab === 'simulation' && 'ÁµåÂñ∂„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥'}
                                            {activeTab === 'sales' && 'Â£≤‰∏äË©≥Á¥∞„ÉªÂ™í‰ΩìÂàÜÊûê'}
                                            {activeTab === 'menus' && '„É°„Éã„É•„ÉºÂà•ÂàÜÊûê'}
                                            {activeTab === 'staff' && '„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ„ÉªÁ∑®ÈõÜ'}
                                            {activeTab === 'customers' && 'È°ßÂÆ¢„É™„Çπ„Éà„ÉªÂõûÊï∞Âà∏ÁÆ°ÁêÜ'}
                                            {activeTab === 'master' && '„Éû„Çπ„Çø„Éº„Éá„Éº„ÇøÁÆ°ÁêÜ'}
                                        </p>
                                    )}
                                </div>
                            </div>
                            <div className={`flex items-center ${mobileOptimized ? 'space-x-2' : 'space-x-6'}`}>
                                {/* „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà‰øùÂ≠ò„ÉªË™≠„ÅøËæº„Åø„Éú„Çø„É≥ */}
                                <div className="flex flex-col items-end">
                                    <div className="flex gap-2">
                                        <button
                                            onClick={handleLoadFromSpreadsheet}
                                            disabled={isLoading}
                                            className={`flex items-center bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium rounded-lg shadow-sm transition-colors touch-feedback ${
                                                mobileOptimized ? 'px-2.5 py-2.5' : 'px-4 py-2 text-sm'
                                            }`}
                                            aria-label="„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ"
                                        >
                                            <Icon name={isLoading ? "loader" : "download"} size={mobileOptimized ? 16 : 16} className={`${isLoading ? 'animate-spin' : ''} ${mobileOptimized ? '' : 'mr-2'}`} />
                                            {!mobileOptimized && (isLoading ? 'Ë™≠Ëæº‰∏≠...' : 'Ë™≠„ÅøËæº„Åø')}
                                        </button>
                                        <button
                                            onClick={handleSaveToSpreadsheet}
                                            disabled={isSaving}
                                            className={`flex items-center bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 text-white font-medium rounded-lg shadow-sm transition-colors touch-feedback ${
                                                mobileOptimized ? 'px-2.5 py-2.5' : 'px-4 py-2 text-sm'
                                            }`}
                                            aria-label="„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åô„Çã"
                                        >
                                            <Icon name={isSaving ? "loader" : "save"} size={mobileOptimized ? 16 : 16} className={`${isSaving ? 'animate-spin' : ''} ${mobileOptimized ? '' : 'mr-2'}`} />
                                            {!mobileOptimized && (isSaving ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò')}
                                        </button>
                                    </div>
                                    {saveMessage && (
                                        <span className={`text-xs mt-1 ${saveMessage.includes('‚úì') ? 'text-emerald-600' : 'text-rose-600'}`}>
                                            {saveMessage}
                                        </span>
                                    )}
                                </div>
                                {!mobileOptimized && <div className="h-8 w-px bg-gold-200"></div>}
                                {/* Dark Mode Toggle */}
                                <button
                                    onClick={toggleDarkMode}
                                    className={`flex items-center rounded-lg font-semibold transition-all touch-feedback ${
                                        mobileOptimized
                                            ? 'bg-gray-700 text-yellow-300 shadow-md px-2.5 py-2.5'
                                            : 'bg-white text-gray-600 border border-gray-300 hover:bg-gray-50 px-3 py-2 text-sm'
                                    }`}
                                    title={darkMode ? '„É©„Ç§„Éà„É¢„Éº„Éâ„Å´ÂàáÊõø' : '„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ„Å´ÂàáÊõø'}
                                    aria-label={darkMode ? '„É©„Ç§„Éà„É¢„Éº„Éâ„Å´ÂàáÊõø' : '„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ„Å´ÂàáÊõø'}
                                >
                                    <Icon name={darkMode ? "sun" : "moon"} size={mobileOptimized ? 20 : 16} className={mobileOptimized ? '' : 'mr-2'} />
                                    {!mobileOptimized && <span className="hidden lg:inline">{darkMode ? 'Light' : 'Dark'}</span>}
                                </button>
                                {!mobileOptimized && <div className="h-8 w-px bg-gold-200"></div>}
                                {/* Mobile/PC Toggle */}
                                <button
                                    onClick={() => setMobileOptimized(!mobileOptimized)}
                                    className={`flex items-center rounded-lg font-semibold transition-all touch-feedback ${
                                        mobileOptimized
                                            ? 'bg-purple-600 text-white shadow-md px-2.5 py-2.5'
                                            : 'bg-white text-gray-600 border border-gray-300 hover:bg-purple-50 px-3 py-2 text-sm'
                                    }`}
                                    title={mobileOptimized ? 'PCË°®Á§∫„Å´ÂàáÊõø' : '„Çπ„Éû„ÉõË°®Á§∫„Å´ÂàáÊõø'}
                                    aria-label={mobileOptimized ? 'PCË°®Á§∫„Å´ÂàáÊõø' : '„Çπ„Éû„ÉõË°®Á§∫„Å´ÂàáÊõø'}
                                >
                                    <Icon name={mobileOptimized ? "smartphone" : "monitor"} size={mobileOptimized ? 20 : 16} className={mobileOptimized ? '' : 'mr-2'} />
                                    {!mobileOptimized && <span className="hidden lg:inline">{mobileOptimized ? '„É¢„Éê„Ç§„É´' : 'PC'}</span>}
                                </button>
                                {!mobileOptimized && (
                                    <>
                                        <div className="h-8 w-px bg-gold-200"></div>
                                        <div className="text-right hidden md:block">
                                            <p className="text-sm font-bold text-brown-800">{currentDate}</p>
                                            <p className="text-xs text-gray-400">Tokyo, Japan</p>
                                        </div>
                                        <div className="h-8 w-px bg-gold-200"></div>
                                        <div className="flex items-center space-x-3">
                                            <div className="w-10 h-10 rounded-full bg-brown-800 border-2 border-gold-300 flex items-center justify-center text-gold-100 text-sm font-serif">
                                                {isStaffMode && currentStaff ? currentStaff.name.charAt(0) : 'OP'}
                                            </div>
                                            <div className="hidden md:block">
                                                <p className="text-sm font-bold text-brown-800">
                                                    {isStaffMode && currentStaff ? currentStaff.name : '„Ç™„Éº„Éä„ÉºÊßò'}
                                                </p>
                                                <p className="text-xs text-gold-600">
                                                    {isStaffMode && currentStaff ? currentStaff.role : 'Administrator'}
                                                </p>
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                        </header>

                        {/* Content Area */}
                        <main className={`flex-1 overflow-y-auto transition-all safe-bottom ${mobileOptimized ? 'p-3 pt-4' : 'p-8'}`}>
                            <div className={`mx-auto ${mobileOptimized ? 'max-w-full pb-6' : 'max-w-7xl pb-10'}`}>
                                {activeTab === 'dashboard' && (
                                    isStaffMode && currentStaff ? (
                                        // „Çπ„Çø„ÉÉ„Éï„É¢„Éº„Éâ: Ëá™ÂàÜ„ÅÆÊàêÁ∏æ„Å®Â∫óËàóÁõÆÊ®ô„ÅÆ„ÅøË°®Á§∫
                                        <div className="space-y-6">
                                            <Card>
                                                <h2 className="text-2xl font-bold text-brown-800 mb-6 serif">„ÅÇ„Å™„Åü„ÅÆÂÆüÁ∏æ</h2>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                    <div>
                                                        <p className="text-sm text-gray-500 mb-1">‰ªäÊúà„ÅÆÂ£≤‰∏äÂÆüÁ∏æ</p>
                                                        <p className="text-3xl font-bold text-gold-600">¬•{currentStaff.sales.toLocaleString()}</p>
                                                    </div>
                                                    <div>
                                                        <p className="text-sm text-gray-500 mb-1">Â£≤‰∏äÁõÆÊ®ô</p>
                                                        <p className="text-3xl font-bold text-brown-800">¬•{currentStaff.target.toLocaleString()}</p>
                                                    </div>
                                                </div>
                                                <div className="mt-4">
                                                    <p className="text-sm text-gray-500 mb-2">ÈÅîÊàêÁéá</p>
                                                    <div className="w-full bg-gray-200 rounded-full h-4">
                                                        <div className={`h-4 rounded-full ${currentStaff.sales >= currentStaff.target ? 'bg-emerald-500' : 'bg-gold-500'}`}
                                                            style={{width: `${currentStaff.target > 0 ? Math.min(100, (currentStaff.sales / currentStaff.target) * 100) : 0}%`}}></div>
                                                    </div>
                                                    <p className="text-right text-sm font-bold text-gray-700 mt-1">
                                                        {currentStaff.target > 0 ? Math.round((currentStaff.sales / currentStaff.target) * 100) : 0}%
                                                    </p>
                                                </div>
                                                <div className="grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-200">
                                                    <div className="text-center">
                                                        <p className="text-sm text-gray-500">ÊåáÂêçÊï∞</p>
                                                        <p className="text-2xl font-bold text-brown-800">{currentStaff.nomination}</p>
                                                    </div>
                                                    <div className="text-center border-l border-gray-200">
                                                        <p className="text-sm text-gray-500">„É™„Éî„Éº„ÉàÁéá</p>
                                                        <p className="text-2xl font-bold text-emerald-600">{currentStaff.retention}%</p>
                                                    </div>
                                                    <div className="text-center border-l border-gray-200">
                                                        <p className="text-sm text-gray-500">Âè£„Ç≥„ÉüË©ï‰æ°</p>
                                                        <p className="text-2xl font-bold text-gold-600">{currentStaff.reviewScore || 0}</p>
                                                    </div>
                                                </div>
                                            </Card>

                                            <Card>
                                                <h2 className="text-xl font-bold text-brown-800 mb-4 serif">Â∫óËàóÂÖ®‰Ωì„ÅÆÁõÆÊ®ô</h2>
                                                <div className="space-y-4">
                                                    <div>
                                                        <p className="text-sm text-gray-500 mb-1">‰ªäÊúà„ÅÆÂ∫óËàóÁõÆÊ®ô</p>
                                                        <p className="text-2xl font-bold text-brown-800">
                                                            ¬•{staffList.filter(s => s.storeId === currentStaff.storeId).reduce((sum, s) => sum + s.target, 0).toLocaleString()}
                                                        </p>
                                                    </div>
                                                    <div>
                                                        <p className="text-sm text-gray-500 mb-1">ÁèæÂú®„ÅÆÂÆüÁ∏æ</p>
                                                        <p className="text-2xl font-bold text-gold-600">
                                                            ¬•{staffList.filter(s => s.storeId === currentStaff.storeId).reduce((sum, s) => sum + s.sales, 0).toLocaleString()}
                                                        </p>
                                                    </div>
                                                </div>
                                            </Card>

                                            <div className="bg-gold-50 border border-gold-200 rounded-lg p-6">
                                                <h3 className="font-bold text-brown-800 mb-2">üí° „Çπ„Çø„ÉÉ„ÉïURL„Å´„Å§„ÅÑ„Å¶</h3>
                                                <p className="text-sm text-gray-700">
                                                    „Åì„ÅÆ„Éö„Éº„Ç∏„ÅØ„ÅÇ„Å™„ÅüÂ∞ÇÁî®„ÅÆURL„Åß„Åô„ÄÇ‰ªñ„ÅÆ„Çπ„Çø„ÉÉ„Éï„ÅÆË©≥Á¥∞ÊÉÖÂ†±„ÅØË°®Á§∫„Åï„Çå„Åæ„Åõ„Çì„ÄÇ<br/>
                                                    „ÄåÂÆüÁ∏æÂÖ•Âäõ„Äç„Åã„ÇâÊó•„ÄÖ„ÅÆÂ£≤‰∏ä„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜÔºÅ
                                                </p>
                                            </div>
                                        </div>
                                    ) : (
                                        <DashboardView
                                            staffList={staffList}
                                            dailySalesData={dailySalesData}
                                            menuSalesData={menuSalesData}
                                            mediaSourcesData={mediaSourcesList}
                                            customerList={customerList}
                                            onNavigate={setActiveTab}
                                            mobileOptimized={mobileOptimized}
                                            storeData={[
                                                { id: 1, name: 'Êñ∞ÂÆøÂ∫ó' },
                                                { id: 2, name: 'Êñ∞ÂÆøÂçóÂè£Â∫ó' }
                                            ]}
                                        />
                                    )
                                )}
                                {activeTab === 'input' && <PerformanceInputView
                                    dailySalesData={dailySalesData}
                                    setDailySalesData={setDailySalesData}
                                    menuSalesData={menuSalesData}
                                    setMenuSalesData={setMenuSalesData}
                                    staffList={staffList}
                                />}
                                {!isStaffMode && activeTab === 'staff' && <StaffManagementView staffList={staffList} onUpdateStaff={updateStaff} onAddStaff={addStaff} onDeleteStaff={deleteStaff} exportToCSV={handleExportToCSV} />}
                                {!isStaffMode && activeTab === 'simulation' && <SimulationView staffList={staffList} onUpdateStaff={updateStaff} />}
                                {!isStaffMode && activeTab === 'master' && !selectedMaster && (
                                    <MasterDataManagementView onSelectMaster={handleSelectMaster} />
                                )}
                                {!isStaffMode && activeTab === 'sales' && (
                                    <SalesAnalysisView
                                        dailySalesData={dailySalesData}
                                        mediaSourcesData={mediaSourcesList}
                                        onUpdateMediaSource={updateMediaSource}
                                    />
                                )}
                                {!isStaffMode && activeTab === 'menus' && selectedMaster === 'menus' && (
                                    <MenuManagementView
                                        menuList={menuList}
                                        onUpdateMenu={updateMenu}
                                        onAddMenu={addMenu}
                                        onDeleteMenu={deleteMenu}
                                    />
                                )}
                                {activeTab === 'calendar' && <CalendarView dailySalesData={dailySalesData} staffId={isStaffMode ? currentStaffId : null} />}
                                {!isStaffMode && activeTab === 'menus' && !selectedMaster && <MenuAnalysisView menuSalesData={menuSalesData} />}
                                {!isStaffMode && activeTab === 'media' && (
                                    <MediaSourceManagementView
                                        mediaSourcesList={mediaSourcesList}
                                        onUpdateMedia={updateMediaSource}
                                        onAddMedia={addMediaSource}
                                        onDeleteMedia={deleteMediaSource}
                                    />
                                )}
                                {!isStaffMode && activeTab === 'customers' && (
                                    <CustomerTicketManagementView
                                        ticketMasterList={ticketMasterList}
                                        customerList={customerList}
                                        onUpdateTicketMaster={updateTicketMaster}
                                        onAddTicketMaster={addTicketMaster}
                                        onDeleteTicketMaster={deleteTicketMaster}
                                        onUpdateCustomer={updateCustomer}
                                        onAddCustomer={addCustomer}
                                        exportToCSV={handleExportToCSV}
                                        onDeleteCustomer={deleteCustomer}
                                    />
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        };

        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<Layout />);
        } catch (error) {
            console.error('„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Ç®„É©„Éº:', error);
            document.body.innerHTML = `
                <div style="padding: 40px; font-family: sans-serif;">
                    <h1 style="color: red;">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</h1>
                    <pre style="background: #f5f5f5; padding: 20px; overflow: auto;">${error.toString()}\n\n${error.stack}</pre>
                    <p>„Éñ„É©„Ç¶„Ç∂„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´ÔºàF12„Ç≠„ÉºÔºâ„ÅßË©≥Á¥∞„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                </div>
            `;
        }
    </script>
</body>
</html>
