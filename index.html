<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxeMetrics - NOBLE„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts Dependencies -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <!-- Recharts (Chart Library) - Pinned version for stability -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Config for Tailwind (Luxury Gold Theme) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {
                            50: '#fbf9f1',
                            100: '#f5f0db',
                            200: '#ede0b3',
                            300: '#e3cc83',
                            400: '#d9b656',
                            500: '#d4af37', // Brand Primary
                            600: '#b48e26',
                            700: '#906d1f',
                            800: '#775820',
                            900: '#624920',
                        },
                        brown: {
                            50: '#f7f5f3',
                            800: '#4a3b32', // Brand Text
                            900: '#2d241e',
                        },
                        accent: {
                            500: '#c084fc', // Subtle accent for charts
                        }
                    },
                    fontFamily: {
                        sans: ['"Yu Mincho"', '"Hiragino Mincho ProN"', '"MS PMincho"', 'serif'], // Serif for luxury feel
                        ui: ['"Helvetica Neue"', 'Arial', 'sans-serif'], // UI font
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #f7f5f3; /* brown-50 */
            color: #4a3b32; /* brown-800 */
            font-family: "Helvetica Neue", Arial, sans-serif;
        }
        h1, h2, h3, .serif {
            font-family: "Yu Mincho", "Hiragino Mincho ProN", "MS PMincho", serif;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d4af37; 
            border-radius: 4px;
        }
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }
        input[type=range]:focus {
            outline: none; 
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        // Recharts might be undefined if script fails, handle gracefully
        const RechartsLib = window.Recharts || {};
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line, AreaChart, Area } = RechartsLib;

        // --- Mock Data Generators ---

        // Â∫óËàó„Éû„Çπ„Çø
        const stores = [
            { id: 1, name: "Êñ∞ÂÆøÂ∫ó", code: "shinjuku" },
            { id: 2, name: "Êñ∞ÂÆøÂçóÂè£Â∫ó", code: "shinjuku_south" }
        ];

        // „É°„Éã„É•„Éº„Éû„Çπ„Çø
        const menus = [
            { id: 1, name: "Ââ•Èõ¢„ÅÇ„Çä„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(È°î)", price: 18000, availableStores: [1, 2] },
            { id: 2, name: "Ââ•Èõ¢„Å™„Åó„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(È°î)", price: 15000, availableStores: [1, 2] },
            { id: 3, name: "Ââ•Èõ¢„Å™„Åó„Éè„Éº„Éñ„Éî„Éº„É™„É≥„Ç∞(„Éú„Éá„Ç£)", price: 20000, availableStores: [1, 2] },
            { id: 4, name: "„Çà„ÇÇ„ÅéËí∏„Åó", price: 8000, availableStores: [2] }, // Êñ∞ÂÆøÂçóÂè£Â∫ó„ÅÆ„Åø
            { id: 5, name: "„Çª„É´„Éï„Éõ„ÉØ„Ç§„Éà„Éã„É≥„Ç∞", price: 5000, availableStores: [2] } // Êñ∞ÂÆøÂçóÂè£Â∫ó„ÅÆ„Åø
        ];

        // ÂàùÊúü„Çπ„Çø„ÉÉ„Éï„Éá„Éº„ÇøÔºàÁ©∫ - ÂÆü„Éá„Éº„Çø„ÇíÂÖ•ÂäõÔºâ
        const initialStaffData = [];
        // „Çπ„Çø„ÉÉ„Éï„Éá„Éº„ÇøÊßãÈÄ†: { id, name, role, storeId, sales, target, nomination, retention, reviewScore }

        // ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„Éá„Éº„Çø
        const initialTicketMasterData = [];
        // ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÊßãÈÄ†: { id, name, sessions, price, validMonths, description }

        // È°ßÂÆ¢„Éá„Éº„ÇøÔºàÂõûÊï∞Âà∏Ë≥ºÂÖ•ËÄÖÔºâ
        const initialCustomerData = [];
        // È°ßÂÆ¢„Éá„Éº„ÇøÊßãÈÄ†: { id, name, phone, email, purchaseDate, ticketMasterId, remainingSessions, expiryDate, storeId }

        // Â™í‰ΩìÂà•„Éá„Éº„ÇøÔºàÁ©∫ - ÂÆü„Éá„Éº„Çø„ÇíÂÖ•ÂäõÔºâ
        const initialMediaSourcesData = [];
        // Â™í‰Ωì„Éá„Éº„ÇøÊßãÈÄ†: { id, name, newVisits, repeatRate, cpa, sales }

        // Êó•Ê¨°Â£≤‰∏ä„Éá„Éº„ÇøÔºàÁ©∫ - ÂÆü„Éá„Éº„Çø„ÇíÂÖ•ÂäõÔºâ
        const initialDailySalesData = [];
        // Êó•Ê¨°Â£≤‰∏äÊßãÈÄ†: { date, storeId, storeName, spotSales, ticketSales, ticketUsage, product, accountingSales, cashIn }

        // „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Éá„Éº„ÇøÔºàÁ©∫ - ÂÆü„Éá„Éº„Çø„ÇíÂÖ•ÂäõÔºâ
        const initialMenuSalesData = [];
        // „É°„Éã„É•„ÉºÂ£≤‰∏äÊßãÈÄ†: { menuId, menuName, count, sales, date, storeId }

        // --- Google Apps ScriptÈÄ£Êê∫Èñ¢Êï∞ ---

        // GAS„ÅÆWeb„Ç¢„Éó„É™URL„ÇíË®≠ÂÆöÔºà„Éá„Éó„É≠„Ç§Âæå„Å´ÂÆüÈöõ„ÅÆURL„Å´Â§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxmSKXpHDEVbHeKEIHrtk_DoQfXIsMXBExfa7CzhpkizuC_wf-UY5YqXn0Ctc4u6lbq/exec';

        /**
         * „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveToSpreadsheet = async (action, data) => {
            try {
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', // GAS„ÅÆÂà∂Èôê„Å´„Çà„ÇäÂøÖË¶Å
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        ...data
                    })
                });

                // no-cors„É¢„Éº„Éâ„Åß„ÅØ„É¨„Çπ„Éù„É≥„Çπ„ÇíË™≠„ÅøÂèñ„Çå„Å™„ÅÑ„Åü„ÇÅ„ÄÅÊàêÂäü„Å®‰ªÆÂÆö
                console.log('„Éá„Éº„ÇøÈÄÅ‰ø°ÂÆå‰∫Ü:', action);
                return { success: true, message: '„Éá„Éº„Çø„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü' };
            } catch (error) {
                console.error('„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà‰øùÂ≠ò„Ç®„É©„Éº:', error);
                return { success: false, message: error.toString() };
            }
        };

        /**
         * Êó•Ê¨°Â£≤‰∏ä„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveDailySalesData = (dailySalesData) => {
            return saveToSpreadsheet('saveDailySales', { salesData: dailySalesData });
        };

        /**
         * „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveMenuSalesData = (menuSalesData) => {
            return saveToSpreadsheet('saveMenuSales', { menuData: menuSalesData });
        };

        /**
         * „Çπ„Çø„ÉÉ„ÉïÂÆüÁ∏æ„Éá„Éº„Çø„Çí‰øùÂ≠ò
         */
        const saveStaffPerformanceData = (staffData) => {
            return saveToSpreadsheet('saveStaffPerformance', { staffData: staffData });
        };

        // --- Helper Components ---

        const Icon = ({ name, size = 20, color = "currentColor", className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} width={size} height={size} stroke={color} className={className}></i>;
        };

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-lg shadow-sm border border-gold-200 p-6 ${className}`}>
                {children}
            </div>
        );

        const KpiCard = ({ title, value, subValue, trend, icon, color = "bg-gold-500" }) => (
            <Card className="hover:shadow-md transition-shadow relative overflow-hidden">
                <div className="absolute top-0 right-0 p-4 opacity-10">
                    <Icon name={icon} size={64} className="text-gold-900" />
                </div>
                <div className="flex justify-between items-start mb-4 relative z-10">
                    <div className={`p-3 rounded-lg ${color} text-white shadow-md`}>
                        <Icon name={icon} size={24} />
                    </div>
                    {trend && (
                        <span className={`text-sm font-medium ${trend > 0 ? 'text-emerald-600' : 'text-rose-500'} flex items-center bg-white/80 px-2 py-1 rounded-full`}>
                            {trend > 0 ? '+' : ''}{trend}% 
                            <Icon name={trend > 0 ? 'trending-up' : 'trending-down'} size={14} className="ml-1" />
                        </span>
                    )}
                </div>
                <h3 className="text-gray-500 text-sm font-medium serif relative z-10">{title}</h3>
                <div className="flex items-baseline mt-1 relative z-10">
                    <span className="text-2xl font-bold text-brown-800 font-ui">{value}</span>
                </div>
                <p className="text-xs text-gray-400 mt-1 relative z-10">{subValue}</p>
            </Card>
        );

        // --- Main Sections ---

        const DashboardView = ({ staffList, dailySalesData, menuSalesData }) => {
            const [viewMode, setViewMode] = useState('all'); // 'all', 'store_1', 'store_2', 'staff'

            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„ÅüÂ£≤‰∏ä„Éá„Éº„Çø
            const filteredDailySales = useMemo(() => {
                if (!dailySalesData || dailySalesData.length === 0) return [];
                if (viewMode === 'all') return dailySalesData;

                if (viewMode === 'store_1' || viewMode === 'store_2') {
                    const storeId = viewMode === 'store_1' ? 1 : 2;
                    return dailySalesData.map(dayData => {
                        const storeInfo = dayData.storeData?.find(s => s.storeId === storeId) || {};
                        return {
                            day: dayData.day,
                            spotSales: storeInfo.spotSales || 0,
                            ticketSales: storeInfo.ticketSales || 0,
                            ticketUsage: storeInfo.ticketUsage || 0,
                            product: storeInfo.product || 0,
                            accountingSales: storeInfo.accountingSales || 0,
                            cashIn: storeInfo.cashIn || 0
                        };
                    });
                }

                return dailySalesData; // „Çπ„Çø„ÉÉ„Éï„Éì„É•„Éº„ÅØÂæå„ÅßÂÆüË£Ö
            }, [dailySalesData, viewMode]);

            const filteredStaffList = useMemo(() => {
                if (viewMode === 'all' || viewMode === 'staff') return staffList;
                if (viewMode === 'store_1') return staffList.filter(s => s.storeId === 1);
                if (viewMode === 'store_2') return staffList.filter(s => s.storeId === 2);
                return staffList;
            }, [staffList, viewMode]);

            // ÂêàË®àË®àÁÆó
            const totalAccountingSales = filteredDailySales.reduce((acc, curr) => acc + (curr.accountingSales || 0), 0);
            const totalCashIn = filteredDailySales.reduce((acc, curr) => acc + (curr.cashIn || 0), 0);
            const totalTicketUsage = filteredDailySales.reduce((acc, curr) => acc + (curr.ticketUsage || 0), 0);
            const totalTicketSales = filteredDailySales.reduce((acc, curr) => acc + (curr.ticketSales || 0), 0);

            if (!window.Recharts) return <div>Loading Charts... (If this persists, please refresh)</div>;

            // „Éá„Éº„Çø„ÅåÁ©∫„ÅÆÂ†¥Âêà„ÅÆË°®Á§∫
            const hasData = (staffList && staffList.length > 0) || (dailySalesData && dailySalesData.length > 0);

            if (!hasData) {
                return (
                    <div className="flex flex-col items-center justify-center py-20">
                        <div className="bg-white rounded-xl p-12 shadow-lg border border-gold-200 text-center max-w-2xl">
                            <div className="w-20 h-20 bg-gold-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Icon name="sparkles" size={40} className="text-gold-600" />
                            </div>
                            <h2 className="text-2xl font-bold text-brown-800 mb-4 serif">„Ç®„Çπ„ÉÜ„Çµ„É≠„É≥„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ</h2>
                            <p className="text-gray-600 mb-8 leading-relaxed">
                                „Åæ„Å†„Éá„Éº„Çø„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br/>
                                ‰ª•‰∏ã„ÅÆÊâãÈ†Ü„Åß„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Çí‰Ωø„ÅÑÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ
                            </p>
                            <div className="text-left space-y-4 bg-gold-50 rounded-lg p-6 mb-8">
                                <div className="flex items-start">
                                    <span className="bg-gold-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 flex-shrink-0">1</span>
                                    <div>
                                        <p className="font-bold text-brown-800">„Çπ„Çø„ÉÉ„Éï„ÇíÁôªÈå≤</p>
                                        <p className="text-sm text-gray-600">Â∑¶„É°„Éã„É•„Éº„ÅÆ„Äå„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ„Äç„Åã„ÇâÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <span className="bg-gold-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 flex-shrink-0">2</span>
                                    <div>
                                        <p className="font-bold text-brown-800">ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„ÇíË®≠ÂÆö</p>
                                        <p className="text-sm text-gray-600">„ÄåÈ°ßÂÆ¢„ÉªÂõûÊï∞Âà∏ÁÆ°ÁêÜ„Äç„Åã„ÇâÂõûÊï∞Âà∏„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <span className="bg-gold-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 flex-shrink-0">3</span>
                                    <div>
                                        <p className="font-bold text-brown-800">„Éá„Éº„Çø„Çí‰øùÂ≠ò</p>
                                        <p className="text-sm text-gray-600">Âè≥‰∏ä„ÅÆ„Äå‰øùÂ≠ò„Äç„Éú„Çø„É≥„Åß„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åß„Åç„Åæ„Åô</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-xs text-gray-500">
                                üí° „Éí„É≥„Éà: „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅÂè≥‰∏ä„ÅÆ„ÄåË™≠„ÅøËæº„Åø„Äç„Éú„Çø„É≥„ÅßÂèñÂæó„Åß„Åç„Åæ„Åô
                            </p>
                        </div>
                    </div>
                );
            }

            // „Çø„Éñ„Éú„Çø„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
            const ViewTab = ({ id, label }) => (
                <button
                    onClick={() => setViewMode(id)}
                    className={`px-6 py-2.5 text-sm font-medium rounded-lg transition-all ${
                        viewMode === id
                            ? 'bg-gold-500 text-white shadow-md'
                            : 'bg-white text-gray-600 hover:bg-gold-50 border border-gray-200'
                    }`}
                >
                    {label}
                </button>
            );

            return (
                <div className="space-y-6">
                    {/* Â∫óËàó/„Çπ„Çø„ÉÉ„ÉïÂàá„ÇäÊõø„Åà„Çø„Éñ */}
                    <div className="bg-white rounded-lg p-4 shadow-sm border border-gold-200">
                        <div className="flex items-center justify-between">
                            <h3 className="text-sm font-bold text-gray-600 serif">Ë°®Á§∫ÂàáÊõø</h3>
                            <div className="flex gap-2">
                                <ViewTab id="all" label="ÂÖ®Â∫óËàóÂêàË®à" />
                                <ViewTab id="store_1" label="Êñ∞ÂÆøÂ∫ó" />
                                <ViewTab id="store_2" label="Êñ∞ÂÆøÂçóÂè£Â∫ó" />
                                <ViewTab id="staff" label="„Çπ„Çø„ÉÉ„ÉïÂà•" />
                            </div>
                        </div>
                    </div>

                    {/* Top KPI Cards - Split Sales Types */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <KpiCard 
                            title="‰ºöË®à‰∏äÂ£≤‰∏ä (ÂΩπÂãôÊ∂àÂåñËæº)" 
                            value={`¬•${totalAccountingSales.toLocaleString()}`} 
                            subValue={`Ê∂àÂåñÈ°ç: ¬•${totalTicketUsage.toLocaleString()}`}
                            trend={5.2} 
                            icon="file-text" 
                            color="bg-gold-600"
                        />
                        <KpiCard 
                            title="„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥ (ÂÖ•ÈáëÁ∑èÈ°ç)" 
                            value={`¬•${totalCashIn.toLocaleString()}`} 
                            subValue={`ÂõûÊï∞Âà∏Ë≤©Â£≤: ¬•${totalTicketSales.toLocaleString()}`}
                            trend={12.8} 
                            icon="coins" 
                            color="bg-emerald-600"
                        />
                        <KpiCard 
                            title="ÂõûÊï∞Âà∏Êú™Ê∂àÂåñÊÆãÈ´ò" 
                            value="¬•4,250,000" 
                            subValue="ÂâçÊúàÊØî +¬•50,000 (Ë≤†ÂÇµÂ¢ó)"
                            trend={-1.2} 
                            icon="layers" 
                            color="bg-brown-800"
                        />
                        <KpiCard 
                            title="Âπ≥Âùá„É™„Éî„Éº„ÉàÁéá" 
                            value="72.4%" 
                            subValue="Êñ∞Ë¶èÂÆöÁùÄÁéá: 45%"
                            trend={2.1} 
                            icon="repeat" 
                            color="bg-rose-500"
                        />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* Main Chart: Sales Breakdown */}
                        <div className="lg:col-span-2">
                            <Card className="h-96">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h2 className="text-lg font-bold text-brown-800 serif">Â£≤‰∏äÊßãÈÄ†ÂàÜÊûê</h2>
                                        <p className="text-xs text-gray-500">„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥(ÁèæÈáë)„Å®‰ºöË®à‰∏äÂ£≤‰∏ä(PL)„ÅÆ‰πñÈõ¢„ÇíÁ¢∫Ë™ç</p>
                                    </div>
                                </div>
                                <ResponsiveContainer width="100%" height="85%">
                                    <BarChart data={filteredDailySales}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e5e7eb" />
                                        <XAxis dataKey="day" tick={{fontSize: 10}} interval={2} />
                                        <YAxis tick={{fontSize: 10}} tickFormatter={(val) => `¬•${val/10000}‰∏á`} />
                                        <Tooltip 
                                            formatter={(value) => `¬•${value.toLocaleString()}`}
                                            contentStyle={{backgroundColor: '#fff', borderColor: '#d4af37'}}
                                        />
                                        <Legend />
                                        <Bar dataKey="spotSales" name="ÈÉΩÂ∫¶Êâï„ÅÑ" stackId="a" fill="#d4af37" />
                                        <Bar dataKey="product" name="Áâ©Ë≤©" stackId="a" fill="#b48e26" />
                                        <Bar dataKey="ticketUsage" name="ÂõûÊï∞Âà∏Ê∂àÂåñ(Â£≤‰∏ä)" stackId="a" fill="#4a3b32" />
                                        <Bar dataKey="ticketSales" name="ÂõûÊï∞Âà∏Ë≤©Â£≤(ÂÖ•Èáë)" fill="#10b981" radius={[4, 4, 0, 0]} opacity={0.3} />
                                    </BarChart>
                                </ResponsiveContainer>
                            </Card>
                        </div>

                        {/* Side Widgets */}
                        <div className="space-y-6">
                            {/* Media Performance Mini */}
                            <Card>
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">Â™í‰ΩìÂà• Êñ∞Ë¶èÈõÜÂÆ¢Áä∂Ê≥Å</h3>
                                <div className="space-y-4">
                                    {mediaSourcesData.slice(0, 3).map(media => (
                                        <div key={media.id} className="flex flex-col">
                                            <div className="flex justify-between text-sm mb-1">
                                                <span className="font-medium text-gray-700">{media.name}</span>
                                                <span className="font-bold text-gold-600">{media.newVisits}‰∫∫</span>
                                            </div>
                                            <div className="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                                                <div 
                                                    className="h-full bg-gold-500" 
                                                    style={{width: `${(media.newVisits / 50) * 100}%`}}
                                                ></div>
                                            </div>
                                            <div className="flex justify-between text-xs text-gray-400 mt-1">
                                                <span>CPA: ¬•{media.cpa.toLocaleString()}</span>
                                                <span>ÂÆöÁùÄÁéá: {media.repeatRate}%</span>
                                            </div>
                                        </div>
                                    ))}
                                    <button className="w-full mt-2 text-xs text-gold-600 hover:text-gold-700 text-center py-2 border border-gold-200 rounded hover:bg-gold-50 transition-colors">
                                        ÂÖ®„Å¶„ÅÆÂ™í‰Ωì„ÇíË¶ã„Çã
                                    </button>
                                </div>
                            </Card>

                            {/* Ticket Alert */}
                            <div className="bg-gradient-to-br from-brown-800 to-brown-900 text-gold-100 p-6 rounded-lg shadow-lg">
                                <div className="flex items-center mb-3">
                                    <Icon name="alert-circle" size={20} className="text-gold-400 mr-2" />
                                    <h3 className="font-bold serif">ÊúâÂäπÊúüÈôê„Ç¢„É©„Éº„Éà</h3>
                                </div>
                                <p className="text-sm opacity-90 mb-4">
                                    ‰ªäÊúàÊú´„ÅßÊúâÂäπÊúüÈôê„ÅåÂàá„Çå„ÇãÂõûÊï∞Âà∏„ÇíÊåÅ„Å§È°ßÂÆ¢„Åå <span className="font-bold text-white text-lg">12Âêç</span> „ÅÑ„Åæ„Åô„ÄÇ
                                </p>
                                <button className="w-full bg-gold-500 hover:bg-gold-600 text-white text-sm font-bold py-2 rounded transition-colors">
                                    ÂØæË±°È°ßÂÆ¢„É™„Çπ„Éà„ÇíË°®Á§∫
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Media Analysis Section (New) ---
        const SalesAnalysisView = ({ dailySalesData }) => {
             if (!window.Recharts) return <div>Loading Charts...</div>;
             
            return (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Media Source Performance Table */}
                        <Card className="col-span-1">
                             <div className="flex justify-between items-center mb-6">
                                <h2 className="text-lg font-bold text-brown-800 serif">Â™í‰ΩìÂà•„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂàÜÊûê</h2>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="border-b border-gold-100 text-xs text-gray-500 uppercase">
                                            <th className="py-3 font-medium">Â™í‰ΩìÂêç</th>
                                            <th className="py-3 font-medium text-right">Êñ∞Ë¶èÊï∞</th>
                                            <th className="py-3 font-medium text-right">Áç≤ÂæóÂçò‰æ°(CPA)</th>
                                            <th className="py-3 font-medium text-right">„É™„Éî„Éº„ÉàÁéá</th>
                                            <th className="py-3 font-medium text-right">Á∑èÂ£≤‰∏äË≤¢ÁåÆ</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-sm divide-y divide-gray-50">
                                        {mediaSourcesData.map((media) => (
                                            <tr key={media.id} className="hover:bg-gold-50/50">
                                                <td className="py-3 font-medium text-brown-800">{media.name}</td>
                                                <td className="py-3 text-right">{media.newVisits}</td>
                                                <td className="py-3 text-right">¬•{media.cpa.toLocaleString()}</td>
                                                <td className="py-3 text-right">
                                                    <span className={`px-2 py-1 rounded-full text-xs ${media.repeatRate >= 40 ? 'bg-emerald-100 text-emerald-700' : 'bg-gray-100 text-gray-600'}`}>
                                                        {media.repeatRate}%
                                                    </span>
                                                </td>
                                                <td className="py-3 text-right font-medium">¬•{media.sales.toLocaleString()}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="mt-4 p-4 bg-gold-50 rounded text-xs text-brown-800">
                                <strong>ÂàÜÊûê:</strong> „ÄåÁ¥π‰ªã„ÉªÂè£„Ç≥„Éü„Äç„ÅÆ„É™„Éî„Éº„ÉàÁéá„Åå85%„Å®ÂúßÂÄíÁöÑ„Åß„Åô„ÄÇÁ¥π‰ªã„Ç≠„É£„É≥„Éö„Éº„É≥„ÅÆÂº∑Âåñ„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ‰∏ÄÊñπ„ÄÅ„ÉÅ„É©„Ç∑„ÅØCPA„ÅåÈ´ò„Åè„É™„Éî„Éº„ÉàÁéá„Åå‰Ωé„ÅÑ„Åü„ÇÅ„ÄÅ‰∫àÁÆó„ÅÆË¶ãÁõ¥„Åó„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
                            </div>
                        </Card>

                        {/* Sales Trend Chart */}
                         <Card className="col-span-1">
                            <h2 className="text-lg font-bold text-brown-800 mb-6 serif">Â£≤‰∏äÊé®ÁßªÔºà„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥ vs ÂΩπÂãôÊ∂àÂåñÔºâ</h2>
                             <ResponsiveContainer width="100%" height={300}>
                                <AreaChart data={dailySalesData}>
                                    <defs>
                                        <linearGradient id="colorCash" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#10b981" stopOpacity={0.1}/>
                                            <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                                        </linearGradient>
                                        <linearGradient id="colorSales" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#d4af37" stopOpacity={0.1}/>
                                            <stop offset="95%" stopColor="#d4af37" stopOpacity={0}/>
                                        </linearGradient>
                                    </defs>
                                    <XAxis dataKey="day" tick={{fontSize: 10}} interval={5} />
                                    <YAxis tick={{fontSize: 10}} />
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                    <Tooltip />
                                    <Legend verticalAlign="top" height={36}/>
                                    <Area type="monotone" dataKey="cashIn" name="„Ç≠„É£„ÉÉ„Ç∑„É•„Ç§„É≥(ÁèæÈáë)" stroke="#10b981" fillOpacity={1} fill="url(#colorCash)" />
                                    <Area type="monotone" dataKey="accountingSales" name="‰ºöË®à‰∏äÂ£≤‰∏ä(Ê∂àÂåñ)" stroke="#d4af37" fillOpacity={1} fill="url(#colorSales)" />
                                </AreaChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>
                </div>
            );
        };


        // --- Staff Management Section (Enhanced) ---

        const StaffManagementView = ({ staffList, onUpdateStaff, onAddStaff, onDeleteStaff }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [deletingId, setDeletingId] = useState(null);

            // Form State
            const [formData, setFormData] = useState({
                name: '', role: '', storeId: 1, sales: 0, target: 0, nomination: 0, retention: 0, reviewScore: 0
            });

            const handleEditClick = (staff) => {
                setIsEditing(true);
                setEditingId(staff.id);
                setFormData({ ...staff });
            };

            const handleAddClick = () => {
                setIsEditing(true);
                setEditingId(null); // New
                setFormData({
                    name: '', role: '„Çπ„Çø„ÉÉ„Éï', storeId: 1, sales: 0, target: 1000000, nomination: 0, retention: 0, reviewScore: 0
                });
            };

            const handleDeleteClick = (staffId) => {
                setDeletingId(staffId);
                setShowDeleteConfirm(true);
            };

            const confirmDelete = () => {
                onDeleteStaff(deletingId);
                setShowDeleteConfirm(false);
                setDeletingId(null);
            };

            const handleSave = () => {
                if (editingId) {
                    onUpdateStaff(editingId, formData);
                } else {
                    onAddStaff({ ...formData, id: Date.now() });
                }
                setIsEditing(false);
                setEditingId(null);
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: ['name', 'role'].includes(name) ? value : Number(value)
                }));
            };

            return (
                <div className="space-y-6">
                    {/* Header Action */}
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-xl font-bold text-brown-800 serif">„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ„ÉªÂàÜÊûê</h2>
                            <p className="text-sm text-gray-500">ÂÄã‰∫∫„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁÆ°ÁêÜ„Å®Ë©ï‰æ°„Éá„Éº„Çø„ÅÆÁ∑®ÈõÜ</p>
                        </div>
                        <button 
                            onClick={handleAddClick}
                            className="bg-gold-500 hover:bg-gold-600 text-white px-4 py-2 rounded-lg shadow-sm flex items-center text-sm font-medium transition-colors"
                        >
                            <Icon name="plus" size={16} className="mr-2" />
                            „Çπ„Çø„ÉÉ„ÉïÊñ∞Ë¶èÁôªÈå≤
                        </button>
                    </div>

                    {/* Staff List Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {staffList.length === 0 ? (
                            <div className="col-span-full text-center py-12 text-gray-400">
                                <Icon name="users" size={48} className="mx-auto mb-4 opacity-30" />
                                <p className="text-sm">„Çπ„Çø„ÉÉ„Éï„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                <p className="text-xs mt-2">„Äå„Çπ„Çø„ÉÉ„ÉïÊñ∞Ë¶èÁôªÈå≤„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>
                        ) : (
                            staffList.map(staff => (
                                <div key={staff.id} className="bg-white border border-gold-100 rounded-xl p-5 hover:shadow-md transition-shadow group relative">
                                    <div className="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button
                                            onClick={() => handleEditClick(staff)}
                                            className="text-gray-300 hover:text-gold-500 p-1"
                                        >
                                            <Icon name="edit-2" size={16} />
                                        </button>
                                        <button
                                            onClick={() => handleDeleteClick(staff.id)}
                                            className="text-gray-300 hover:text-rose-500 p-1"
                                        >
                                            <Icon name="trash-2" size={16} />
                                        </button>
                                    </div>

                                    <div className="flex items-center mb-4">
                                        <div className="w-12 h-12 rounded-full bg-gold-50 border border-gold-200 flex items-center justify-center text-gold-700 font-bold text-lg">
                                            {staff.name ? staff.name.charAt(0) : '?'}
                                        </div>
                                        <div className="ml-3">
                                            <h3 className="font-bold text-brown-800">{staff.name}</h3>
                                            <p className="text-xs text-gray-500 bg-gray-100 inline-block px-2 py-0.5 rounded mt-1">
                                                {staff.role} - {stores.find(s => s.id === staff.storeId)?.name}
                                            </p>
                                        </div>
                                    </div>
                                <div className="space-y-3">
                                    <div className="flex justify-between text-sm items-end">
                                        <span className="text-gray-500 text-xs">Â£≤‰∏äÂÆüÁ∏æ</span>
                                        <span className="font-bold text-brown-800">¬•{staff.sales.toLocaleString()}</span>
                                    </div>
                                    <div className="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                                        <div 
                                            className={`h-full ${staff.sales >= staff.target ? 'bg-emerald-500' : 'bg-gold-500'}`} 
                                            style={{width: `${Math.min(100, (staff.sales/staff.target)*100)}%`}}
                                        ></div>
                                    </div>
                                    <div className="flex justify-between text-xs text-gray-400">
                                        <span>ÁõÆÊ®ô: ¬•{staff.target.toLocaleString()}</span>
                                        <span>{Math.round((staff.sales/staff.target)*100)}%</span>
                                    </div>
                                    
                                    <div className="grid grid-cols-3 gap-2 pt-2 border-t border-gray-50 mt-2">
                                        <div className="text-center">
                                            <div className="text-xs text-gray-400">ÊåáÂêç</div>
                                            <div className="font-bold text-brown-800">{staff.nomination}</div>
                                        </div>
                                        <div className="text-center border-l border-gray-100">
                                            <div className="text-xs text-gray-400">„É™„Éî„Éº„Éà</div>
                                            <div className="font-bold text-brown-800">{staff.retention}%</div>
                                        </div>
                                        <div className="text-center border-l border-gray-100">
                                            <div className="text-xs text-gray-400">Âè£„Ç≥„ÉüË©ï‰æ°</div>
                                            <div className="font-bold text-gold-600 flex justify-center items-center">
                                                {staff.reviewScore || 0}<Icon name="star" size={10} className="ml-0.5 fill-current" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            ))
                        )}
                    </div>

                    {/* Edit Modal */}
                    {isEditing && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md border border-gold-200">
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">
                                    {editingId ? '„Çπ„Çø„ÉÉ„ÉïÊÉÖÂ†±Á∑®ÈõÜ' : 'Êñ∞Ë¶è„Çπ„Çø„ÉÉ„ÉïÁôªÈå≤'}
                                </h3>
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Ê∞èÂêç</label>
                                            <input name="name" value={formData.name} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="Ê∞èÂêç" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÂΩπËÅ∑</label>
                                            <select name="role" value={formData.role} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                                <option value="Â∫óÈï∑">Â∫óÈï∑</option>
                                                <option value="„Ç∑„Éã„Ç¢">„Ç∑„Éã„Ç¢</option>
                                                <option value="„Çπ„Çø„ÉÉ„Éï">„Çπ„Çø„ÉÉ„Éï</option>
                                                <option value="Êñ∞‰∫∫">Êñ∞‰∫∫</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">ÊâÄÂ±ûÂ∫óËàó</label>
                                        <select name="storeId" value={formData.storeId} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                            {stores.map(store => (
                                                <option key={store.id} value={store.id}>{store.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">‰ªäÊúà„ÅÆÂ£≤‰∏äÁõÆÊ®ô</label>
                                        <input type="number" name="target" value={formData.target} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÁèæÂú®Â£≤‰∏ä</label>
                                            <input type="number" name="sales" value={formData.sales} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÊåáÂêçÊï∞</label>
                                            <input type="number" name="nomination" value={formData.nomination} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">„É™„Éî„Éº„ÉàÁéá(%)</label>
                                            <input type="number" name="retention" value={formData.retention} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Âè£„Ç≥„ÉüË©ï‰æ°(5.0)</label>
                                            <input type="number" step="0.1" name="reviewScore" value={formData.reviewScore} onChange={handleChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-3 mt-6">
                                    <button onClick={() => setIsEditing(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={handleSave} className="px-4 py-2 text-sm bg-gold-500 hover:bg-gold-600 text-white rounded font-medium shadow-sm">‰øùÂ≠ò„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Delete Confirmation Modal */}
                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm border border-rose-200">
                                <div className="flex items-center mb-4">
                                    <Icon name="alert-triangle" size={24} className="text-rose-500 mr-3" />
                                    <h3 className="text-lg font-bold text-brown-800">ÂâäÈô§„ÅÆÁ¢∫Ë™ç</h3>
                                </div>
                                <p className="text-sm text-gray-600 mb-6">
                                    „Åì„ÅÆ„Çπ„Çø„ÉÉ„Éï„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ
                                </p>
                                <div className="flex justify-end space-x-3">
                                    <button onClick={() => setShowDeleteConfirm(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={confirmDelete} className="px-4 py-2 text-sm bg-rose-500 hover:bg-rose-600 text-white rounded font-medium shadow-sm">ÂâäÈô§„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Customer & Ticket Management View ---
        const CustomerTicketManagementView = ({ ticketMasterList, customerList, onUpdateTicketMaster, onAddTicketMaster, onDeleteTicketMaster, onUpdateCustomer, onAddCustomer, onDeleteCustomer }) => {
            const [activeView, setActiveView] = useState('master'); // 'master' or 'customers'
            const [isEditing, setIsEditing] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [deletingId, setDeletingId] = useState(null);
            const [editingType, setEditingType] = useState('master'); // 'master' or 'customer'

            // Form State
            const [ticketFormData, setTicketFormData] = useState({
                name: '', sessions: 0, price: 0, validMonths: 0, description: ''
            });

            const [customerFormData, setCustomerFormData] = useState({
                name: '', phone: '', email: '', purchaseDate: '', ticketMasterId: '', remainingSessions: 0, expiryDate: '', storeId: 1
            });

            // Ticket Master Handlers
            const handleEditTicketMaster = (ticket) => {
                setIsEditing(true);
                setEditingId(ticket.id);
                setEditingType('master');
                setTicketFormData({ ...ticket });
            };

            const handleAddTicketMaster = () => {
                setIsEditing(true);
                setEditingId(null);
                setEditingType('master');
                setTicketFormData({
                    name: '', sessions: 5, price: 0, validMonths: 6, description: ''
                });
            };

            const handleDeleteTicketMaster = (id) => {
                setDeletingId(id);
                setEditingType('master');
                setShowDeleteConfirm(true);
            };

            // Customer Handlers
            const handleEditCustomer = (customer) => {
                setIsEditing(true);
                setEditingId(customer.id);
                setEditingType('customer');
                setCustomerFormData({ ...customer });
            };

            const handleAddCustomer = () => {
                setIsEditing(true);
                setEditingId(null);
                setEditingType('customer');
                const today = new Date().toISOString().split('T')[0];
                setCustomerFormData({
                    name: '', phone: '', email: '', purchaseDate: today, ticketMasterId: ticketMasterList[0]?.id || '', remainingSessions: 0, expiryDate: '', storeId: 1
                });
            };

            const handleDeleteCustomer = (id) => {
                setDeletingId(id);
                setEditingType('customer');
                setShowDeleteConfirm(true);
            };

            const confirmDelete = () => {
                if (editingType === 'master') {
                    onDeleteTicketMaster(deletingId);
                } else {
                    onDeleteCustomer(deletingId);
                }
                setShowDeleteConfirm(false);
                setDeletingId(null);
            };

            const handleSave = () => {
                if (editingType === 'master') {
                    if (editingId) {
                        onUpdateTicketMaster(editingId, ticketFormData);
                    } else {
                        onAddTicketMaster({ ...ticketFormData, id: Date.now() });
                    }
                } else {
                    // ÈÅ∏Êäû„Åï„Çå„ÅüÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„Åã„ÇâÊÆã„Çä„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞„ÇíË®≠ÂÆö
                    const selectedMaster = ticketMasterList.find(t => t.id === Number(customerFormData.ticketMasterId));
                    if (selectedMaster && !editingId) {
                        customerFormData.remainingSessions = selectedMaster.sessions;
                        // ÊúâÂäπÊúüÈôê„ÇíË®àÁÆó
                        const purchaseDate = new Date(customerFormData.purchaseDate);
                        purchaseDate.setMonth(purchaseDate.getMonth() + selectedMaster.validMonths);
                        customerFormData.expiryDate = purchaseDate.toISOString().split('T')[0];
                    }

                    if (editingId) {
                        onUpdateCustomer(editingId, customerFormData);
                    } else {
                        onAddCustomer({ ...customerFormData, id: Date.now() });
                    }
                }
                setIsEditing(false);
                setEditingId(null);
            };

            const handleTicketFormChange = (e) => {
                const { name, value } = e.target;
                setTicketFormData(prev => ({
                    ...prev,
                    [name]: ['name', 'description'].includes(name) ? value : Number(value)
                }));
            };

            const handleCustomerFormChange = (e) => {
                const { name, value } = e.target;
                setCustomerFormData(prev => ({
                    ...prev,
                    [name]: ['name', 'phone', 'email', 'purchaseDate', 'expiryDate'].includes(name) ? value : Number(value)
                }));
            };

            return (
                <div className="space-y-6">
                    {/* Tab Navigation */}
                    <div className="flex justify-between items-center">
                        <div className="flex gap-2 bg-white rounded-lg p-1 border border-gold-200">
                            <button
                                onClick={() => setActiveView('master')}
                                className={`px-6 py-2 rounded text-sm font-medium transition-colors ${
                                    activeView === 'master' ? 'bg-gold-500 text-white' : 'text-gray-600 hover:bg-gold-50'
                                }`}
                            >
                                ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÁÆ°ÁêÜ
                            </button>
                            <button
                                onClick={() => setActiveView('customers')}
                                className={`px-6 py-2 rounded text-sm font-medium transition-colors ${
                                    activeView === 'customers' ? 'bg-gold-500 text-white' : 'text-gray-600 hover:bg-gold-50'
                                }`}
                            >
                                È°ßÂÆ¢„ÉªË≥ºÂÖ•ËÄÖÁÆ°ÁêÜ
                            </button>
                        </div>
                        <button
                            onClick={activeView === 'master' ? handleAddTicketMaster : handleAddCustomer}
                            className="bg-gold-500 hover:bg-gold-600 text-white px-4 py-2 rounded-lg shadow-sm flex items-center text-sm font-medium transition-colors"
                        >
                            <Icon name="plus" size={16} className="mr-2" />
                            {activeView === 'master' ? 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºËøΩÂä†' : 'È°ßÂÆ¢ËøΩÂä†'}
                        </button>
                    </div>

                    {/* Master Ticket List */}
                    {activeView === 'master' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {ticketMasterList.length === 0 ? (
                                <div className="col-span-full text-center py-12 text-gray-400">
                                    <Icon name="ticket" size={48} className="mx-auto mb-4 opacity-30" />
                                    <p className="text-sm">ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                    <p className="text-xs mt-2">„ÄåÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºËøΩÂä†„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                </div>
                            ) : (
                                ticketMasterList.map(ticket => (
                                    <div key={ticket.id} className="bg-white border border-gold-100 rounded-xl p-5 hover:shadow-md transition-shadow group relative">
                                        <div className="absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button
                                                onClick={() => handleEditTicketMaster(ticket)}
                                                className="text-gray-300 hover:text-gold-500 p-1"
                                            >
                                                <Icon name="edit-2" size={16} />
                                            </button>
                                            <button
                                                onClick={() => handleDeleteTicketMaster(ticket.id)}
                                                className="text-gray-300 hover:text-rose-500 p-1"
                                            >
                                                <Icon name="trash-2" size={16} />
                                            </button>
                                        </div>

                                        <div className="mb-4">
                                            <h3 className="font-bold text-brown-800 text-lg mb-1">{ticket.name}</h3>
                                            <p className="text-xs text-gray-500">{ticket.description}</p>
                                        </div>

                                        <div className="space-y-2 border-t border-gray-100 pt-3">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">ÂõûÊï∞</span>
                                                <span className="font-bold text-brown-800">{ticket.sessions}Âõû</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">‰æ°Ê†º</span>
                                                <span className="font-bold text-gold-600">¬•{ticket.price.toLocaleString()}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">ÊúâÂäπÊúüÈôê</span>
                                                <span className="font-bold text-brown-800">{ticket.validMonths}„É∂Êúà</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-500">1ÂõûÂçò‰æ°</span>
                                                <span className="text-emerald-600">¬•{Math.round(ticket.price / ticket.sessions).toLocaleString()}</span>
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    )}

                    {/* Customer List */}
                    {activeView === 'customers' && (
                        <div className="bg-white rounded-xl border border-gold-100 overflow-hidden">
                            {customerList.length === 0 ? (
                                <div className="text-center py-12 text-gray-400">
                                    <Icon name="users" size={48} className="mx-auto mb-4 opacity-30" />
                                    <p className="text-sm">È°ßÂÆ¢„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                                    <p className="text-xs mt-2">„ÄåÈ°ßÂÆ¢ËøΩÂä†„Äç„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                </div>
                            ) : (
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gold-50 border-b border-gold-100">
                                            <tr className="text-left text-xs text-gray-500 uppercase">
                                                <th className="py-3 px-4 font-medium">Ê∞èÂêç</th>
                                                <th className="py-3 px-4 font-medium">ÈÄ£Áµ°ÂÖà</th>
                                                <th className="py-3 px-4 font-medium">ÂõûÊï∞Âà∏</th>
                                                <th className="py-3 px-4 font-medium">ÊÆãÂõûÊï∞</th>
                                                <th className="py-3 px-4 font-medium">ÊúâÂäπÊúüÈôê</th>
                                                <th className="py-3 px-4 font-medium">Â∫óËàó</th>
                                                <th className="py-3 px-4 font-medium text-center">Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100">
                                            {customerList.map(customer => {
                                                const ticket = ticketMasterList.find(t => t.id === customer.ticketMasterId);
                                                const store = stores.find(s => s.id === customer.storeId);
                                                const isExpired = new Date(customer.expiryDate) < new Date();

                                                return (
                                                    <tr key={customer.id} className="hover:bg-gold-50/30 text-sm">
                                                        <td className="py-3 px-4 font-medium text-brown-800">{customer.name}</td>
                                                        <td className="py-3 px-4 text-gray-600">
                                                            <div>{customer.phone}</div>
                                                            <div className="text-xs text-gray-400">{customer.email}</div>
                                                        </td>
                                                        <td className="py-3 px-4 text-gray-600">{ticket?.name || '‰∏çÊòé'}</td>
                                                        <td className="py-3 px-4">
                                                            <span className={`font-bold ${customer.remainingSessions > 0 ? 'text-emerald-600' : 'text-gray-400'}`}>
                                                                {customer.remainingSessions}Âõû
                                                            </span>
                                                        </td>
                                                        <td className="py-3 px-4">
                                                            <span className={`text-xs px-2 py-1 rounded ${isExpired ? 'bg-rose-100 text-rose-700' : 'bg-emerald-100 text-emerald-700'}`}>
                                                                {customer.expiryDate}
                                                            </span>
                                                        </td>
                                                        <td className="py-3 px-4 text-gray-600">{store?.name}</td>
                                                        <td className="py-3 px-4">
                                                            <div className="flex justify-center gap-2">
                                                                <button
                                                                    onClick={() => handleEditCustomer(customer)}
                                                                    className="text-gray-400 hover:text-gold-500 p-1"
                                                                >
                                                                    <Icon name="edit-2" size={16} />
                                                                </button>
                                                                <button
                                                                    onClick={() => handleDeleteCustomer(customer.id)}
                                                                    className="text-gray-400 hover:text-rose-500 p-1"
                                                                >
                                                                    <Icon name="trash-2" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Edit Modal - Ticket Master */}
                    {isEditing && editingType === 'master' && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md border border-gold-200">
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">
                                    {editingId ? 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÁ∑®ÈõÜ' : 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÊñ∞Ë¶èÁôªÈå≤'}
                                </h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">ÂõûÊï∞Âà∏Âêç</label>
                                        <input name="name" value={ticketFormData.name} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="‰æã: 5ÂõûÂà∏" />
                                    </div>
                                    <div className="grid grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÂõûÊï∞</label>
                                            <input type="number" name="sessions" value={ticketFormData.sessions} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">‰æ°Ê†º(ÂÜÜ)</label>
                                            <input type="number" name="price" value={ticketFormData.price} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÊúâÂäπ(Êúà)</label>
                                            <input type="number" name="validMonths" value={ticketFormData.validMonths} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">Ë™¨Êòé</label>
                                        <textarea name="description" value={ticketFormData.description} onChange={handleTicketFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" rows="2" placeholder="ÂõûÊï∞Âà∏„ÅÆË™¨Êòé"></textarea>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-3 mt-6">
                                    <button onClick={() => setIsEditing(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={handleSave} className="px-4 py-2 text-sm bg-gold-500 hover:bg-gold-600 text-white rounded font-medium shadow-sm">‰øùÂ≠ò„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Modal - Customer */}
                    {isEditing && editingType === 'customer' && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md border border-gold-200">
                                <h3 className="text-lg font-bold text-brown-800 mb-4 serif">
                                    {editingId ? 'È°ßÂÆ¢ÊÉÖÂ†±Á∑®ÈõÜ' : 'È°ßÂÆ¢Êñ∞Ë¶èÁôªÈå≤'}
                                </h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">Ê∞èÂêç</label>
                                        <input name="name" value={customerFormData.name} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="Ê∞èÂêç" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÈõªË©±Áï™Âè∑</label>
                                            <input name="phone" value={customerFormData.phone} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="090-1234-5678" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Â∫óËàó</label>
                                            <select name="storeId" value={customerFormData.storeId} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                                {stores.map(store => (
                                                    <option key={store.id} value={store.id}>{store.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                        <input name="email" type="email" value={customerFormData.email} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" placeholder="example@email.com" />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1">Ë≥ºÂÖ•ÂõûÊï∞Âà∏</label>
                                        <select name="ticketMasterId" value={customerFormData.ticketMasterId} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none">
                                            {ticketMasterList.map(ticket => (
                                                <option key={ticket.id} value={ticket.id}>{ticket.name} ({ticket.sessions}Âõû / ¬•{ticket.price.toLocaleString()})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Ë≥ºÂÖ•Êó•</label>
                                            <input name="purchaseDate" type="date" value={customerFormData.purchaseDate} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">ÊÆãÂõûÊï∞</label>
                                            <input name="remainingSessions" type="number" value={customerFormData.remainingSessions} onChange={handleCustomerFormChange} className="w-full border border-gray-300 rounded p-2 text-sm focus:border-gold-500 outline-none" />
                                        </div>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-3 mt-6">
                                    <button onClick={() => setIsEditing(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={handleSave} className="px-4 py-2 text-sm bg-gold-500 hover:bg-gold-600 text-white rounded font-medium shadow-sm">‰øùÂ≠ò„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Delete Confirmation Modal */}
                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm border border-rose-200">
                                <div className="flex items-center mb-4">
                                    <Icon name="alert-triangle" size={24} className="text-rose-500 mr-3" />
                                    <h3 className="text-lg font-bold text-brown-800">ÂâäÈô§„ÅÆÁ¢∫Ë™ç</h3>
                                </div>
                                <p className="text-sm text-gray-600 mb-6">
                                    „Åì„ÅÆ{editingType === 'master' ? 'ÂõûÊï∞Âà∏„Éû„Çπ„Çø„Éº' : 'È°ßÂÆ¢'}„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ
                                </p>
                                <div className="flex justify-end space-x-3">
                                    <button onClick={() => setShowDeleteConfirm(false)} className="px-4 py-2 text-sm text-gray-500 hover:bg-gray-100 rounded">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button onClick={confirmDelete} className="px-4 py-2 text-sm bg-rose-500 hover:bg-rose-600 text-white rounded font-medium shadow-sm">ÂâäÈô§„Åô„Çã</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Menu Analysis View ---
        const MenuAnalysisView = ({ menuSalesData }) => {
            if (!window.Recharts) return <div>Loading Charts...</div>;

            const hasData = menuSalesData && menuSalesData.length > 0;
            const totalMenuSales = hasData ? menuSalesData.reduce((sum, m) => sum + (m.sales || 0), 0) : 0;
            const totalMenuCount = hasData ? menuSalesData.reduce((sum, m) => sum + (m.count || 0), 0) : 0;
            const topMenu = hasData ? [...menuSalesData].sort((a, b) => (b.count || 0) - (a.count || 0))[0] : null;

            if (!hasData) {
                return (
                    <div className="text-center py-12 text-gray-400">
                        <Icon name="package" size={48} className="mx-auto mb-4 opacity-30" />
                        <p className="text-lg font-bold text-brown-800">„É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                        <p className="text-sm mt-2">Êó•Ê¨°Â£≤‰∏ä„ÅÆÂÖ•Âäõ„ÇíË°å„ÅÜ„Å®„ÄÅ„É°„Éã„É•„ÉºÂà•„ÅÆÂàÜÊûê„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</p>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    {/* „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Ç´„Éº„Éâ */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <KpiCard
                            title="„É°„Éã„É•„ÉºÁ∑èÂ£≤‰∏ä"
                            value={`¬•${totalMenuSales.toLocaleString()}`}
                            subValue={`Á∑èÊñΩË°ìÂõûÊï∞: ${totalMenuCount}Âõû`}
                            trend={null}
                            icon="shopping-bag"
                            color="bg-gold-600"
                        />
                        <KpiCard
                            title="Âπ≥ÂùáÊñΩË°ìÂçò‰æ°"
                            value={totalMenuCount > 0 ? `¬•${Math.round(totalMenuSales / totalMenuCount).toLocaleString()}` : '¬•0'}
                            subValue="ÂÖ®„É°„Éã„É•„ÉºÂπ≥Âùá"
                            trend={null}
                            icon="trending-up"
                            color="bg-emerald-600"
                        />
                        <KpiCard
                            title="‰∫∫Ê∞óNo.1„É°„Éã„É•„Éº"
                            value={topMenu ? topMenu.menuName.substring(0, 10) : '-'}
                            subValue={topMenu ? `${topMenu.count}ÂõûÂÆüÊñΩ` : '„Éá„Éº„Çø„Å™„Åó'}
                            trend={null}
                            icon="award"
                            color="bg-rose-500"
                        />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„ÉÜ„Éº„Éñ„É´ */}
                        <Card>
                            <h2 className="text-lg font-bold text-brown-800 mb-6 serif">„É°„Éã„É•„ÉºÂà•Â£≤‰∏äË©≥Á¥∞</h2>
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="border-b border-gold-100 text-xs text-gray-500 uppercase">
                                            <th className="py-3 font-medium">„É°„Éã„É•„ÉºÂêç</th>
                                            <th className="py-3 font-medium text-right">ÂõûÊï∞</th>
                                            <th className="py-3 font-medium text-right">Â£≤‰∏ä</th>
                                            <th className="py-3 font-medium text-center">ÂØæÂøúÂ∫óËàó</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-sm divide-y divide-gray-50">
                                        {menuSalesData.map((menu) => (
                                            <tr key={menu.menuId} className="hover:bg-gold-50/50">
                                                <td className="py-3 font-medium text-brown-800">{menu.menuName}</td>
                                                <td className="py-3 text-right">{menu.count}Âõû</td>
                                                <td className="py-3 text-right font-bold">¬•{menu.sales.toLocaleString()}</td>
                                                <td className="py-3 text-center">
                                                    <span className="text-xs px-2 py-1 bg-gray-100 rounded">
                                                        {menu.availableStores.length === 2 ? '‰∏°Â∫óËàó' : 'Êñ∞ÂÆøÂçóÂè£Â∫ó„ÅÆ„Åø'}
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </Card>

                        {/* „É°„Éã„É•„ÉºÂà•Â£≤‰∏ä„Ç∞„É©„Éï */}
                        <Card>
                            <h2 className="text-lg font-bold text-brown-800 mb-6 serif">„É°„Éã„É•„ÉºÂà•Â£≤‰∏äÊßãÊàêÊØî</h2>
                            <ResponsiveContainer width="100%" height={300}>
                                <BarChart data={menuSalesData} layout="vertical">
                                    <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#e5e7eb" />
                                    <XAxis type="number" tick={{fontSize: 10}} tickFormatter={(val) => `¬•${val/10000}‰∏á`} />
                                    <YAxis type="category" dataKey="menuName" tick={{fontSize: 9}} width={120} />
                                    <Tooltip
                                        formatter={(value) => `¬•${value.toLocaleString()}`}
                                        contentStyle={{backgroundColor: '#fff', borderColor: '#d4af37'}}
                                    />
                                    <Bar dataKey="sales" name="Â£≤‰∏ä" fill="#d4af37" radius={[0, 4, 4, 0]} />
                                </BarChart>
                            </ResponsiveContainer>
                        </Card>
                    </div>

                    {/* Â∫óËàóÈôêÂÆö„É°„Éã„É•„Éº„ÅÆÊ≥®ÊÑèÊõ∏„Åç */}
                    <Card className="bg-gold-50 border-gold-300">
                        <div className="flex items-start">
                            <Icon name="info" size={20} className="text-gold-600 mr-3 mt-1" />
                            <div>
                                <h3 className="font-bold text-brown-800 mb-2">Â∫óËàóÈôêÂÆö„É°„Éã„É•„ÉºÊÉÖÂ†±</h3>
                                <p className="text-sm text-gray-700">
                                    „Äå„Çà„ÇÇ„ÅéËí∏„Åó„Äç„Å®„Äå„Çª„É´„Éï„Éõ„ÉØ„Ç§„Éà„Éã„É≥„Ç∞„Äç„ÅØ<span className="font-bold text-gold-700">Êñ∞ÂÆøÂçóÂè£Â∫ó„Åß„ÅÆ„Åø</span>Êèê‰æõ„Åó„Å¶„ÅÑ„Çã„É°„Éã„É•„Éº„Åß„Åô„ÄÇ
                                    Êñ∞ÂÆøÂ∫ó„Åß„ÇÇÊèê‰æõ„ÇíÊ§úË®é„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅË®≠ÂÇôÊäïË≥á„Å®ÂèéÁõäÊÄß„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ
                                </p>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

        // --- Simulation View (Reused but Styled) ---
        const SimulationView = () => {
            const [targetSales, setTargetSales] = useState(5000000);
            const [manualTarget, setManualTarget] = useState('');

            // Êñ∞Ë¶è„Éª„É™„Éî„Éº„ÉàÈñ¢ÈÄ£
            const [newCustomers, setNewCustomers] = useState(80);
            const [repeatCustomers, setRepeatCustomers] = useState(150);
            const [newCustomerPrice, setNewCustomerPrice] = useState(15000);
            const [repeatCustomerPrice, setRepeatCustomerPrice] = useState(12000);

            // ÂõûÊï∞Âà∏Èñ¢ÈÄ£
            const [ticketPurchaseRate, setTicketPurchaseRate] = useState(30); // %
            const [ticketAvgPrice, setTicketAvgPrice] = useState(100000);

            // „Ç™„Éó„Ç∑„Éß„É≥„ÉªÁâ©Ë≤©
            const [optionRate, setOptionRate] = useState(40); // %
            const [optionAvgPrice, setOptionAvgPrice] = useState(5000);
            const [productSalesPerMonth, setProductSalesPerMonth] = useState(200000);

            // Ë®àÁÆó
            const totalCustomers = newCustomers + repeatCustomers;
            const ticketPurchaseCount = Math.round((newCustomers * ticketPurchaseRate) / 100);
            const optionCount = Math.round((totalCustomers * optionRate) / 100);

            const newCustomerSales = newCustomers * newCustomerPrice;
            const repeatCustomerSales = repeatCustomers * repeatCustomerPrice;
            const ticketSales = ticketPurchaseCount * ticketAvgPrice;
            const optionSales = optionCount * optionAvgPrice;

            const projectedSales = newCustomerSales + repeatCustomerSales + optionSales + productSalesPerMonth;
            const displayTarget = manualTarget ? Number(manualTarget) : targetSales;
            const progress = Math.min(100, (projectedSales / displayTarget) * 100);
            const diff = projectedSales - displayTarget;

            return (
                <div className="space-y-6">
                    <Card>
                        <h2 className="text-xl font-bold text-brown-800 mb-2 serif">Ë©≥Á¥∞Â£≤‰∏ä„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</h2>
                        <p className="text-sm text-gray-500 mb-8">Êñ∞Ë¶è„Éª„É™„Éî„Éº„Éà„ÉªÂõûÊï∞Âà∏„Éª„Ç™„Éó„Ç∑„Éß„É≥„ÉªÁâ©Ë≤©„ÇíÂê´„ÇÅ„ÅüË©≥Á¥∞„Å™Â£≤‰∏ä‰∫àÊ∏¨</p>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Â∑¶„Ç´„É©„É†: ÁõÆÊ®ôË®≠ÂÆö */}
                            <div className="space-y-6">
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-2">ÊúàÈñìÁõÆÊ®ôÂ£≤‰∏äÔºàÊâãÂÖ•ÂäõÂèØÔºâ</label>
                                    <div className="relative">
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">¬•</span>
                                        <input
                                            type="number"
                                            value={manualTarget || targetSales}
                                            onChange={(e) => setManualTarget(e.target.value)}
                                            className="w-full pl-8 pr-4 py-2 text-xl font-bold text-brown-800 bg-gold-50 border border-gold-200 rounded-lg focus:border-gold-500 outline-none"
                                        />
                                    </div>
                                </div>

                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-blue-900 mb-3">Êñ∞Ë¶èÈ°ßÂÆ¢</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">Êñ∞Ë¶è‰∫∫Êï∞</label>
                                            <input type="number" value={newCustomers} onChange={(e) => setNewCustomers(Number(e.target.value))} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-blue-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">Êñ∞Ë¶èÂçò‰æ°</label>
                                            <input type="number" value={newCustomerPrice} onChange={(e) => setNewCustomerPrice(Number(e.target.value))} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-blue-500 outline-none" />
                                        </div>
                                        <div className="pt-2 border-t border-blue-200 text-sm font-bold text-blue-900">
                                            Â£≤‰∏ä: ¬•{newCustomerSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-emerald-900 mb-3">„É™„Éî„Éº„ÉàÈ°ßÂÆ¢</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">„É™„Éî„Éº„Éà‰∫∫Êï∞</label>
                                            <input type="number" value={repeatCustomers} onChange={(e) => setRepeatCustomers(Number(e.target.value))} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-emerald-500 outline-none" />
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">„É™„Éî„Éº„ÉàÂçò‰æ°</label>
                                            <input type="number" value={repeatCustomerPrice} onChange={(e) => setRepeatCustomerPrice(Number(e.target.value))} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-emerald-500 outline-none" />
                                        </div>
                                        <div className="pt-2 border-t border-emerald-200 text-sm font-bold text-emerald-900">
                                            Â£≤‰∏ä: ¬•{repeatCustomerSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* ‰∏≠Â§Æ„Ç´„É©„É†: ÂõûÊï∞Âà∏„Éª„Ç™„Éó„Ç∑„Éß„É≥ */}
                            <div className="space-y-6">
                                <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-purple-900 mb-3">ÂõûÊï∞Âà∏Ë≤©Â£≤</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">Ë≥ºÂÖ•ÁéáÔºàÊñ∞Ë¶è„ÅÆ%Ôºâ</label>
                                            <div className="flex items-center gap-2">
                                                <input type="range" min="0" max="100" value={ticketPurchaseRate} onChange={(e) => setTicketPurchaseRate(Number(e.target.value))} className="flex-1 accent-purple-500" />
                                                <span className="text-sm font-bold text-purple-900 w-12">{ticketPurchaseRate}%</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">ÂõûÊï∞Âà∏Âπ≥Âùá‰æ°Ê†º</label>
                                            <input type="number" value={ticketAvgPrice} onChange={(e) => setTicketAvgPrice(Number(e.target.value))} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-purple-500 outline-none" />
                                        </div>
                                        <div className="text-xs text-gray-500">
                                            ‰∫àÊÉ≥Ë≥ºÂÖ•‰ª∂Êï∞: {ticketPurchaseCount}‰ª∂
                                        </div>
                                        <div className="pt-2 border-t border-purple-200 text-sm font-bold text-purple-900">
                                            Â£≤‰∏ä: ¬•{ticketSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-amber-900 mb-3">„Ç™„Éó„Ç∑„Éß„É≥ËøΩÂä†</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">ËøΩÂä†ÁéáÔºàÂÖ®‰Ωì„ÅÆ%Ôºâ</label>
                                            <div className="flex items-center gap-2">
                                                <input type="range" min="0" max="100" value={optionRate} onChange={(e) => setOptionRate(Number(e.target.value))} className="flex-1 accent-amber-500" />
                                                <span className="text-sm font-bold text-amber-900 w-12">{optionRate}%</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600">„Ç™„Éó„Ç∑„Éß„É≥Âπ≥Âùá‰æ°Ê†º</label>
                                            <input type="number" value={optionAvgPrice} onChange={(e) => setOptionAvgPrice(Number(e.target.value))} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-amber-500 outline-none" />
                                        </div>
                                        <div className="text-xs text-gray-500">
                                            ‰∫àÊÉ≥ËøΩÂä†‰ª∂Êï∞: {optionCount}‰ª∂
                                        </div>
                                        <div className="pt-2 border-t border-amber-200 text-sm font-bold text-amber-900">
                                            Â£≤‰∏ä: ¬•{optionSales.toLocaleString()}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-rose-50 border border-rose-200 rounded-lg p-4">
                                    <h4 className="font-bold text-sm text-rose-900 mb-3">Áâ©Ë≤©Â£≤‰∏ä</h4>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-xs text-gray-600">ÊúàÈñìÁâ©Ë≤©Â£≤‰∏ä</label>
                                            <input type="number" value={productSalesPerMonth} onChange={(e) => setProductSalesPerMonth(Number(e.target.value))} className="w-full mt-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-rose-500 outline-none" />
                                        </div>
                                        <div className="pt-2 border-t border-rose-200 text-sm font-bold text-rose-900">
                                            Â£≤‰∏ä: ¬•{productSalesPerMonth.toLocaleString()}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Âè≥„Ç´„É©„É†: ÁµêÊûúË°®Á§∫ */}
                            <div className="space-y-6">
                                <div className="relative bg-gradient-to-br from-brown-900 to-brown-800 rounded-xl p-6 text-white overflow-hidden">
                                    <div className="absolute top-0 right-0 w-48 h-48 bg-gold-500 opacity-10 rounded-full blur-3xl -mr-12 -mt-12"></div>
                                    <div className="relative z-10">
                                        <h3 className="text-gold-200 font-medium mb-1 text-sm">‰∫àÊ∏¨ÊúàÈñìÂ£≤‰∏ä</h3>
                                        <div className="text-4xl font-bold mb-4">¬•{projectedSales.toLocaleString()}</div>

                                        <div className="w-full bg-white/20 rounded-full h-2 mb-4">
                                            <div
                                                className={`h-full rounded-full transition-all duration-500 ${diff >= 0 ? 'bg-gold-400' : 'bg-white/50'}`}
                                                style={{width: `${progress}%`}}
                                            ></div>
                                        </div>

                                        {diff < 0 ? (
                                            <div className="bg-white/10 backdrop-blur rounded p-3 border border-white/10">
                                                <p className="text-sm font-bold text-rose-300 mb-1 flex items-center"><Icon name="alert-triangle" size={14} className="mr-2"/> ÁõÆÊ®ôÊú™ÈÅîÊàê</p>
                                                <p className="text-xs text-gray-300">‰∏çË∂≥È°ç: ¬•{Math.abs(diff).toLocaleString()}</p>
                                            </div>
                                        ) : (
                                            <div className="bg-white/10 backdrop-blur rounded p-3 border border-white/10">
                                                <p className="text-sm font-bold text-emerald-300 mb-1 flex items-center"><Icon name="check" size={14} className="mr-2"/> ÁõÆÊ®ôÈÅîÊàê</p>
                                                <p className="text-xs text-gray-300">‰ΩôÂâ∞: +¬•{diff.toLocaleString()}</p>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="bg-white border border-gold-200 rounded-xl p-5">
                                    <h4 className="font-bold text-brown-800 mb-4 text-sm">Â£≤‰∏äÂÜÖË®≥</h4>
                                    <div className="space-y-2 text-sm">
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Êñ∞Ë¶èÈ°ßÂÆ¢Â£≤‰∏ä</span>
                                            <span className="font-bold text-blue-700">¬•{newCustomerSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">„É™„Éî„Éº„ÉàÂ£≤‰∏ä</span>
                                            <span className="font-bold text-emerald-700">¬•{repeatCustomerSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">ÂõûÊï∞Âà∏Â£≤‰∏ä</span>
                                            <span className="font-bold text-purple-700">¬•{ticketSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">„Ç™„Éó„Ç∑„Éß„É≥Â£≤‰∏ä</span>
                                            <span className="font-bold text-amber-700">¬•{optionSales.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-600">Áâ©Ë≤©Â£≤‰∏ä</span>
                                            <span className="font-bold text-rose-700">¬•{productSalesPerMonth.toLocaleString()}</span>
                                        </div>
                                        <div className="pt-3 mt-3 border-t border-gray-200 flex justify-between items-center">
                                            <span className="font-bold text-brown-800">ÂêàË®à</span>
                                            <span className="font-bold text-xl text-gold-600">¬•{projectedSales.toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-gold-50 border border-gold-200 rounded-lg p-4">
                                    <h4 className="font-bold text-brown-800 mb-3 text-sm">„Çµ„Éû„É™„Éº</h4>
                                    <div className="space-y-1 text-xs text-gray-700">
                                        <p>‚Ä¢ Á∑èÊù•ÂÆ¢‰∫àÊ∏¨: {totalCustomers}‰∫∫</p>
                                        <p>‚Ä¢ ÂÆ¢Âçò‰æ°Âπ≥Âùá: ¬•{Math.round(projectedSales / totalCustomers).toLocaleString()}</p>
                                        <p>‚Ä¢ ÂõûÊï∞Âà∏Ë≥ºÂÖ•‰∫àÊ∏¨: {ticketPurchaseCount}‰ª∂</p>
                                        <p>‚Ä¢ „Ç™„Éó„Ç∑„Éß„É≥ËøΩÂä†‰∫àÊ∏¨: {optionCount}‰ª∂</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };


        // --- App Layout & Navigation ---

        const Layout = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [staffList, setStaffList] = useState(initialStaffData);
            const [ticketMasterList, setTicketMasterList] = useState(initialTicketMasterData);
            const [customerList, setCustomerList] = useState(initialCustomerData);
            const [mediaSourcesList, setMediaSourcesList] = useState(initialMediaSourcesData);
            const [dailySalesData, setDailySalesData] = useState(initialDailySalesData);
            const [menuSalesData, setMenuSalesData] = useState(initialMenuSalesData);
            const [isSaving, setIsSaving] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [saveMessage, setSaveMessage] = useState('');
            const currentDate = new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });

            // „Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜÈñ¢Êï∞
            const updateStaff = (id, newData) => {
                setStaffList(prev => prev.map(staff => staff.id === id ? newData : staff));
            };

            const addStaff = (newData) => {
                setStaffList(prev => [...prev, newData]);
            };

            const deleteStaff = (id) => {
                setStaffList(prev => prev.filter(staff => staff.id !== id));
            };

            // ÂõûÊï∞Âà∏„Éû„Çπ„Çø„ÉºÁÆ°ÁêÜÈñ¢Êï∞
            const updateTicketMaster = (id, newData) => {
                setTicketMasterList(prev => prev.map(ticket => ticket.id === id ? newData : ticket));
            };

            const addTicketMaster = (newData) => {
                setTicketMasterList(prev => [...prev, newData]);
            };

            const deleteTicketMaster = (id) => {
                setTicketMasterList(prev => prev.filter(ticket => ticket.id !== id));
            };

            // È°ßÂÆ¢ÁÆ°ÁêÜÈñ¢Êï∞
            const updateCustomer = (id, newData) => {
                setCustomerList(prev => prev.map(customer => customer.id === id ? newData : customer));
            };

            const addCustomer = (newData) => {
                setCustomerList(prev => [...prev, newData]);
            };

            const deleteCustomer = (id) => {
                setCustomerList(prev => prev.filter(customer => customer.id !== id));
            };

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´ÂÖ®„Éá„Éº„Çø„Çí‰øùÂ≠ò
            const handleSaveToSpreadsheet = async () => {
                setIsSaving(true);
                setSaveMessage('');

                try {
                    await saveToSpreadsheet('saveAllData', {
                        staffData: staffList,
                        ticketData: ticketMasterList,
                        customerData: customerList,
                        dailySalesData: dailySalesData,
                        menuSalesData: menuSalesData
                    });

                    setSaveMessage('‚úì „Éá„Éº„Çø„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    setTimeout(() => setSaveMessage(''), 3000);
                } catch (error) {
                    setSaveMessage('‚úó ‰øùÂ≠ò„Ç®„É©„Éº: ' + error.message);
                }

                setIsSaving(false);
            };

            // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâÂÖ®„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            const handleLoadFromSpreadsheet = async () => {
                setIsLoading(true);
                setSaveMessage('');

                try {
                    const response = await fetch(GAS_WEB_APP_URL + '?action=getAllData', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ action: 'getAllData' })
                    });

                    const result = await response.json();

                    if (result.success && result.data) {
                        if (result.data.staff) {
                            setStaffList(result.data.staff);
                        }
                        if (result.data.ticketMasters) {
                            setTicketMasterList(result.data.ticketMasters);
                        }
                        if (result.data.customers) {
                            setCustomerList(result.data.customers);
                        }

                        setSaveMessage('‚úì „Éá„Éº„Çø„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„ÇâË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                        setTimeout(() => setSaveMessage(''), 3000);
                    } else {
                        setSaveMessage('‚úó „Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                } catch (error) {
                    setSaveMessage('‚úó Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº: ' + error.message);
                }

                setIsLoading(false);
            };

            const NavItem = ({ id, icon, label }) => (
                <button
                    onClick={() => setActiveTab(id)}
                    className={`w-full flex items-center space-x-3 px-4 py-3 my-1 rounded-lg transition-all duration-200 border-l-4 ${
                        activeTab === id 
                        ? 'border-gold-500 bg-gold-50 text-brown-800 font-bold shadow-sm' 
                        : 'border-transparent text-gray-500 hover:text-brown-800 hover:bg-white'
                    }`}
                >
                    <Icon name={icon} size={20} className={activeTab === id ? 'text-gold-600' : 'text-gray-400'} />
                    {sidebarOpen && <span className={activeTab === id ? 'serif' : ''}>{label}</span>}
                </button>
            );

            return (
                <div className="flex h-screen bg-brown-50 font-sans text-brown-900">
                    {/* Sidebar */}
                    <div className={`${sidebarOpen ? 'w-64' : 'w-20'} bg-white border-r border-gold-200 flex flex-col transition-all duration-300 z-20 shadow-xl`}>
                        <div className="h-20 flex items-center justify-center border-b border-gold-100 bg-white">
                            {sidebarOpen ? (
                                <h1 className="text-2xl font-bold text-brown-800 flex items-center serif tracking-wider">
                                    <span className="text-gold-500 mr-2 text-3xl">‚ú¶</span> LuxeMetrics
                                </h1>
                            ) : (
                                <span className="text-gold-500 text-3xl">‚ú¶</span>
                            )}
                        </div>

                        <div className="flex-1 py-6 px-2 space-y-1">
                            <NavItem id="dashboard" icon="layout-dashboard" label="„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ" />
                            <NavItem id="simulation" icon="target" label="ÁõÆÊ®ô„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥" />
                            <NavItem id="sales" icon="bar-chart-2" label="Â£≤‰∏ä„ÉªÂ™í‰ΩìÂàÜÊûê" />
                            <NavItem id="menus" icon="package" label="„É°„Éã„É•„ÉºÂà•ÂàÜÊûê" />
                            <NavItem id="staff" icon="users" label="„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ" />
                            <NavItem id="customers" icon="heart" label="È°ßÂÆ¢„ÉªÂõûÊï∞Âà∏ÁÆ°ÁêÜ" />
                        </div>

                        <div className="p-4 border-t border-gold-100 bg-gold-50/50">
                             <button onClick={() => setActiveTab('settings')} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-500 hover:bg-white hover:text-brown-800 transition-colors ${!sidebarOpen && 'justify-center'}`}>
                                <Icon name="settings" size={20} />
                                {sidebarOpen && <span>Ë®≠ÂÆö</span>}
                            </button>
                            <button onClick={() => setSidebarOpen(!sidebarOpen)} className="mt-2 w-full flex items-center justify-center p-2 text-gold-400 hover:text-gold-600">
                                <Icon name={sidebarOpen ? "chevrons-left" : "chevrons-right"} size={20} />
                            </button>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col overflow-hidden relative bg-[#f9f8f4]">
                        {/* Topbar */}
                        <header className="h-20 bg-white/80 backdrop-blur-md border-b border-gold-100 flex justify-between items-center px-8 shadow-sm z-10 sticky top-0">
                            <div>
                                <h2 className="text-xl font-bold text-brown-800 serif">
                                    {activeTab === 'dashboard' && 'Executive Summary'}
                                    {activeTab === 'simulation' && 'Strategy Simulation'}
                                    {activeTab === 'sales' && 'Sales & Marketing Analytics'}
                                    {activeTab === 'menus' && 'Menu Performance Analysis'}
                                    {activeTab === 'staff' && 'Staff Performance & Management'}
                                    {activeTab === 'customers' && 'Customer & Ticket Management'}
                                    {activeTab === 'settings' && 'System Settings'}
                                </h2>
                                <p className="text-xs text-gold-600 font-medium tracking-widest uppercase mt-1">
                                    {activeTab === 'dashboard' && 'ÁµåÂñ∂„Çµ„Éû„É™„Éº'}
                                    {activeTab === 'simulation' && 'ÁµåÂñ∂„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥'}
                                    {activeTab === 'sales' && 'Â£≤‰∏äË©≥Á¥∞„ÉªÂ™í‰ΩìÂàÜÊûê'}
                                    {activeTab === 'menus' && '„É°„Éã„É•„ÉºÂà•ÂàÜÊûê'}
                                    {activeTab === 'staff' && '„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ„ÉªÁ∑®ÈõÜ'}
                                    {activeTab === 'customers' && 'È°ßÂÆ¢„É™„Çπ„Éà„ÉªÂõûÊï∞Âà∏ÁÆ°ÁêÜ'}
                                    {activeTab === 'settings' && '„Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö'}
                                </p>
                            </div>
                            <div className="flex items-center space-x-6">
                                {/* „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà‰øùÂ≠ò„ÉªË™≠„ÅøËæº„Åø„Éú„Çø„É≥ */}
                                <div className="flex flex-col items-end">
                                    <div className="flex gap-2">
                                        <button
                                            onClick={handleLoadFromSpreadsheet}
                                            disabled={isLoading}
                                            className="flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg shadow-sm transition-colors"
                                        >
                                            <Icon name={isLoading ? "loader" : "download"} size={16} className={`mr-2 ${isLoading ? 'animate-spin' : ''}`} />
                                            {isLoading ? 'Ë™≠Ëæº‰∏≠...' : 'Ë™≠„ÅøËæº„Åø'}
                                        </button>
                                        <button
                                            onClick={handleSaveToSpreadsheet}
                                            disabled={isSaving}
                                            className="flex items-center px-4 py-2 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg shadow-sm transition-colors"
                                        >
                                            <Icon name={isSaving ? "loader" : "save"} size={16} className={`mr-2 ${isSaving ? 'animate-spin' : ''}`} />
                                            {isSaving ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò'}
                                        </button>
                                    </div>
                                    {saveMessage && (
                                        <span className={`text-xs mt-1 ${saveMessage.includes('‚úì') ? 'text-emerald-600' : 'text-rose-600'}`}>
                                            {saveMessage}
                                        </span>
                                    )}
                                </div>
                                <div className="h-8 w-px bg-gold-200"></div>
                                <div className="text-right hidden md:block">
                                    <p className="text-sm font-bold text-brown-800">{currentDate}</p>
                                    <p className="text-xs text-gray-400">Tokyo, Japan</p>
                                </div>
                                <div className="h-8 w-px bg-gold-200"></div>
                                <div className="flex items-center space-x-3">
                                    <div className="w-10 h-10 rounded-full bg-brown-800 border-2 border-gold-300 flex items-center justify-center text-gold-100 text-sm font-serif">
                                        OP
                                    </div>
                                    <div className="hidden md:block">
                                        <p className="text-sm font-bold text-brown-800">„Ç™„Éº„Éä„ÉºÊßò</p>
                                        <p className="text-xs text-gold-600">Administrator</p>
                                    </div>
                                </div>
                            </div>
                        </header>

                        {/* Content Area */}
                        <main className="flex-1 overflow-y-auto p-8">
                            <div className="max-w-7xl mx-auto pb-10">
                                {activeTab === 'dashboard' && <DashboardView staffList={staffList} dailySalesData={dailySalesData} menuSalesData={menuSalesData} />}
                                {activeTab === 'staff' && <StaffManagementView staffList={staffList} onUpdateStaff={updateStaff} onAddStaff={addStaff} onDeleteStaff={deleteStaff} />}
                                {activeTab === 'simulation' && <SimulationView />}
                                {activeTab === 'sales' && <SalesAnalysisView dailySalesData={dailySalesData} />}
                                {activeTab === 'menus' && <MenuAnalysisView menuSalesData={menuSalesData} />}
                                {activeTab === 'customers' && (
                                    <CustomerTicketManagementView
                                        ticketMasterList={ticketMasterList}
                                        customerList={customerList}
                                        onUpdateTicketMaster={updateTicketMaster}
                                        onAddTicketMaster={addTicketMaster}
                                        onDeleteTicketMaster={deleteTicketMaster}
                                        onUpdateCustomer={updateCustomer}
                                        onAddCustomer={addCustomer}
                                        onDeleteCustomer={deleteCustomer}
                                    />
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Layout />);
    </script>
</body>
</html>
