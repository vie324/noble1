# スプレッドシート・GAS 0から再設定ガイド

このガイドに従って、スプレッドシートとGoogle Apps Script (GAS)を0から設定してください。

## 📋 必要なもの

- Googleアカウント
- Google Chrome または Firefox などのブラウザ
- テキストエディタ（VSCode、メモ帳など）

---

## ステップ1: 新しいスプレッドシートを作成

1. **Google Driveを開く**
   - https://drive.google.com にアクセス

2. **新しいスプレッドシートを作成**
   - 左上の「新規」→「Googleスプレッドシート」→「空白のスプレッドシート」をクリック

3. **スプレッドシートに名前をつける**
   - 左上の「無題のスプレッドシート」をクリック
   - 例：「エステサロンダッシュボード_データ」と入力

4. **スプレッドシートIDをコピー**
   - ブラウザのアドレスバーに表示されているURLを確認
   - URLの形式: `https://docs.google.com/spreadsheets/d/【ここがID】/edit`
   - `/d/` と `/edit` の間の文字列をコピー
   - 例: `1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t`

---

## ステップ2: Google Apps Script (GAS) をセットアップ

### 2-1. Apps Scriptエディタを開く

1. スプレッドシートの画面で、メニューバー「拡張機能」をクリック
2. 「Apps Script」を選択

### 2-2. コードを貼り付ける

1. 表示されたエディタで、既存のコード（`function myFunction() {...}` など）を**すべて削除**

2. `gas/Code.gs`の内容を**すべてコピー**して貼り付け

3. **7行目の`SPREADSHEET_ID`を変更**
   ```javascript
   // 変更前
   const SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID_HERE';

   // 変更後（ステップ1でコピーしたIDを貼り付け）
   const SPREADSHEET_ID = '1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t';
   ```

4. **保存する**
   - 左上のディスクアイコン（💾）をクリック、または `Ctrl+S`（Mac: `Cmd+S`）
   - プロジェクト名を求められたら、例：「エステサロンAPI」と入力

### 2-3. GASをウェブアプリとしてデプロイ

1. **デプロイボタンをクリック**
   - 右上の「デプロイ」→「新しいデプロイ」を選択

2. **設定を選択**
   - 「種類の選択」の⚙アイコンをクリック
   - 「ウェブアプリ」を選択

3. **デプロイの設定**
   - **説明**: 「エステサロンダッシュボードAPI」（任意）
   - **次のユーザーとして実行**: 「自分（あなたのGoogleアカウント）」
   - **アクセスできるユーザー**: **「全員」**を選択（重要！）

4. **「デプロイ」をクリック**
   - 初回は承認を求められます

### 2-4. 承認を許可（初回のみ）

1. 「アクセスを承認」をクリック
2. Googleアカウントを選択
3. 「このアプリはGoogleで確認されていません」と表示されたら：
   - 左下の「詳細」をクリック
   - 「（プロジェクト名）（安全ではないページ）に移動」をクリック
4. 「許可」をクリック

### 2-5. ウェブアプリのURLをコピー

1. デプロイが完了すると、「ウェブアプリ」のURLが表示されます
2. **このURLをコピー**（後で使います）
   - 形式: `https://script.google.com/macros/s/AKfycby.../exec`

---

## ステップ3: index.html の設定を更新

### 3-1. index.htmlを編集

1. テキストエディタで `index.html` を開く

2. **929行目付近**の `GAS_WEB_APP_URL` を探す

3. **ステップ2-5でコピーしたURL**に変更
   ```javascript
   // 変更前
   const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxmSKXpHDEVbHeKEIHrtk_DoQfXIsMXBExfa7CzhpkizuC_wf-UY5YqXn0Ctc4u6lbq/exec';

   // 変更後（コピーしたURLを貼り付け）
   const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/【あなたのURL】/exec';
   ```

4. **保存する**（`Ctrl+S` または `Cmd+S`）

### 3-2. 初回自動読み込みを有効化（オプション）

データを自動的に読み込みたい場合は、**4723-4726行目**のコメントアウトを解除：

```javascript
// 変更前（無効化されている状態）
// if (GAS_WEB_APP_URL && GAS_WEB_APP_URL !== 'YOUR_GAS_WEB_APP_URL_HERE') {
//     handleLoadFromSpreadsheet();
// }

// 変更後（有効化）
if (GAS_WEB_APP_URL && GAS_WEB_APP_URL !== 'YOUR_GAS_WEB_APP_URL_HERE') {
    handleLoadFromSpreadsheet();
}
```

**注意**: 初期セットアップでは無効のままにしておき、まず手動で動作確認することをお勧めします。

---

## ステップ4: 動作確認

### 4-1. ブラウザでindex.htmlを開く

1. `index.html` をダブルクリック、またはブラウザにドラッグ&ドロップ
2. ダッシュボードが表示されることを確認

### 4-2. スプレッドシート連携をテスト

1. ダッシュボード右上の **「保存」ボタン**をクリック
2. 「✓ データをスプレッドシートに保存しました」と表示されることを確認

3. スプレッドシートを開いて、データが保存されたことを確認
   - 以下のシートが自動作成されます：
     - 日次売上
     - メニュー別売上
     - スタッフ実績
     - 回数券マスター
     - 顧客管理

4. ダッシュボード右上の **「読み込み」ボタン**をクリック
5. スプレッドシートからデータが読み込まれることを確認

---

## トラブルシューティング

### ❌ 「保存」や「読み込み」ボタンが反応しない

**原因**: GASのデプロイ設定が正しくない

**解決策**:
1. Apps Scriptエディタを開く
2. 「デプロイ」→「デプロイを管理」
3. 「アクセスできるユーザー」が「全員」になっているか確認
4. もしなっていなければ、編集して「全員」に変更し、再デプロイ

### ❌ 「スプレッドシートURLが設定されていません」エラー

**原因**: index.htmlの`GAS_WEB_APP_URL`が正しく設定されていない

**解決策**:
1. index.htmlの929行目を確認
2. ステップ2-5でコピーしたURLが正しく貼り付けられているか確認
3. URLが`'YOUR_GAS_WEB_APP_URL_HERE'`のままになっていないか確認

### ❌ GASで「Exception: Spreadsheet not found」エラー

**原因**: Code.gsの`SPREADSHEET_ID`が間違っている

**解決策**:
1. スプレッドシートのURLからIDを再度コピー
2. Apps ScriptのCode.gsの7行目を修正
3. 保存して、再度テスト

### ❌ 真っ白な画面が表示される

**原因**: JavaScriptエラー、またはGAS読み込みの失敗

**解決策**:
1. ブラウザのコンソールを開く（F12キー）
2. エラーメッセージを確認
3. 初回自動読み込みが有効になっている場合は、無効化（ステップ3-2参照）
4. ブラウザのキャッシュをクリア（Ctrl+Shift+R または Cmd+Shift+R）

---

## 設定完了後の運用

### データの保存
- 「実績入力」タブでデータを入力後、右上の「保存」ボタンをクリック
- スプレッドシートに自動的にデータが保存されます

### データの読み込み
- 右上の「読み込み」ボタンをクリックすると、スプレッドシートからデータを読み込みます
- 複数のデバイスでデータを共有できます

### バックアップ
- スプレッドシートは自動的にバックアップされます
- 必要に応じて「ファイル」→「コピーを作成」でバックアップを作成できます

---

## サポートが必要な場合

このガイドに従っても問題が解決しない場合は、以下の情報を提供してください：

1. ブラウザのコンソールに表示されるエラーメッセージ（F12キーで開く）
2. どのステップで問題が発生したか
3. 使用しているブラウザとバージョン

---

**設定完了です！お疲れさまでした。🎉**
